<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#FAFAF8">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<title>Êó•Êú¨Ë™û„Éû„Çπ„Çø„Éº - Êó•Ë™ûËÉåË™¶Â≠∏Áøí</title>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}
body{font-family:"Hiragino Sans","Yu Gothic","Noto Sans JP","Microsoft JhengHei",sans-serif;
  background:var(--bg-primary);color:var(--text-primary);overflow:hidden;
  -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
button{font-family:inherit;cursor:pointer;border:none;background:none;color:inherit;font-size:inherit}
input{font-family:inherit;border:none;outline:none;background:none;color:inherit}
:root{
  --bg-primary:#FAFAF8;--bg-secondary:#F0EDE8;--bg-card:#FFFFFF;
  --text-primary:#2C2C2C;--text-secondary:#6B6B6B;--text-hint:#999;
  --accent-primary:#C41E3A;--accent-secondary:#2D5F8A;
  --accent-success:#4A7C59;--accent-warning:#D4A017;--accent-error:#B22234;
  --border-color:#E5E2DC;
  --shadow-sm:0 1px 3px rgba(0,0,0,0.08);--shadow-md:0 4px 12px rgba(0,0,0,0.1);
  --shadow-lg:0 8px 24px rgba(0,0,0,0.12);
  --radius-sm:8px;--radius-md:12px;--radius-lg:20px;
  --nav-height:60px;
}
[data-theme="dark"]{
  --bg-primary:#1A1A2E;--bg-secondary:#16213E;--bg-card:#0F3460;
  --text-primary:#E8E8E8;--text-secondary:#A0A0A0;--text-hint:#666;
  --accent-primary:#E94560;--accent-secondary:#5B9BD5;
  --accent-success:#6BCB77;--accent-warning:#FFD93D;--accent-error:#FF6B6B;
  --border-color:#2A2A4A;
  --shadow-sm:0 1px 3px rgba(0,0,0,0.3);--shadow-md:0 4px 12px rgba(0,0,0,0.4);
  --shadow-lg:0 8px 24px rgba(0,0,0,0.5);
}
#app{display:flex;flex-direction:column;height:100vh;height:100dvh;
  max-width:480px;margin:0 auto;position:relative;overflow:hidden;box-shadow:var(--shadow-lg)}
.page{position:absolute;top:0;left:0;right:0;bottom:0;
  padding:16px 16px calc(var(--nav-height) + 20px + env(safe-area-inset-bottom,0px));
  overflow-y:auto;-webkit-overflow-scrolling:touch;
  opacity:0;transform:translateX(20px);
  transition:opacity .3s ease,transform .3s ease;pointer-events:none;z-index:1;
  background:var(--bg-primary)}
.page.active{opacity:1;transform:translateX(0);pointer-events:auto;z-index:2}
.bottom-nav{position:absolute;bottom:0;left:0;right:0;
  height:calc(var(--nav-height) + env(safe-area-inset-bottom,0px));
  padding-bottom:env(safe-area-inset-bottom,0px);
  display:flex;justify-content:space-around;align-items:center;
  background:var(--bg-card);border-top:1px solid var(--border-color);
  box-shadow:0 -2px 10px rgba(0,0,0,0.05);z-index:100}
.nav-item{display:flex;flex-direction:column;align-items:center;gap:2px;
  padding:8px 12px;border-radius:var(--radius-sm);
  transition:all .2s ease;min-width:56px;color:var(--text-hint)}
.nav-item.active{color:var(--accent-primary)}
.nav-item svg{width:24px;height:24px;fill:none;stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}
.nav-item .nav-text{font-size:10px;font-weight:500}
.nav-item .nav-icon-text{font-size:20px;font-weight:700;line-height:24px}
.section-title{font-size:18px;font-weight:700;margin-bottom:12px;color:var(--text-primary)}
.card{background:var(--bg-card);border-radius:var(--radius-md);padding:16px;
  box-shadow:var(--shadow-sm);border:1px solid var(--border-color)}
.btn{display:inline-flex;align-items:center;justify-content:center;
  padding:12px 24px;border-radius:var(--radius-sm);font-weight:600;font-size:15px;
  transition:all .2s ease;min-height:44px;min-width:44px}
.btn-primary{background:var(--accent-primary);color:#fff}
.btn-primary:active{transform:scale(0.96);opacity:0.9}
.btn-secondary{background:var(--bg-secondary);color:var(--text-primary);border:1px solid var(--border-color)}
.btn-success{background:var(--accent-success);color:#fff}
.btn-error{background:var(--accent-error);color:#fff}
.btn-block{width:100%;display:flex}
.pill-group{display:flex;gap:4px;background:var(--bg-secondary);border-radius:var(--radius-sm);padding:3px}
.pill{padding:8px 16px;border-radius:6px;font-size:13px;font-weight:500;transition:all .2s ease;color:var(--text-secondary)}
.pill.active{background:var(--bg-card);color:var(--text-primary);box-shadow:var(--shadow-sm)}
.progress-bar{width:100%;height:8px;background:var(--bg-secondary);border-radius:4px;overflow:hidden}
.progress-bar .fill{height:100%;border-radius:4px;transition:width .5s ease;background:var(--accent-primary)}
.badge{display:inline-flex;align-items:center;justify-content:center;
  padding:2px 8px;border-radius:10px;font-size:11px;font-weight:600;background:var(--accent-primary);color:#fff}
.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);
  z-index:200;display:flex;align-items:center;justify-content:center;padding:20px;
  opacity:0;pointer-events:none;transition:opacity .3s ease}
.modal-overlay.show{opacity:1;pointer-events:auto}
.modal{background:var(--bg-card);border-radius:var(--radius-lg);padding:24px;
  max-width:340px;width:100%;transform:scale(0.9);transition:transform .3s ease}
.modal-overlay.show .modal{transform:scale(1)}
.modal h3{font-size:18px;margin-bottom:12px}
.modal p{color:var(--text-secondary);margin-bottom:20px;font-size:14px;line-height:1.5}
.modal-actions{display:flex;gap:8px}
.modal-actions .btn{flex:1}
@keyframes correctBounce{0%{transform:scale(1)}30%{transform:scale(1.15)}50%{transform:scale(0.95)}70%{transform:scale(1.05)}100%{transform:scale(1)}}
@keyframes wrongShake{0%,100%{transform:translateX(0)}20%{transform:translateX(-8px)}40%{transform:translateX(8px)}60%{transform:translateX(-4px)}80%{transform:translateX(4px)}}
@keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes popIn{0%{transform:scale(0);opacity:0}70%{transform:scale(1.1)}100%{transform:scale(1);opacity:1}}
@keyframes confetti{0%{transform:translateY(0) rotate(0);opacity:1}100%{transform:translateY(400px) rotate(720deg);opacity:0}}
.anim-correct{animation:correctBounce .5s ease}
.anim-wrong{animation:wrongShake .4s ease}
.anim-fade-in{animation:fadeInUp .4s ease}
.anim-pop{animation:popIn .3s ease}
.greeting{font-size:22px;font-weight:700;margin-bottom:4px}
.greeting-sub{font-size:14px;color:var(--text-secondary);margin-bottom:20px}
.stats-row{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin:16px 0}
.stat-card{text-align:center;padding:14px 8px;background:var(--bg-card);
  border-radius:var(--radius-md);border:1px solid var(--border-color)}
.stat-value{font-size:28px;font-weight:800;color:var(--accent-primary)}
.stat-label{font-size:11px;color:var(--text-secondary);margin-top:4px}
.today-info{display:flex;gap:12px;margin:12px 0}
.today-chip{flex:1;padding:10px;border-radius:var(--radius-sm);text-align:center;
  background:var(--bg-secondary);font-size:13px}
.today-chip strong{display:block;font-size:20px;color:var(--accent-secondary);margin-bottom:2px}
.mini-chart{display:flex;align-items:flex-end;gap:6px;height:60px;padding:8px 0;margin-top:12px}
.mini-chart .bar{flex:1;background:var(--accent-primary);border-radius:3px 3px 0 0;
  min-height:4px;transition:height .5s ease;opacity:0.7}
.mini-chart .bar.today{opacity:1}
.chart-labels{display:flex;gap:6px;margin-top:4px}
.chart-labels span{flex:1;text-align:center;font-size:10px;color:var(--text-hint)}
.gojuon-controls{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap}
.gojuon-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:4px;margin-top:12px}
.gojuon-cell{aspect-ratio:1;display:flex;flex-direction:column;align-items:center;justify-content:center;
  background:var(--bg-card);border:1px solid var(--border-color);border-radius:var(--radius-sm);
  font-size:22px;cursor:pointer;transition:all .2s ease;position:relative}
.gojuon-cell:active{transform:scale(0.95)}
.gojuon-cell .romaji{font-size:10px;color:var(--text-hint);margin-top:2px}
.gojuon-cell.mastered{border-color:var(--accent-success);background:rgba(74,124,89,0.08)}
.gojuon-cell.empty{visibility:hidden}
.gojuon-row-label{grid-column:1/-1;font-size:13px;font-weight:600;color:var(--text-secondary);
  padding:8px 0 4px;border-bottom:1px solid var(--border-color)}
.flashcard-container{perspective:1000px;width:100%;max-width:300px;margin:20px auto}
.flashcard{position:relative;width:100%;height:200px;transition:transform .6s cubic-bezier(0.4,0,0.2,1);
  transform-style:preserve-3d;cursor:pointer}
.flashcard.flipped{transform:rotateY(180deg)}
.flashcard-face{position:absolute;width:100%;height:100%;backface-visibility:hidden;
  border-radius:var(--radius-md);display:flex;flex-direction:column;align-items:center;justify-content:center;
  box-shadow:var(--shadow-md);background:var(--bg-card);border:1px solid var(--border-color)}
.flashcard-back{transform:rotateY(180deg)}
.flashcard-face .char{font-size:64px;font-weight:700}
.flashcard-face .label{font-size:14px;color:var(--text-secondary);margin-top:8px}
.flashcard-face .romaji-big{font-size:36px;font-weight:600;color:var(--accent-primary)}
.flashcard-nav{display:flex;gap:12px;justify-content:center;margin-top:16px}
.quiz-header{text-align:center;margin-bottom:20px}
.quiz-question{font-size:48px;font-weight:700;text-align:center;margin:20px 0;min-height:70px}
.quiz-options{display:grid;grid-template-columns:1fr 1fr;gap:10px;max-width:320px;margin:0 auto}
.quiz-option{padding:16px;border-radius:var(--radius-md);background:var(--bg-card);
  border:2px solid var(--border-color);font-size:18px;font-weight:600;
  text-align:center;transition:all .2s ease;min-height:56px}
.quiz-option:active{transform:scale(0.96)}
.quiz-option.correct{border-color:var(--accent-success);background:rgba(74,124,89,0.15);color:var(--accent-success)}
.quiz-option.wrong{border-color:var(--accent-error);background:rgba(178,34,52,0.1);color:var(--accent-error)}
.quiz-feedback{text-align:center;margin-top:16px;font-size:16px;font-weight:600;min-height:24px}
.vocab-card-container{perspective:1000px;width:100%;max-width:340px;margin:16px auto;touch-action:pan-y}
.vocab-card{position:relative;width:100%;min-height:240px;transition:transform .6s cubic-bezier(0.4,0,0.2,1);
  transform-style:preserve-3d;cursor:pointer}
.vocab-card.flipped{transform:rotateY(180deg)}
.vocab-face{position:absolute;width:100%;min-height:240px;backface-visibility:hidden;
  border-radius:var(--radius-lg);padding:24px;
  box-shadow:var(--shadow-md);background:var(--bg-card);border:1px solid var(--border-color)}
.vocab-back{transform:rotateY(180deg)}
.vocab-face .word{font-size:48px;font-weight:800;text-align:center;margin:24px 0 8px}
.vocab-face .hint{font-size:13px;color:var(--text-hint);text-align:center}
.vocab-back .reading{font-size:24px;font-weight:600;text-align:center;color:var(--accent-primary);margin-bottom:4px}
.vocab-back .romaji-sm{font-size:13px;color:var(--text-hint);text-align:center;margin-bottom:8px}
.vocab-back .meaning{font-size:28px;font-weight:700;text-align:center;margin-bottom:4px}
.vocab-back .pos{font-size:12px;color:var(--text-secondary);text-align:center;margin-bottom:12px}
.vocab-back .example{background:var(--bg-secondary);padding:10px;border-radius:var(--radius-sm);font-size:13px;line-height:1.6}
.vocab-back .example .ja{font-weight:600}
.vocab-back .example .zh{color:var(--text-secondary);margin-top:2px}
.vocab-rating{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-top:12px;max-width:340px;margin-left:auto;margin-right:auto}
.rate-btn{padding:10px 4px;border-radius:var(--radius-sm);font-size:12px;font-weight:600;color:#fff;text-align:center}
.rate-btn.r1{background:var(--accent-error)}
.rate-btn.r2{background:#E67E22}
.rate-btn.r3{background:var(--accent-warning)}
.rate-btn.r4{background:var(--accent-success)}
.vocab-progress{display:flex;align-items:center;gap:8px;margin-bottom:12px}
.vocab-progress .count{font-size:14px;color:var(--text-secondary);white-space:nowrap}
.vocab-empty{text-align:center;padding:40px 20px;color:var(--text-secondary)}
.vocab-empty .emoji{font-size:48px;margin-bottom:12px}
.vocab-complete{text-align:center;padding:30px 20px}
.vocab-complete .emoji{font-size:64px;margin-bottom:16px}
.vocab-complete h2{margin-bottom:8px}
.vocab-complete .stats{color:var(--text-secondary);margin-bottom:20px;line-height:1.8}
.quiz-setup{max-width:340px;margin:0 auto}
.quiz-setup h2{text-align:center;margin-bottom:20px}
.quiz-type-list{display:flex;flex-direction:column;gap:8px;margin-bottom:20px}
.quiz-type-item{padding:14px;border-radius:var(--radius-md);background:var(--bg-card);
  border:2px solid var(--border-color);cursor:pointer;transition:all .2s ease}
.quiz-type-item.selected{border-color:var(--accent-primary);background:rgba(196,30,58,0.05)}
.quiz-type-item h4{font-size:15px;margin-bottom:2px}
.quiz-type-item p{font-size:12px;color:var(--text-secondary)}
.quiz-count{display:flex;align-items:center;justify-content:center;gap:16px;margin:16px 0}
.quiz-count .num{font-size:32px;font-weight:800;min-width:50px;text-align:center}
.quiz-count button{width:40px;height:40px;border-radius:50%;background:var(--bg-secondary);
  font-size:20px;font-weight:700;display:flex;align-items:center;justify-content:center;border:1px solid var(--border-color)}
.quiz-result{text-align:center;padding:20px}
.result-circle{width:140px;height:140px;border-radius:50%;margin:0 auto 20px;
  display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative}
.result-circle .pct{font-size:36px;font-weight:800}
.result-circle .pct-label{font-size:12px;color:var(--text-secondary)}
.wrong-list{text-align:left;margin:16px 0}
.wrong-item{padding:10px;border-radius:var(--radius-sm);background:var(--bg-secondary);margin-bottom:6px;font-size:14px}
.wrong-item .q{font-weight:600}
.wrong-item .a{color:var(--accent-error);font-size:12px}
.wrong-item .c{color:var(--accent-success);font-size:12px}
.typing-input{width:100%;max-width:300px;margin:0 auto;display:block;padding:14px;
  font-size:24px;text-align:center;border-radius:var(--radius-md);
  background:var(--bg-card);border:2px solid var(--border-color);transition:border-color .2s ease}
.typing-input:focus{border-color:var(--accent-primary)}
.typing-feedback{text-align:center;margin-top:12px;font-size:15px;font-weight:600;min-height:24px}
.settings-group{margin-bottom:24px}
.settings-group-title{font-size:13px;color:var(--text-secondary);font-weight:600;
  text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
.settings-item{display:flex;align-items:center;justify-content:space-between;
  padding:14px;background:var(--bg-card);border:1px solid var(--border-color);
  border-radius:var(--radius-sm);margin-bottom:6px}
.settings-item .label{font-size:15px}
.settings-item .value{color:var(--text-secondary);font-size:14px}
.theme-btns{display:flex;gap:4px}
.theme-btn{padding:8px 14px;border-radius:6px;font-size:13px;font-weight:500;
  background:var(--bg-secondary);border:1px solid transparent;transition:all .2s ease}
.theme-btn.active{background:var(--accent-primary);color:#fff}
.daily-adj{display:flex;align-items:center;gap:10px}
.daily-adj button{width:32px;height:32px;border-radius:50%;background:var(--bg-secondary);
  font-size:18px;font-weight:700;display:flex;align-items:center;justify-content:center;border:1px solid var(--border-color)}
.daily-adj .num{font-size:18px;font-weight:700;min-width:30px;text-align:center}
.danger-btn{width:100%;padding:14px;border-radius:var(--radius-sm);
  background:rgba(178,34,52,0.1);color:var(--accent-error);font-weight:600;font-size:15px;
  border:1px solid var(--accent-error);text-align:center;transition:all .2s ease}
.danger-btn:active{background:var(--accent-error);color:#fff}
.version-info{text-align:center;color:var(--text-hint);font-size:12px;margin-top:20px}
.file-input{display:none}
.sound-btn{display:inline-flex;align-items:center;justify-content:center;
  width:40px;height:40px;border-radius:50%;background:var(--bg-secondary);
  border:1px solid var(--border-color);cursor:pointer;transition:all .2s ease;
  position:relative;overflow:hidden;flex-shrink:0}
.sound-btn:active{transform:scale(0.9)}
.sound-btn svg{width:20px;height:20px;fill:none;stroke:var(--accent-primary);stroke-width:2;stroke-linecap:round;stroke-linejoin:round}
.sound-btn.playing{background:var(--accent-primary);border-color:var(--accent-primary)}
.sound-btn.playing svg{stroke:#fff}
@keyframes soundPulse{0%{box-shadow:0 0 0 0 rgba(196,30,58,0.4)}70%{box-shadow:0 0 0 10px rgba(196,30,58,0)}100%{box-shadow:0 0 0 0 rgba(196,30,58,0)}}
.sound-btn.playing{animation:soundPulse .8s ease}
.sound-btn-sm{width:32px;height:32px}
.sound-btn-sm svg{width:16px;height:16px}
.webview-banner{position:fixed;top:0;left:0;right:0;z-index:300;
  background:var(--accent-primary);color:#fff;padding:10px 16px;
  display:flex;align-items:center;gap:10px;font-size:13px;line-height:1.4;
  box-shadow:0 2px 8px rgba(0,0,0,0.2);max-width:480px;margin:0 auto}
.webview-banner .banner-text{flex:1}
.webview-banner .banner-btn{padding:6px 14px;border-radius:6px;
  background:#fff;color:var(--accent-primary);font-weight:700;font-size:13px;
  white-space:nowrap;flex-shrink:0}
.webview-banner .banner-close{width:28px;height:28px;display:flex;
  align-items:center;justify-content:center;font-size:18px;opacity:0.8;flex-shrink:0}
/* Achievement */
.achievement-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.achievement-item{text-align:center;padding:12px 4px;background:var(--bg-card);
  border-radius:var(--radius-md);border:1px solid var(--border-color);transition:all .3s ease}
.achievement-item.unlocked{border-color:var(--accent-warning);background:rgba(212,160,23,0.05)}
.achievement-item.locked{opacity:0.4;filter:grayscale(1)}
.achievement-item .ach-icon{font-size:32px;margin-bottom:4px}
.achievement-item .ach-name{font-size:11px;font-weight:600}
.achievement-item .ach-desc{font-size:9px;color:var(--text-hint);margin-top:2px}
.achievement-toast{position:fixed;top:20px;left:50%;transform:translateX(-50%) translateY(-100px);
  z-index:400;background:var(--accent-warning);color:#fff;padding:12px 20px;
  border-radius:var(--radius-md);box-shadow:var(--shadow-lg);
  display:flex;align-items:center;gap:10px;font-weight:600;
  transition:transform .5s cubic-bezier(0.34,1.56,0.64,1);white-space:nowrap}
.achievement-toast.show{transform:translateX(-50%) translateY(0)}
.achievement-toast .toast-icon{font-size:28px}
/* Swipe indicator */
.swipe-hint{text-align:center;font-size:12px;color:var(--text-hint);margin-top:8px}
/* Error book */
.error-card{padding:12px;background:var(--bg-card);border:1px solid var(--border-color);
  border-radius:var(--radius-sm);margin-bottom:8px;display:flex;justify-content:space-between;align-items:center;gap:8px}
.error-card .error-word{font-size:18px;font-weight:700}
.error-card .error-info{font-size:12px;color:var(--text-secondary)}
.error-card .error-count{font-size:11px;color:var(--accent-error);font-weight:600}
/* Install prompt */
.install-btn{width:100%;padding:14px;border-radius:var(--radius-sm);
  background:var(--accent-secondary);color:#fff;font-weight:600;font-size:15px;
  text-align:center;transition:all .2s ease;display:none}
.install-btn:active{opacity:0.8}
/* Writing practice */
.writing-grid{width:200px;height:200px;margin:20px auto;border:2px solid var(--border-color);
  border-radius:var(--radius-md);position:relative;background:var(--bg-card)}
.writing-grid::before,.writing-grid::after{content:'';position:absolute;background:var(--border-color)}
.writing-grid::before{left:50%;top:0;width:1px;height:100%;opacity:0.3}
.writing-grid::after{top:50%;left:0;width:100%;height:1px;opacity:0.3}
.writing-char{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
  font-size:120px;font-weight:300;color:var(--text-primary);transition:opacity .5s ease}
.writing-char.dim{opacity:0.1}
</style>
</head>
<body>
<div class="webview-banner" id="webview-banner" style="display:none;flex-wrap:wrap">
  <div class="banner-text">üîá ÁÑ°Ê≥ïÊí≠ÊîæËÅ≤Èü≥ÔºåË´ãÈªûÂè≥‰∏ä ‚ãÆ ÈÅ∏„ÄåÂú®ÁÄèË¶ΩÂô®‰∏≠ÈñãÂïü„Äç</div>
  <button class="banner-btn" id="copy-url-btn" onclick="navigator.clipboard.writeText(location.href).then(()=>{this.textContent='‚úÖ Â∑≤Ë§áË£Ω'}).catch(()=>{prompt('Ë§áË£ΩÊ≠§Á∂≤ÂùÄÂà∞ÁÄèË¶ΩÂô®ÈñãÂïüÔºö',location.href)})">Ë§áË£ΩÁ∂≤ÂùÄ</button>
  <button class="banner-close" onclick="document.getElementById('webview-banner').style.display='none';document.querySelectorAll('.page').forEach(p=>p.style.paddingTop='')">‚úï</button>
</div>
<div class="achievement-toast" id="ach-toast"><span class="toast-icon"></span><span class="toast-text"></span></div>
<div id="app">
<div class="page active" id="page-home"><div id="home-content"></div></div>
<div class="page" id="page-gojuon">
  <div class="section-title">‰∫îÂçÅÈü≥Á∑¥Áøí</div>
  <div class="gojuon-controls">
    <div class="pill-group" id="gojuon-script-pills">
      <button class="pill active" data-script="hiragana">Âπ≥ÂÅáÂêç</button>
      <button class="pill" data-script="katakana">ÁâáÂÅáÂêç</button>
      <button class="pill" data-script="both">Â∞çÁÖß</button>
    </div>
  </div>
  <div class="pill-group" id="gojuon-mode-pills" style="margin-bottom:12px">
    <button class="pill active" data-mode="chart">Ë°®Ê†º</button>
    <button class="pill" data-mode="flashcard">Âç°Áâá</button>
    <button class="pill" data-mode="quiz">Ê∏¨È©ó</button>
    <button class="pill" data-mode="writing">Êõ∏ÂØ´</button>
  </div>
  <div id="gojuon-content"></div>
</div>
<div class="page" id="page-vocab"><div class="section-title">ÂçòË™ûÂ≠∏Áøí</div><div id="vocab-content"></div></div>
<div class="page" id="page-quiz"><div class="section-title">„ÉÜ„Çπ„Éà</div><div id="quiz-content"></div></div>
<div class="page" id="page-settings"><div class="section-title">Ë®≠ÂÆö</div><div id="settings-content"></div></div>
<nav class="bottom-nav" id="bottom-nav">
  <button class="nav-item active" data-page="home">
    <svg viewBox="0 0 24 24"><path d="M3 12L12 3l9 9"/><path d="M5 10v9a1 1 0 001 1h4v-5h4v5h4a1 1 0 001-1v-9"/></svg>
    <span class="nav-text">„Éõ„Éº„É†</span>
  </button>
  <button class="nav-item" data-page="gojuon"><span class="nav-icon-text">„ÅÇ</span><span class="nav-text">‰∫îÂçÅÈü≥</span></button>
  <button class="nav-item" data-page="vocab">
    <svg viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/></svg>
    <span class="nav-text">ÂçòË™û</span>
  </button>
  <button class="nav-item" data-page="quiz">
    <svg viewBox="0 0 24 24"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
    <span class="nav-text">„ÉÜ„Çπ„Éà</span>
  </button>
  <button class="nav-item" data-page="settings">
    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
    <span class="nav-text">Ë®≠ÂÆö</span>
  </button>
</nav>
<div class="modal-overlay" id="modal-overlay">
  <div class="modal" id="modal-box"><h3 id="modal-title"></h3><p id="modal-msg"></p><div class="modal-actions" id="modal-actions"></div></div>
</div>
</div>
<script>
// ================================================================
// DATA: ‰∫îÂçÅÈü≥
// ================================================================
const GOJUON={
seion:[
{r:"a",h:"„ÅÇ",k:"„Ç¢",row:"vowel"},{r:"i",h:"„ÅÑ",k:"„Ç§",row:"vowel"},{r:"u",h:"„ÅÜ",k:"„Ç¶",row:"vowel"},{r:"e",h:"„Åà",k:"„Ç®",row:"vowel"},{r:"o",h:"„Åä",k:"„Ç™",row:"vowel"},
{r:"ka",h:"„Åã",k:"„Ç´",row:"k"},{r:"ki",h:"„Åç",k:"„Ç≠",row:"k"},{r:"ku",h:"„Åè",k:"„ÇØ",row:"k"},{r:"ke",h:"„Åë",k:"„Ç±",row:"k"},{r:"ko",h:"„Åì",k:"„Ç≥",row:"k"},
{r:"sa",h:"„Åï",k:"„Çµ",row:"s"},{r:"shi",h:"„Åó",k:"„Ç∑",row:"s"},{r:"su",h:"„Åô",k:"„Çπ",row:"s"},{r:"se",h:"„Åõ",k:"„Çª",row:"s"},{r:"so",h:"„Åù",k:"„ÇΩ",row:"s"},
{r:"ta",h:"„Åü",k:"„Çø",row:"t"},{r:"chi",h:"„Å°",k:"„ÉÅ",row:"t"},{r:"tsu",h:"„Å§",k:"„ÉÑ",row:"t"},{r:"te",h:"„Å¶",k:"„ÉÜ",row:"t"},{r:"to",h:"„Å®",k:"„Éà",row:"t"},
{r:"na",h:"„Å™",k:"„Éä",row:"n"},{r:"ni",h:"„Å´",k:"„Éã",row:"n"},{r:"nu",h:"„Å¨",k:"„Éå",row:"n"},{r:"ne",h:"„Å≠",k:"„Éç",row:"n"},{r:"no",h:"„ÅÆ",k:"„Éé",row:"n"},
{r:"ha",h:"„ÅØ",k:"„Éè",row:"h"},{r:"hi",h:"„Å≤",k:"„Éí",row:"h"},{r:"fu",h:"„Åµ",k:"„Éï",row:"h"},{r:"he",h:"„Å∏",k:"„Éò",row:"h"},{r:"ho",h:"„Åª",k:"„Éõ",row:"h"},
{r:"ma",h:"„Åæ",k:"„Éû",row:"m"},{r:"mi",h:"„Åø",k:"„Éü",row:"m"},{r:"mu",h:"„ÇÄ",k:"„É†",row:"m"},{r:"me",h:"„ÇÅ",k:"„É°",row:"m"},{r:"mo",h:"„ÇÇ",k:"„É¢",row:"m"},
{r:"ya",h:"„ÇÑ",k:"„É§",row:"y"},{r:"yu",h:"„ÇÜ",k:"„É¶",row:"y"},{r:"yo",h:"„Çà",k:"„É®",row:"y"},
{r:"ra",h:"„Çâ",k:"„É©",row:"r"},{r:"ri",h:"„Çä",k:"„É™",row:"r"},{r:"ru",h:"„Çã",k:"„É´",row:"r"},{r:"re",h:"„Çå",k:"„É¨",row:"r"},{r:"ro",h:"„Çç",k:"„É≠",row:"r"},
{r:"wa",h:"„Çè",k:"„ÉØ",row:"w"},{r:"wo",h:"„Çí",k:"„É≤",row:"w"},
{r:"n",h:"„Çì",k:"„É≥",row:"nn"}
],
dakuon:[
{r:"ga",h:"„Åå",k:"„Ç¨",row:"g"},{r:"gi",h:"„Åé",k:"„ÇÆ",row:"g"},{r:"gu",h:"„Åê",k:"„Ç∞",row:"g"},{r:"ge",h:"„Åí",k:"„Ç≤",row:"g"},{r:"go",h:"„Åî",k:"„Ç¥",row:"g"},
{r:"za",h:"„Åñ",k:"„Ç∂",row:"z"},{r:"ji",h:"„Åò",k:"„Ç∏",row:"z"},{r:"zu",h:"„Åö",k:"„Ç∫",row:"z"},{r:"ze",h:"„Åú",k:"„Çº",row:"z"},{r:"zo",h:"„Åû",k:"„Çæ",row:"z"},
{r:"da",h:"„Å†",k:"„ÉÄ",row:"d"},{r:"di",h:"„Å¢",k:"„ÉÇ",row:"d"},{r:"du",h:"„Å•",k:"„ÉÖ",row:"d"},{r:"de",h:"„Åß",k:"„Éá",row:"d"},{r:"do",h:"„Å©",k:"„Éâ",row:"d"},
{r:"ba",h:"„Å∞",k:"„Éê",row:"b"},{r:"bi",h:"„Å≥",k:"„Éì",row:"b"},{r:"bu",h:"„Å∂",k:"„Éñ",row:"b"},{r:"be",h:"„Åπ",k:"„Éô",row:"b"},{r:"bo",h:"„Åº",k:"„Éú",row:"b"}
],
handakuon:[
{r:"pa",h:"„Å±",k:"„Éë",row:"p"},{r:"pi",h:"„Å¥",k:"„Éî",row:"p"},{r:"pu",h:"„Å∑",k:"„Éó",row:"p"},{r:"pe",h:"„Å∫",k:"„Éö",row:"p"},{r:"po",h:"„ÅΩ",k:"„Éù",row:"p"}
]
};
const ALL_KANA=[...GOJUON.seion,...GOJUON.dakuon,...GOJUON.handakuon];

// ================================================================
// DATA: N5 ÂñÆÂ≠ó (120ÂÄã)
// ================================================================
const VOCAB=[
// Êó•Â∏∏ÂãïË©û 15
{id:1,w:"È£ü„Åπ„Çã",rd:"„Åü„Åπ„Çã",ro:"taberu",m:"ÂêÉ",pos:"ÂãïË©ûII",cat:"verb",ex:{ja:"Êúù„Åî„ÅØ„Çì„ÇíÈ£ü„Åπ„Çã„ÄÇ",rd:"„ÅÇ„Åï„Åî„ÅØ„Çì„Çí„Åü„Åπ„Çã„ÄÇ",zh:"ÂêÉÊó©È§ê„ÄÇ"}},
{id:2,w:"È£≤„ÇÄ",rd:"„ÅÆ„ÇÄ",ro:"nomu",m:"Âñù",pos:"ÂãïË©ûI",cat:"verb",ex:{ja:"Ê∞¥„ÇíÈ£≤„ÇÄ„ÄÇ",rd:"„Åø„Åö„Çí„ÅÆ„ÇÄ„ÄÇ",zh:"ÂñùÊ∞¥„ÄÇ"}},
{id:3,w:"Ë°å„Åè",rd:"„ÅÑ„Åè",ro:"iku",m:"Âéª",pos:"ÂãïË©ûI",cat:"verb",ex:{ja:"Â≠¶Ê†°„Å´Ë°å„Åè„ÄÇ",rd:"„Åå„Å£„Åì„ÅÜ„Å´„ÅÑ„Åè„ÄÇ",zh:"ÂéªÂ≠∏Ê†°„ÄÇ"}},
{id:4,w:"Êù•„Çã",rd:"„Åè„Çã",ro:"kuru",m:"‰æÜ",pos:"ÂãïË©ûIII",cat:"verb",ex:{ja:"ÂèãÈÅî„ÅåÊù•„Çã„ÄÇ",rd:"„Å®„ÇÇ„Å†„Å°„Åå„Åè„Çã„ÄÇ",zh:"ÊúãÂèã‰æÜ‰∫Ü„ÄÇ"}},
{id:5,w:"Ë¶ã„Çã",rd:"„Åø„Çã",ro:"miru",m:"Áúã",pos:"ÂãïË©ûII",cat:"verb",ex:{ja:"Êò†Áîª„ÇíË¶ã„Çã„ÄÇ",rd:"„Åà„ÅÑ„Åå„Çí„Åø„Çã„ÄÇ",zh:"ÁúãÈõªÂΩ±„ÄÇ"}},
{id:6,w:"ËÅû„Åè",rd:"„Åç„Åè",ro:"kiku",m:"ËÅΩ;Âïè",pos:"ÂãïË©ûI",cat:"verb",ex:{ja:"Èü≥Ê•Ω„ÇíËÅû„Åè„ÄÇ",rd:"„Åä„Çì„Åå„Åè„Çí„Åç„Åè„ÄÇ",zh:"ËÅΩÈü≥Ê®Ç„ÄÇ"}},
{id:7,w:"Ë™≠„ÇÄ",rd:"„Çà„ÇÄ",ro:"yomu",m:"ËÆÄ",pos:"ÂãïË©ûI",cat:"verb",ex:{ja:"Êú¨„ÇíË™≠„ÇÄ„ÄÇ",rd:"„Åª„Çì„Çí„Çà„ÇÄ„ÄÇ",zh:"ËÆÄÊõ∏„ÄÇ"}},
{id:8,w:"Êõ∏„Åè",rd:"„Åã„Åè",ro:"kaku",m:"ÂØ´",pos:"ÂãïË©ûI",cat:"verb",ex:{ja:"ÊâãÁ¥ô„ÇíÊõ∏„Åè„ÄÇ",rd:"„Å¶„Åå„Åø„Çí„Åã„Åè„ÄÇ",zh:"ÂØ´‰ø°„ÄÇ"}},
{id:9,w:"Ë©±„Åô",rd:"„ÅØ„Å™„Åô",ro:"hanasu",m:"Ë™™Ë©±",pos:"ÂãïË©ûI",cat:"verb",ex:{ja:"Êó•Êú¨Ë™û„ÇíË©±„Åô„ÄÇ",rd:"„Å´„Åª„Çì„Åî„Çí„ÅØ„Å™„Åô„ÄÇ",zh:"Ë™™Êó•Ë™û„ÄÇ"}},
{id:10,w:"Ë≤∑„ÅÜ",rd:"„Åã„ÅÜ",ro:"kau",m:"Ë≤∑",pos:"ÂãïË©ûI",cat:"verb",ex:{ja:"„Éë„É≥„ÇíË≤∑„ÅÜ„ÄÇ",rd:"„Å±„Çì„Çí„Åã„ÅÜ„ÄÇ",zh:"Ë≤∑È∫µÂåÖ„ÄÇ"}},
{id:11,w:"Êïô„Åà„Çã",rd:"„Åä„Åó„Åà„Çã",ro:"oshieru",m:"Êïô",pos:"ÂãïË©ûII",cat:"verb",ex:{ja:"Ëã±Ë™û„ÇíÊïô„Åà„Çã„ÄÇ",rd:"„Åà„ÅÑ„Åî„Çí„Åä„Åó„Åà„Çã„ÄÇ",zh:"ÊïôËã±Ë™û„ÄÇ"}},
{id:12,w:"ÂãâÂº∑„Åô„Çã",rd:"„Åπ„Çì„Åç„Çá„ÅÜ„Åô„Çã",ro:"benkyousuru",m:"Â≠∏Áøí;Áî®Âäü",pos:"ÂãïË©ûIII",cat:"verb",ex:{ja:"ÊØéÊó•ÂãâÂº∑„Åô„Çã„ÄÇ",rd:"„Åæ„ÅÑ„Å´„Å°„Åπ„Çì„Åç„Çá„ÅÜ„Åô„Çã„ÄÇ",zh:"ÊØèÂ§©Â≠∏Áøí„ÄÇ"}},
{id:13,w:"ÂØù„Çã",rd:"„Å≠„Çã",ro:"neru",m:"Áù°Ë¶∫",pos:"ÂãïË©ûII",cat:"verb",ex:{ja:"Êó©„ÅèÂØù„Çã„ÄÇ",rd:"„ÅØ„ÇÑ„Åè„Å≠„Çã„ÄÇ",zh:"Êó©ÈªûÁù°„ÄÇ"}},
{id:14,w:"Ëµ∑„Åç„Çã",rd:"„Åä„Åç„Çã",ro:"okiru",m:"Ëµ∑Â∫ä",pos:"ÂãïË©ûII",cat:"verb",ex:{ja:"ÊúùÊó©„ÅèËµ∑„Åç„Çã„ÄÇ",rd:"„ÅÇ„Åï„ÅØ„ÇÑ„Åè„Åä„Åç„Çã„ÄÇ",zh:"Êó©‰∏äÊó©Ëµ∑„ÄÇ"}},
{id:15,w:"Ê≠©„Åè",rd:"„ÅÇ„Çã„Åè",ro:"aruku",m:"Ëµ∞Ë∑Ø",pos:"ÂãïË©ûI",cat:"verb",ex:{ja:"ÂÖ¨Âúí„ÇíÊ≠©„Åè„ÄÇ",rd:"„Åì„ÅÜ„Åà„Çì„Çí„ÅÇ„Çã„Åè„ÄÇ",zh:"Âú®ÂÖ¨ÂúíËµ∞Ë∑Ø„ÄÇ"}},
// Êó•Â∏∏ÂêçË©û 15
{id:16,w:"Â≠¶Ê†°",rd:"„Åå„Å£„Åì„ÅÜ",ro:"gakkou",m:"Â≠∏Ê†°",pos:"ÂêçË©û",cat:"noun",ex:{ja:"Â≠¶Ê†°„Å´Ë°å„Åè„ÄÇ",rd:"„Åå„Å£„Åì„ÅÜ„Å´„ÅÑ„Åè„ÄÇ",zh:"ÂéªÂ≠∏Ê†°„ÄÇ"}},
{id:17,w:"ÂÖàÁîü",rd:"„Åõ„Çì„Åõ„ÅÑ",ro:"sensei",m:"ËÄÅÂ∏´",pos:"ÂêçË©û",cat:"noun",ex:{ja:"ÂÖàÁîü„ÅØÂÑ™„Åó„ÅÑ„ÄÇ",rd:"„Åõ„Çì„Åõ„ÅÑ„ÅØ„ÇÑ„Åï„Åó„ÅÑ„ÄÇ",zh:"ËÄÅÂ∏´ÂæàÊ∫´Êüî„ÄÇ"}},
{id:18,w:"ÂèãÈÅî",rd:"„Å®„ÇÇ„Å†„Å°",ro:"tomodachi",m:"ÊúãÂèã",pos:"ÂêçË©û",cat:"noun",ex:{ja:"ÂèãÈÅî„Å®ÈÅä„Å∂„ÄÇ",rd:"„Å®„ÇÇ„Å†„Å°„Å®„ÅÇ„Åù„Å∂„ÄÇ",zh:"ÂíåÊúãÂèãÁé©„ÄÇ"}},
{id:19,w:"ÂÆ∂",rd:"„ÅÑ„Åà",ro:"ie",m:"ÂÆ∂",pos:"ÂêçË©û",cat:"noun",ex:{ja:"ÂÆ∂„Å´Â∏∞„Çã„ÄÇ",rd:"„ÅÑ„Åà„Å´„Åã„Åà„Çã„ÄÇ",zh:"ÂõûÂÆ∂„ÄÇ"}},
{id:20,w:"ÈßÖ",rd:"„Åà„Åç",ro:"eki",m:"ËªäÁ´ô",pos:"ÂêçË©û",cat:"noun",ex:{ja:"ÈßÖ„Åæ„ÅßÊ≠©„Åè„ÄÇ",rd:"„Åà„Åç„Åæ„Åß„ÅÇ„Çã„Åè„ÄÇ",zh:"Ëµ∞Âà∞ËªäÁ´ô„ÄÇ"}},
{id:21,w:"ÈõªËªä",rd:"„Åß„Çì„Åó„ÇÉ",ro:"densha",m:"ÈõªËªä",pos:"ÂêçË©û",cat:"noun",ex:{ja:"ÈõªËªä„Å´‰πó„Çã„ÄÇ",rd:"„Åß„Çì„Åó„ÇÉ„Å´„ÅÆ„Çã„ÄÇ",zh:"Êê≠ÈõªËªä„ÄÇ"}},
{id:22,w:"ÊôÇÈñì",rd:"„Åò„Åã„Çì",ro:"jikan",m:"ÊôÇÈñì",pos:"ÂêçË©û",cat:"noun",ex:{ja:"ÊôÇÈñì„Åå„Å™„ÅÑ„ÄÇ",rd:"„Åò„Åã„Çì„Åå„Å™„ÅÑ„ÄÇ",zh:"Ê≤íÊúâÊôÇÈñì„ÄÇ"}},
{id:23,w:"Â§©Ê∞ó",rd:"„Å¶„Çì„Åç",ro:"tenki",m:"Â§©Ê∞£",pos:"ÂêçË©û",cat:"noun",ex:{ja:"‰ªäÊó•„ÅØÂ§©Ê∞ó„Åå„ÅÑ„ÅÑ„ÄÇ",rd:"„Åç„Çá„ÅÜ„ÅØ„Å¶„Çì„Åç„Åå„ÅÑ„ÅÑ„ÄÇ",zh:"‰ªäÂ§©Â§©Ê∞£Â•Ω„ÄÇ"}},
{id:24,w:"Ê∞¥",rd:"„Åø„Åö",ro:"mizu",m:"Ê∞¥",pos:"ÂêçË©û",cat:"noun",ex:{ja:"Ê∞¥„ÇíÈ£≤„ÇÄ„ÄÇ",rd:"„Åø„Åö„Çí„ÅÆ„ÇÄ„ÄÇ",zh:"ÂñùÊ∞¥„ÄÇ"}},
{id:25,w:"Êú¨",rd:"„Åª„Çì",ro:"hon",m:"Êõ∏",pos:"ÂêçË©û",cat:"noun",ex:{ja:"Êú¨„ÇíË™≠„ÇÄ„ÄÇ",rd:"„Åª„Çì„Çí„Çà„ÇÄ„ÄÇ",zh:"ËÆÄÊõ∏„ÄÇ"}},
{id:26,w:"ÈõªË©±",rd:"„Åß„Çì„Çè",ro:"denwa",m:"ÈõªË©±",pos:"ÂêçË©û",cat:"noun",ex:{ja:"ÈõªË©±„Çí„Åã„Åë„Çã„ÄÇ",rd:"„Åß„Çì„Çè„Çí„Åã„Åë„Çã„ÄÇ",zh:"ÊâìÈõªË©±„ÄÇ"}},
{id:27,w:"Êñ∞ËÅû",rd:"„Åó„Çì„Å∂„Çì",ro:"shinbun",m:"Â†±Á¥ô",pos:"ÂêçË©û",cat:"noun",ex:{ja:"Êñ∞ËÅû„ÇíË™≠„ÇÄ„ÄÇ",rd:"„Åó„Çì„Å∂„Çì„Çí„Çà„ÇÄ„ÄÇ",zh:"ËÆÄÂ†±Á¥ô„ÄÇ"}},
{id:28,w:"Êò†Áîª",rd:"„Åà„ÅÑ„Åå",ro:"eiga",m:"ÈõªÂΩ±",pos:"ÂêçË©û",cat:"noun",ex:{ja:"Êò†Áîª„ÇíË¶ã„Çã„ÄÇ",rd:"„Åà„ÅÑ„Åå„Çí„Åø„Çã„ÄÇ",zh:"ÁúãÈõªÂΩ±„ÄÇ"}},
{id:29,w:"Èü≥Ê•Ω",rd:"„Åä„Çì„Åå„Åè",ro:"ongaku",m:"Èü≥Ê®Ç",pos:"ÂêçË©û",cat:"noun",ex:{ja:"Èü≥Ê•Ω„ÇíËÅû„Åè„ÄÇ",rd:"„Åä„Çì„Åå„Åè„Çí„Åç„Åè„ÄÇ",zh:"ËÅΩÈü≥Ê®Ç„ÄÇ"}},
{id:30,w:"ÂÜôÁúü",rd:"„Åó„ÇÉ„Åó„Çì",ro:"shashin",m:"ÁÖßÁâá",pos:"ÂêçË©û",cat:"noun",ex:{ja:"ÂÜôÁúü„ÇíÊíÆ„Çã„ÄÇ",rd:"„Åó„ÇÉ„Åó„Çì„Çí„Å®„Çã„ÄÇ",zh:"ÊãçÁÖß„ÄÇ"}},
// ÂΩ¢ÂÆπË©û 10
{id:31,w:"Â§ß„Åç„ÅÑ",rd:"„Åä„Åä„Åç„ÅÑ",ro:"ookii",m:"Â§ßÁöÑ",pos:"„ÅÑÂΩ¢ÂÆπË©û",cat:"adj",ex:{ja:"Â§ß„Åç„ÅÑÁä¨„Åå„ÅÑ„Çã„ÄÇ",rd:"„Åä„Åä„Åç„ÅÑ„ÅÑ„Å¨„Åå„ÅÑ„Çã„ÄÇ",zh:"Êúâ‰∏ÄÈöªÂ§ßÁãó„ÄÇ"}},
{id:32,w:"Â∞è„Åï„ÅÑ",rd:"„Å°„ÅÑ„Åï„ÅÑ",ro:"chiisai",m:"Â∞èÁöÑ",pos:"„ÅÑÂΩ¢ÂÆπË©û",cat:"adj",ex:{ja:"Â∞è„Åï„ÅÑÁå´„ÅåÂ•Ω„Åç„ÄÇ",rd:"„Å°„ÅÑ„Åï„ÅÑ„Å≠„Åì„Åå„Åô„Åç„ÄÇ",zh:"ÂñúÊ≠°Â∞èË≤ì„ÄÇ"}},
{id:33,w:"È´ò„ÅÑ",rd:"„Åü„Åã„ÅÑ",ro:"takai",m:"È´òÁöÑ;Ë≤¥ÁöÑ",pos:"„ÅÑÂΩ¢ÂÆπË©û",cat:"adj",ex:{ja:"„Åì„ÅÆÂ±±„ÅØÈ´ò„ÅÑ„ÄÇ",rd:"„Åì„ÅÆ„ÇÑ„Åæ„ÅØ„Åü„Åã„ÅÑ„ÄÇ",zh:"ÈÄôÂ∫ßÂ±±ÂæàÈ´ò„ÄÇ"}},
{id:34,w:"ÂÆâ„ÅÑ",rd:"„ÇÑ„Åô„ÅÑ",ro:"yasui",m:"‰æøÂÆúÁöÑ",pos:"„ÅÑÂΩ¢ÂÆπË©û",cat:"adj",ex:{ja:"„Åì„ÅÆÂ∫ó„ÅØÂÆâ„ÅÑ„ÄÇ",rd:"„Åì„ÅÆ„Åø„Åõ„ÅØ„ÇÑ„Åô„ÅÑ„ÄÇ",zh:"ÈÄôÂÆ∂Â∫óÂæà‰æøÂÆú„ÄÇ"}},
{id:35,w:"Êñ∞„Åó„ÅÑ",rd:"„ÅÇ„Åü„Çâ„Åó„ÅÑ",ro:"atarashii",m:"Êñ∞ÁöÑ",pos:"„ÅÑÂΩ¢ÂÆπË©û",cat:"adj",ex:{ja:"Êñ∞„Åó„ÅÑÈù¥„ÇíË≤∑„Å£„Åü„ÄÇ",rd:"„ÅÇ„Åü„Çâ„Åó„ÅÑ„Åè„Å§„Çí„Åã„Å£„Åü„ÄÇ",zh:"Ë≤∑‰∫ÜÊñ∞Èûã„ÄÇ"}},
{id:36,w:"Âè§„ÅÑ",rd:"„Åµ„Çã„ÅÑ",ro:"furui",m:"ËàäÁöÑ",pos:"„ÅÑÂΩ¢ÂÆπË©û",cat:"adj",ex:{ja:"Âè§„ÅÑÊú¨„ÇíË™≠„ÇÄ„ÄÇ",rd:"„Åµ„Çã„ÅÑ„Åª„Çì„Çí„Çà„ÇÄ„ÄÇ",zh:"ËÆÄËàäÊõ∏„ÄÇ"}},
{id:37,w:"ËâØ„ÅÑ",rd:"„ÅÑ„ÅÑ",ro:"ii",m:"Â•ΩÁöÑ",pos:"„ÅÑÂΩ¢ÂÆπË©û",cat:"adj",ex:{ja:"Â§©Ê∞ó„ÅåËâØ„ÅÑ„ÄÇ",rd:"„Å¶„Çì„Åç„Åå„ÅÑ„ÅÑ„ÄÇ",zh:"Â§©Ê∞£Â•Ω„ÄÇ"}},
{id:38,w:"ÊÇ™„ÅÑ",rd:"„Çè„Çã„ÅÑ",ro:"warui",m:"Â£ûÁöÑ",pos:"„ÅÑÂΩ¢ÂÆπË©û",cat:"adj",ex:{ja:"Ê∞óÂàÜ„ÅåÊÇ™„ÅÑ„ÄÇ",rd:"„Åç„Å∂„Çì„Åå„Çè„Çã„ÅÑ„ÄÇ",zh:"ÂøÉÊÉÖ‰∏çÂ•Ω„ÄÇ"}},
{id:39,w:"Êöë„ÅÑ",rd:"„ÅÇ„Å§„ÅÑ",ro:"atsui",m:"ÁÜ±ÁöÑ(Â§©Ê∞£)",pos:"„ÅÑÂΩ¢ÂÆπË©û",cat:"adj",ex:{ja:"‰ªäÊó•„ÅØÊöë„ÅÑ„ÄÇ",rd:"„Åç„Çá„ÅÜ„ÅØ„ÅÇ„Å§„ÅÑ„ÄÇ",zh:"‰ªäÂ§©ÂæàÁÜ±„ÄÇ"}},
{id:40,w:"ÂØí„ÅÑ",rd:"„Åï„ÇÄ„ÅÑ",ro:"samui",m:"ÂÜ∑ÁöÑ(Â§©Ê∞£)",pos:"„ÅÑÂΩ¢ÂÆπË©û",cat:"adj",ex:{ja:"ÂÜ¨„ÅØÂØí„ÅÑ„ÄÇ",rd:"„Åµ„ÇÜ„ÅØ„Åï„ÇÄ„ÅÑ„ÄÇ",zh:"ÂÜ¨Â§©ÂæàÂÜ∑„ÄÇ"}},
// Â†¥ÊâÄ 8
{id:41,w:"ÁóÖÈô¢",rd:"„Å≥„Çá„ÅÜ„ÅÑ„Çì",ro:"byouin",m:"ÈÜ´Èô¢",pos:"ÂêçË©û",cat:"place",ex:{ja:"ÁóÖÈô¢„Å´Ë°å„Åè„ÄÇ",rd:"„Å≥„Çá„ÅÜ„ÅÑ„Çì„Å´„ÅÑ„Åè„ÄÇ",zh:"ÂéªÈÜ´Èô¢„ÄÇ"}},
{id:42,w:"ÈäÄË°å",rd:"„Åé„Çì„Åì„ÅÜ",ro:"ginkou",m:"ÈäÄË°å",pos:"ÂêçË©û",cat:"place",ex:{ja:"ÈäÄË°å„Åß„ÅäÈáë„Çí‰∏ã„Çç„Åô„ÄÇ",rd:"„Åé„Çì„Åì„ÅÜ„Åß„Åä„Åã„Å≠„Çí„Åä„Çç„Åô„ÄÇ",zh:"Âú®ÈäÄË°åÈ†òÈå¢„ÄÇ"}},
{id:43,w:"ÈÉµ‰æøÂ±Ä",rd:"„ÇÜ„ÅÜ„Å≥„Çì„Åç„Çá„Åè",ro:"yuubinkyoku",m:"ÈÉµÂ±Ä",pos:"ÂêçË©û",cat:"place",ex:{ja:"ÈÉµ‰æøÂ±Ä„ÅßÊâãÁ¥ô„ÇíÂá∫„Åô„ÄÇ",rd:"„ÇÜ„ÅÜ„Å≥„Çì„Åç„Çá„Åè„Åß„Å¶„Åå„Åø„Çí„Å†„Åô„ÄÇ",zh:"Âú®ÈÉµÂ±ÄÂØÑ‰ø°„ÄÇ"}},
{id:44,w:"Âõ≥Êõ∏È§®",rd:"„Å®„Åó„Çá„Åã„Çì",ro:"toshokan",m:"ÂúñÊõ∏È§®",pos:"ÂêçË©û",cat:"place",ex:{ja:"Âõ≥Êõ∏È§®„ÅßÂãâÂº∑„Åô„Çã„ÄÇ",rd:"„Å®„Åó„Çá„Åã„Çì„Åß„Åπ„Çì„Åç„Çá„ÅÜ„Åô„Çã„ÄÇ",zh:"Âú®ÂúñÊõ∏È§®ËÆÄÊõ∏„ÄÇ"}},
{id:45,w:"ÂÖ¨Âúí",rd:"„Åì„ÅÜ„Åà„Çì",ro:"kouen",m:"ÂÖ¨Âúí",pos:"ÂêçË©û",cat:"place",ex:{ja:"ÂÖ¨Âúí„ÅßÈÅä„Å∂„ÄÇ",rd:"„Åì„ÅÜ„Åà„Çì„Åß„ÅÇ„Åù„Å∂„ÄÇ",zh:"Âú®ÂÖ¨ÂúíÁé©„ÄÇ"}},
{id:46,w:"„É¨„Çπ„Éà„É©„É≥",rd:"„Çå„Åô„Å®„Çâ„Çì",ro:"resutoran",m:"È§êÂª≥",pos:"ÂêçË©û",cat:"place",ex:{ja:"„É¨„Çπ„Éà„É©„É≥„ÅßÈ£ü„Åπ„Çã„ÄÇ",rd:"„Çå„Åô„Å®„Çâ„Çì„Åß„Åü„Åπ„Çã„ÄÇ",zh:"Âú®È§êÂª≥ÂêÉÈ£Ø„ÄÇ"}},
{id:47,w:"„Ç≥„É≥„Éì„Éã",rd:"„Åì„Çì„Å≥„Å´",ro:"konbini",m:"‰æøÂà©ÂïÜÂ∫ó",pos:"ÂêçË©û",cat:"place",ex:{ja:"„Ç≥„É≥„Éì„Éã„ÅßË≤∑„ÅÜ„ÄÇ",rd:"„Åì„Çì„Å≥„Å´„Åß„Åã„ÅÜ„ÄÇ",zh:"Âú®‰æøÂà©ÂïÜÂ∫óË≤∑„ÄÇ"}},
{id:48,w:"„Çπ„Éº„Éë„Éº",rd:"„Åô„Éº„Å±„Éº",ro:"suupaa",m:"Ë∂ÖÂ∏Ç",pos:"ÂêçË©û",cat:"place",ex:{ja:"„Çπ„Éº„Éë„Éº„ÅßÈáéËèú„ÇíË≤∑„ÅÜ„ÄÇ",rd:"„Åô„Éº„Å±„Éº„Åß„ÇÑ„Åï„ÅÑ„Çí„Åã„ÅÜ„ÄÇ",zh:"Âú®Ë∂ÖÂ∏ÇË≤∑Ëî¨Ëèú„ÄÇ"}},
// ‰∫∫Áâ© 8
{id:49,w:"„ÅäÁà∂„Åï„Çì",rd:"„Åä„Å®„ÅÜ„Åï„Çì",ro:"otousan",m:"Áà∏Áà∏",pos:"ÂêçË©û",cat:"people",ex:{ja:"„ÅäÁà∂„Åï„Çì„ÅØ‰ºöÁ§æÂì°„Åß„Åô„ÄÇ",rd:"„Åä„Å®„ÅÜ„Åï„Çì„ÅØ„Åã„ÅÑ„Åó„ÇÉ„ÅÑ„Çì„Åß„Åô„ÄÇ",zh:"Áà∏Áà∏ÊòØ‰∏äÁè≠Êóè„ÄÇ"}},
{id:50,w:"„ÅäÊØç„Åï„Çì",rd:"„Åä„Åã„ÅÇ„Åï„Çì",ro:"okaasan",m:"Â™ΩÂ™Ω",pos:"ÂêçË©û",cat:"people",ex:{ja:"„ÅäÊØç„Åï„Çì„ÅØÊñôÁêÜ„Åå‰∏äÊâã„ÄÇ",rd:"„Åä„Åã„ÅÇ„Åï„Çì„ÅØ„Çä„Çá„ÅÜ„Çä„Åå„Åò„Çá„ÅÜ„Åö„ÄÇ",zh:"Â™ΩÂ™ΩÂæàÊúÉÂÅöËèú„ÄÇ"}},
{id:51,w:"ÂÖÑ",rd:"„ÅÇ„Å´",ro:"ani",m:"Âì•Âì•",pos:"ÂêçË©û",cat:"people",ex:{ja:"ÂÖÑ„ÅØÂ§ßÂ≠¶Áîü„Åß„Åô„ÄÇ",rd:"„ÅÇ„Å´„ÅØ„Å†„ÅÑ„Åå„Åè„Åõ„ÅÑ„Åß„Åô„ÄÇ",zh:"Âì•Âì•ÊòØÂ§ßÂ≠∏Áîü„ÄÇ"}},
{id:52,w:"Âßâ",rd:"„ÅÇ„Å≠",ro:"ane",m:"ÂßäÂßä",pos:"ÂêçË©û",cat:"people",ex:{ja:"Âßâ„ÅØÂÖàÁîü„Åß„Åô„ÄÇ",rd:"„ÅÇ„Å≠„ÅØ„Åõ„Çì„Åõ„ÅÑ„Åß„Åô„ÄÇ",zh:"ÂßäÂßäÊòØËÄÅÂ∏´„ÄÇ"}},
{id:53,w:"Âºü",rd:"„Åä„Å®„ÅÜ„Å®",ro:"otouto",m:"ÂºüÂºü",pos:"ÂêçË©û",cat:"people",ex:{ja:"Âºü„ÅØÈ´òÊ†°Áîü„Åß„Åô„ÄÇ",rd:"„Åä„Å®„ÅÜ„Å®„ÅØ„Åì„ÅÜ„Åì„ÅÜ„Åõ„ÅÑ„Åß„Åô„ÄÇ",zh:"ÂºüÂºüÊòØÈ´ò‰∏≠Áîü„ÄÇ"}},
{id:54,w:"Â¶π",rd:"„ÅÑ„ÇÇ„ÅÜ„Å®",ro:"imouto",m:"Â¶πÂ¶π",pos:"ÂêçË©û",cat:"people",ex:{ja:"Â¶π„ÅØ‰∏≠Â≠¶Áîü„Åß„Åô„ÄÇ",rd:"„ÅÑ„ÇÇ„ÅÜ„Å®„ÅØ„Å°„ÇÖ„ÅÜ„Åå„Åè„Åõ„ÅÑ„Åß„Åô„ÄÇ",zh:"Â¶πÂ¶πÊòØÂúã‰∏≠Áîü„ÄÇ"}},
{id:55,w:"Â≠ê‰æõ",rd:"„Åì„Å©„ÇÇ",ro:"kodomo",m:"Â∞èÂ≠©",pos:"ÂêçË©û",cat:"people",ex:{ja:"Â≠ê‰æõ„ÅåÈÅä„Çì„Åß„ÅÑ„Çã„ÄÇ",rd:"„Åì„Å©„ÇÇ„Åå„ÅÇ„Åù„Çì„Åß„ÅÑ„Çã„ÄÇ",zh:"Â∞èÂ≠©Âú®Áé©„ÄÇ"}},
{id:56,w:"Â≠¶Áîü",rd:"„Åå„Åè„Åõ„ÅÑ",ro:"gakusei",m:"Â≠∏Áîü",pos:"ÂêçË©û",cat:"people",ex:{ja:"ÁßÅ„ÅØÂ≠¶Áîü„Åß„Åô„ÄÇ",rd:"„Çè„Åü„Åó„ÅØ„Åå„Åè„Åõ„ÅÑ„Åß„Åô„ÄÇ",zh:"ÊàëÊòØÂ≠∏Áîü„ÄÇ"}},
// ÊôÇÈñì 8
{id:57,w:"‰ªäÊó•",rd:"„Åç„Çá„ÅÜ",ro:"kyou",m:"‰ªäÂ§©",pos:"ÂêçË©û",cat:"time",ex:{ja:"‰ªäÊó•„ÅØÊúàÊõúÊó•„Åß„Åô„ÄÇ",rd:"„Åç„Çá„ÅÜ„ÅØ„Åí„Å§„Çà„ÅÜ„Å≥„Åß„Åô„ÄÇ",zh:"‰ªäÂ§©ÊòØÊòüÊúü‰∏Ä„ÄÇ"}},
{id:58,w:"ÊòéÊó•",rd:"„ÅÇ„Åó„Åü",ro:"ashita",m:"ÊòéÂ§©",pos:"ÂêçË©û",cat:"time",ex:{ja:"ÊòéÊó•„ÅØ‰ºë„Åø„Åß„Åô„ÄÇ",rd:"„ÅÇ„Åó„Åü„ÅØ„ÇÑ„Åô„Åø„Åß„Åô„ÄÇ",zh:"ÊòéÂ§©‰ºëÊÅØ„ÄÇ"}},
{id:59,w:"Êò®Êó•",rd:"„Åç„ÅÆ„ÅÜ",ro:"kinou",m:"Êò®Â§©",pos:"ÂêçË©û",cat:"time",ex:{ja:"Êò®Êó•„ÅØÈõ®„Å†„Å£„Åü„ÄÇ",rd:"„Åç„ÅÆ„ÅÜ„ÅØ„ÅÇ„ÇÅ„Å†„Å£„Åü„ÄÇ",zh:"Êò®Â§©‰∏ãÈõ®‰∫Ü„ÄÇ"}},
{id:60,w:"Êúù",rd:"„ÅÇ„Åï",ro:"asa",m:"Êó©‰∏ä",pos:"ÂêçË©û",cat:"time",ex:{ja:"Êúù„Åî„ÅØ„Çì„ÇíÈ£ü„Åπ„Çã„ÄÇ",rd:"„ÅÇ„Åï„Åî„ÅØ„Çì„Çí„Åü„Åπ„Çã„ÄÇ",zh:"ÂêÉÊó©È§ê„ÄÇ"}},
{id:61,w:"Êòº",rd:"„Å≤„Çã",ro:"hiru",m:"‰∏≠Âçà",pos:"ÂêçË©û",cat:"time",ex:{ja:"Êòº„Åî„ÅØ„Çì„ÇíÈ£ü„Åπ„Çã„ÄÇ",rd:"„Å≤„Çã„Åî„ÅØ„Çì„Çí„Åü„Åπ„Çã„ÄÇ",zh:"ÂêÉÂçàÈ§ê„ÄÇ"}},
{id:62,w:"Â§ú",rd:"„Çà„Çã",ro:"yoru",m:"Êôö‰∏ä",pos:"ÂêçË©û",cat:"time",ex:{ja:"Â§ú„ÅØÈùô„Åã„Åß„Åô„ÄÇ",rd:"„Çà„Çã„ÅØ„Åó„Åö„Åã„Åß„Åô„ÄÇ",zh:"Êôö‰∏äÂæàÂÆâÈùú„ÄÇ"}},
{id:63,w:"‰ªä",rd:"„ÅÑ„Åæ",ro:"ima",m:"ÁèæÂú®",pos:"ÂêçË©û",cat:"time",ex:{ja:"‰ªä„ÄÅ‰ΩïÊôÇ„Åß„Åô„Åã„ÄÇ",rd:"„ÅÑ„Åæ„ÄÅ„Å™„Çì„Åò„Åß„Åô„Åã„ÄÇ",zh:"ÁèæÂú®ÂπæÈªûÔºü"}},
{id:64,w:"ÊØéÊó•",rd:"„Åæ„ÅÑ„Å´„Å°",ro:"mainichi",m:"ÊØèÂ§©",pos:"ÂêçË©û",cat:"time",ex:{ja:"ÊØéÊó•ÂãâÂº∑„Åô„Çã„ÄÇ",rd:"„Åæ„ÅÑ„Å´„Å°„Åπ„Çì„Åç„Çá„ÅÜ„Åô„Çã„ÄÇ",zh:"ÊØèÂ§©Â≠∏Áøí„ÄÇ"}},
// ÊãõÂëº 8
{id:65,w:"„Åä„ÅØ„Çà„ÅÜ",rd:"„Åä„ÅØ„Çà„ÅÜ",ro:"ohayou",m:"Êó©ÂÆâ",pos:"ÊÑüÂòÜË©û",cat:"greet",ex:{ja:"„Åä„ÅØ„Çà„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ",rd:"„Åä„ÅØ„Çà„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ",zh:"Êó©ÂÆâÔºàÁ¶ÆË≤åÂΩ¢Ôºâ„ÄÇ"}},
{id:66,w:"„Åì„Çì„Å´„Å°„ÅØ",rd:"„Åì„Çì„Å´„Å°„ÅØ",ro:"konnichiwa",m:"‰Ω†Â•Ω",pos:"ÊÑüÂòÜË©û",cat:"greet",ex:{ja:"„Åì„Çì„Å´„Å°„ÅØ„ÄÅÂÖÉÊ∞ó„Åß„Åô„Åã„ÄÇ",rd:"„Åì„Çì„Å´„Å°„ÅØ„ÄÅ„Åí„Çì„Åç„Åß„Åô„Åã„ÄÇ",zh:"‰Ω†Â•ΩÔºå‰Ω†Â•ΩÂóéÔºü"}},
{id:67,w:"„ÅÇ„Çä„Åå„Å®„ÅÜ",rd:"„ÅÇ„Çä„Åå„Å®„ÅÜ",ro:"arigatou",m:"Ë¨ùË¨ù",pos:"ÊÑüÂòÜË©û",cat:"greet",ex:{ja:"„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ",rd:"„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ",zh:"ÈùûÂ∏∏ÊÑüË¨ù„ÄÇ"}},
{id:68,w:"„Åô„Åø„Åæ„Åõ„Çì",rd:"„Åô„Åø„Åæ„Åõ„Çì",ro:"sumimasen",m:"‰∏çÂ•ΩÊÑèÊÄù;Â∞ç‰∏çËµ∑",pos:"ÊÑüÂòÜË©û",cat:"greet",ex:{ja:"„Åô„Åø„Åæ„Åõ„Çì„ÄÅÈßÖ„ÅØ„Å©„Åì„Åß„Åô„Åã„ÄÇ",rd:"„Åô„Åø„Åæ„Åõ„Çì„ÄÅ„Åà„Åç„ÅØ„Å©„Åì„Åß„Åô„Åã„ÄÇ",zh:"‰∏çÂ•ΩÊÑèÊÄùÔºåËªäÁ´ôÂú®Âì™Ë£°Ôºü"}},
{id:69,w:"„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô",rd:"„Åä„Å≠„Åå„ÅÑ„Åó„Åæ„Åô",ro:"onegaishimasu",m:"ÊãúË®ó‰∫Ü;È∫ªÁÖ©‰Ω†",pos:"ÊÑüÂòÜË©û",cat:"greet",ex:{ja:"„Åì„Çå„ÄÅ„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ",rd:"„Åì„Çå„ÄÅ„Åä„Å≠„Åå„ÅÑ„Åó„Åæ„Åô„ÄÇ",zh:"È∫ªÁÖ©‰Ω†ÈÄôÂÄã„ÄÇ"}},
{id:70,w:"„Åï„Çà„ÅÜ„Å™„Çâ",rd:"„Åï„Çà„ÅÜ„Å™„Çâ",ro:"sayounara",m:"ÂÜçË¶ã",pos:"ÊÑüÂòÜË©û",cat:"greet",ex:{ja:"„Åï„Çà„ÅÜ„Å™„Çâ„ÄÅ„Åæ„ÅüÊòéÊó•„ÄÇ",rd:"„Åï„Çà„ÅÜ„Å™„Çâ„ÄÅ„Åæ„Åü„ÅÇ„Åó„Åü„ÄÇ",zh:"ÂÜçË¶ãÔºåÊòéÂ§©Ë¶ã„ÄÇ"}},
{id:71,w:"„ÅØ„ÅÑ",rd:"„ÅØ„ÅÑ",ro:"hai",m:"ÊòØ;Â•Ω",pos:"ÊÑüÂòÜË©û",cat:"greet",ex:{ja:"„ÅØ„ÅÑ„ÄÅ„Çè„Åã„Çä„Åæ„Åó„Åü„ÄÇ",rd:"„ÅØ„ÅÑ„ÄÅ„Çè„Åã„Çä„Åæ„Åó„Åü„ÄÇ",zh:"ÊòØÁöÑÔºåÊàëÁü•ÈÅì‰∫Ü„ÄÇ"}},
{id:72,w:"„ÅÑ„ÅÑ„Åà",rd:"„ÅÑ„ÅÑ„Åà",ro:"iie",m:"‰∏çÊòØ;‰∏ç",pos:"ÊÑüÂòÜË©û",cat:"greet",ex:{ja:"„ÅÑ„ÅÑ„Åà„ÄÅÈÅï„ÅÑ„Åæ„Åô„ÄÇ",rd:"„ÅÑ„ÅÑ„Åà„ÄÅ„Å°„Åå„ÅÑ„Åæ„Åô„ÄÇ",zh:"‰∏çÔºå‰∏çÊòØÁöÑ„ÄÇ"}},
// Êï∏Èáè 8
{id:73,w:"‰∏Ä„Å§",rd:"„Å≤„Å®„Å§",ro:"hitotsu",m:"‰∏ÄÂÄã",pos:"Êï∏ÈáèË©û",cat:"num",ex:{ja:"„Çä„Çì„Åî„Çí‰∏Ä„Å§„Åè„Å†„Åï„ÅÑ„ÄÇ",rd:"„Çä„Çì„Åî„Çí„Å≤„Å®„Å§„Åè„Å†„Åï„ÅÑ„ÄÇ",zh:"Ë´ãÁµ¶Êàë‰∏ÄÂÄãËòãÊûú„ÄÇ"}},
{id:74,w:"‰∫å„Å§",rd:"„Åµ„Åü„Å§",ro:"futatsu",m:"ÂÖ©ÂÄã",pos:"Êï∏ÈáèË©û",cat:"num",ex:{ja:"Âçµ„Çí‰∫å„Å§Ë≤∑„ÅÜ„ÄÇ",rd:"„Åü„Åæ„Åî„Çí„Åµ„Åü„Å§„Åã„ÅÜ„ÄÇ",zh:"Ë≤∑ÂÖ©ÂÄãËõã„ÄÇ"}},
{id:75,w:"‰∏â„Å§",rd:"„Åø„Å£„Å§",ro:"mittsu",m:"‰∏âÂÄã",pos:"Êï∏ÈáèË©û",cat:"num",ex:{ja:"ÁÆ±„Åå‰∏â„Å§„ÅÇ„Çã„ÄÇ",rd:"„ÅØ„Åì„Åå„Åø„Å£„Å§„ÅÇ„Çã„ÄÇ",zh:"Êúâ‰∏âÂÄãÁÆ±Â≠ê„ÄÇ"}},
{id:76,w:"Áôæ",rd:"„Å≤„ÇÉ„Åè",ro:"hyaku",m:"Áôæ",pos:"Êï∏Ë©û",cat:"num",ex:{ja:"ÁôæÂÜÜ„Åß„Åô„ÄÇ",rd:"„Å≤„ÇÉ„Åè„Åà„Çì„Åß„Åô„ÄÇ",zh:"‰∏ÄÁôæÊó•Âúì„ÄÇ"}},
{id:77,w:"ÂçÉ",rd:"„Åõ„Çì",ro:"sen",m:"ÂçÉ",pos:"Êï∏Ë©û",cat:"num",ex:{ja:"ÂçÉÂÜÜÊú≠„ÄÇ",rd:"„Åõ„Çì„Åà„Çì„Åï„Å§„ÄÇ",zh:"ÂçÉÂúìÈàîÁ•®„ÄÇ"}},
{id:78,w:"‰∏á",rd:"„Åæ„Çì",ro:"man",m:"Ëê¨",pos:"Êï∏Ë©û",cat:"num",ex:{ja:"‰∏Ä‰∏áÂÜÜ„ÄÇ",rd:"„ÅÑ„Å°„Åæ„Çì„Åà„Çì„ÄÇ",zh:"‰∏ÄËê¨Êó•Âúì„ÄÇ"}},
{id:79,w:"ÂÜÜ",rd:"„Åà„Çì",ro:"en",m:"Êó•Âúì",pos:"ÂêçË©û",cat:"num",ex:{ja:"‰∫îÁôæÂÜÜ„Åß„Åô„ÄÇ",rd:"„Åî„Å≤„ÇÉ„Åè„Åà„Çì„Åß„Åô„ÄÇ",zh:"‰∫îÁôæÊó•Âúì„ÄÇ"}},
{id:80,w:"ÂÄã",rd:"„Åì",ro:"ko",m:"ÂÄã(ÈáèË©û)",pos:"ÈáèË©û",cat:"num",ex:{ja:"‰∏âÂÄã„Åè„Å†„Åï„ÅÑ„ÄÇ",rd:"„Åï„Çì„Åì„Åè„Å†„Åï„ÅÑ„ÄÇ",zh:"Ë´ãÁµ¶Êàë‰∏âÂÄã„ÄÇ"}},
// ===== NEW: È£ü„ÅπÁâ© 10 =====
{id:81,w:"„ÅîÈ£Ø",rd:"„Åî„ÅØ„Çì",ro:"gohan",m:"È£Ø;È§ê",pos:"ÂêçË©û",cat:"food",ex:{ja:"„ÅîÈ£Ø„ÇíÈ£ü„Åπ„Åæ„Åó„Çá„ÅÜ„ÄÇ",rd:"„Åî„ÅØ„Çì„Çí„Åü„Åπ„Åæ„Åó„Çá„ÅÜ„ÄÇ",zh:"‰∏ÄËµ∑ÂêÉÈ£ØÂêß„ÄÇ"}},
{id:82,w:"ËÇâ",rd:"„Å´„Åè",ro:"niku",m:"ËÇâ",pos:"ÂêçË©û",cat:"food",ex:{ja:"ËÇâ„ÅåÂ•Ω„Åç„Åß„Åô„ÄÇ",rd:"„Å´„Åè„Åå„Åô„Åç„Åß„Åô„ÄÇ",zh:"ÂñúÊ≠°ÂêÉËÇâ„ÄÇ"}},
{id:83,w:"È≠ö",rd:"„Åï„Åã„Å™",ro:"sakana",m:"È≠ö",pos:"ÂêçË©û",cat:"food",ex:{ja:"È≠ö„ÇíÁÑº„Åè„ÄÇ",rd:"„Åï„Åã„Å™„Çí„ÇÑ„Åè„ÄÇ",zh:"ÁÉ§È≠ö„ÄÇ"}},
{id:84,w:"ÈáéËèú",rd:"„ÇÑ„Åï„ÅÑ",ro:"yasai",m:"Ëî¨Ëèú",pos:"ÂêçË©û",cat:"food",ex:{ja:"ÈáéËèú„Çí„Åü„Åè„Åï„ÇìÈ£ü„Åπ„Çã„ÄÇ",rd:"„ÇÑ„Åï„ÅÑ„Çí„Åü„Åè„Åï„Çì„Åü„Åπ„Çã„ÄÇ",zh:"Â§öÂêÉËî¨Ëèú„ÄÇ"}},
{id:85,w:"ÊûúÁâ©",rd:"„Åè„Å†„ÇÇ„ÅÆ",ro:"kudamono",m:"Ê∞¥Êûú",pos:"ÂêçË©û",cat:"food",ex:{ja:"ÊûúÁâ©„ÅåÁæéÂë≥„Åó„ÅÑ„ÄÇ",rd:"„Åè„Å†„ÇÇ„ÅÆ„Åå„Åä„ÅÑ„Åó„ÅÑ„ÄÇ",zh:"Ê∞¥ÊûúÂ•ΩÂêÉ„ÄÇ"}},
{id:86,w:"„Éë„É≥",rd:"„Å±„Çì",ro:"pan",m:"È∫µÂåÖ",pos:"ÂêçË©û",cat:"food",ex:{ja:"Êúù„Éë„É≥„ÇíÈ£ü„Åπ„Çã„ÄÇ",rd:"„ÅÇ„Åï„Å±„Çì„Çí„Åü„Åπ„Çã„ÄÇ",zh:"Êó©‰∏äÂêÉÈ∫µÂåÖ„ÄÇ"}},
{id:87,w:"Âçµ",rd:"„Åü„Åæ„Åî",ro:"tamago",m:"Ëõã",pos:"ÂêçË©û",cat:"food",ex:{ja:"Âçµ„ÇíÂâ≤„Çã„ÄÇ",rd:"„Åü„Åæ„Åî„Çí„Çè„Çã„ÄÇ",zh:"ÊâìËõã„ÄÇ"}},
{id:88,w:"Áâõ‰π≥",rd:"„Åé„ÇÖ„ÅÜ„Å´„ÇÖ„ÅÜ",ro:"gyuunyuu",m:"ÁâõÂ•∂",pos:"ÂêçË©û",cat:"food",ex:{ja:"Áâõ‰π≥„ÇíÈ£≤„ÇÄ„ÄÇ",rd:"„Åé„ÇÖ„ÅÜ„Å´„ÇÖ„ÅÜ„Çí„ÅÆ„ÇÄ„ÄÇ",zh:"ÂñùÁâõÂ•∂„ÄÇ"}},
{id:89,w:"„ÅäËå∂",rd:"„Åä„Å°„ÇÉ",ro:"ocha",m:"Ëå∂",pos:"ÂêçË©û",cat:"food",ex:{ja:"„ÅäËå∂„Çí„Å©„ÅÜ„Åû„ÄÇ",rd:"„Åä„Å°„ÇÉ„Çí„Å©„ÅÜ„Åû„ÄÇ",zh:"Ë´ãÂñùËå∂„ÄÇ"}},
{id:90,w:"„Ç≥„Éº„Éí„Éº",rd:"„Åì„Éº„Å≤„Éº",ro:"koohii",m:"ÂíñÂï°",pos:"ÂêçË©û",cat:"food",ex:{ja:"„Ç≥„Éº„Éí„Éº„Çí‰∏ÄÊùØ„Åè„Å†„Åï„ÅÑ„ÄÇ",rd:"„Åì„Éº„Å≤„Éº„Çí„ÅÑ„Å£„Å±„ÅÑ„Åè„Å†„Åï„ÅÑ„ÄÇ",zh:"Ë´ãÁµ¶Êàë‰∏ÄÊùØÂíñÂï°„ÄÇ"}},
// ===== NEW: Ëâ≤ 5 =====
{id:91,w:"Ëµ§",rd:"„ÅÇ„Åã",ro:"aka",m:"Á¥ÖËâ≤",pos:"ÂêçË©û",cat:"color",ex:{ja:"Ëµ§„ÅÑËä±„ÅåÂí≤„ÅÑ„Åü„ÄÇ",rd:"„ÅÇ„Åã„ÅÑ„ÅØ„Å™„Åå„Åï„ÅÑ„Åü„ÄÇ",zh:"Á¥ÖËâ≤ÁöÑËä±Èñã‰∫Ü„ÄÇ"}},
{id:92,w:"Èùí",rd:"„ÅÇ„Åä",ro:"ao",m:"ËóçËâ≤",pos:"ÂêçË©û",cat:"color",ex:{ja:"Á©∫„ÅØÈùí„ÅÑ„ÄÇ",rd:"„Åù„Çâ„ÅØ„ÅÇ„Åä„ÅÑ„ÄÇ",zh:"Â§©Á©∫ÊòØËóçËâ≤ÁöÑ„ÄÇ"}},
{id:93,w:"ÁôΩ",rd:"„Åó„Çç",ro:"shiro",m:"ÁôΩËâ≤",pos:"ÂêçË©û",cat:"color",ex:{ja:"ÁôΩ„ÅÑÈõ≤„ÅåË¶ã„Åà„Çã„ÄÇ",rd:"„Åó„Çç„ÅÑ„Åè„ÇÇ„Åå„Åø„Åà„Çã„ÄÇ",zh:"ÁúãÂæóÂà∞ÁôΩËâ≤ÁöÑÈõ≤„ÄÇ"}},
{id:94,w:"Èªí",rd:"„Åè„Çç",ro:"kuro",m:"ÈªëËâ≤",pos:"ÂêçË©û",cat:"color",ex:{ja:"Èªí„ÅÑÁå´„Åå„ÅÑ„Çã„ÄÇ",rd:"„Åè„Çç„ÅÑ„Å≠„Åì„Åå„ÅÑ„Çã„ÄÇ",zh:"Êúâ‰∏ÄÈöªÈªëË≤ì„ÄÇ"}},
{id:95,w:"ÈªÑËâ≤",rd:"„Åç„ÅÑ„Çç",ro:"kiiro",m:"ÈªÉËâ≤",pos:"ÂêçË©û",cat:"color",ex:{ja:"ÈªÑËâ≤„ÅÑËä±„ÅåÂ•Ω„Åç„ÄÇ",rd:"„Åç„ÅÑ„Çç„ÅÑ„ÅØ„Å™„Åå„Åô„Åç„ÄÇ",zh:"ÂñúÊ≠°ÈªÉËâ≤ÁöÑËä±„ÄÇ"}},
// ===== NEW: Ëá™ÁÑ∂ 5 =====
{id:96,w:"Â±±",rd:"„ÇÑ„Åæ",ro:"yama",m:"Â±±",pos:"ÂêçË©û",cat:"nature",ex:{ja:"Â±±„Å´Áôª„Çã„ÄÇ",rd:"„ÇÑ„Åæ„Å´„ÅÆ„Åº„Çã„ÄÇ",zh:"Áà¨Â±±„ÄÇ"}},
{id:97,w:"Êµ∑",rd:"„ÅÜ„Åø",ro:"umi",m:"Êµ∑",pos:"ÂêçË©û",cat:"nature",ex:{ja:"Êµ∑„ÅßÊ≥≥„Åê„ÄÇ",rd:"„ÅÜ„Åø„Åß„Åä„Çà„Åê„ÄÇ",zh:"Âú®Êµ∑Ë£°Ê∏∏Ê≥≥„ÄÇ"}},
{id:98,w:"Â∑ù",rd:"„Åã„Çè",ro:"kawa",m:"Ê≤≥",pos:"ÂêçË©û",cat:"nature",ex:{ja:"Â∑ù„ÅßÈ≠ö„ÇíÈá£„Çã„ÄÇ",rd:"„Åã„Çè„Åß„Åï„Åã„Å™„Çí„Å§„Çã„ÄÇ",zh:"Âú®Ê≤≥Ë£°Èá£È≠ö„ÄÇ"}},
{id:99,w:"Ëä±",rd:"„ÅØ„Å™",ro:"hana",m:"Ëä±",pos:"ÂêçË©û",cat:"nature",ex:{ja:"Ëä±„ÅåÂí≤„ÅÑ„Å¶„ÅÑ„Çã„ÄÇ",rd:"„ÅØ„Å™„Åå„Åï„ÅÑ„Å¶„ÅÑ„Çã„ÄÇ",zh:"Ëä±Ê≠£Âú®Èñã„ÄÇ"}},
{id:100,w:"Á©∫",rd:"„Åù„Çâ",ro:"sora",m:"Â§©Á©∫",pos:"ÂêçË©û",cat:"nature",ex:{ja:"Á©∫„Åå„Åç„Çå„ÅÑ„Å†„ÄÇ",rd:"„Åù„Çâ„Åå„Åç„Çå„ÅÑ„Å†„ÄÇ",zh:"Â§©Á©∫ÂæàÁæé„ÄÇ"}},
// ===== NEW: ‰Ωì 5 =====
{id:101,w:"ÁõÆ",rd:"„ÇÅ",ro:"me",m:"ÁúºÁùõ",pos:"ÂêçË©û",cat:"body",ex:{ja:"ÁõÆ„ÅåÂ§ß„Åç„ÅÑ„ÄÇ",rd:"„ÇÅ„Åå„Åä„Åä„Åç„ÅÑ„ÄÇ",zh:"ÁúºÁùõÂæàÂ§ß„ÄÇ"}},
{id:102,w:"ËÄ≥",rd:"„Åø„Åø",ro:"mimi",m:"ËÄ≥Êúµ",pos:"ÂêçË©û",cat:"body",ex:{ja:"ËÄ≥„ÅåÁóõ„ÅÑ„ÄÇ",rd:"„Åø„Åø„Åå„ÅÑ„Åü„ÅÑ„ÄÇ",zh:"ËÄ≥ÊúµÁóõ„ÄÇ"}},
{id:103,w:"Âè£",rd:"„Åè„Å°",ro:"kuchi",m:"Âò¥Â∑¥",pos:"ÂêçË©û",cat:"body",ex:{ja:"Âè£„ÇíÈñã„Åë„Çã„ÄÇ",rd:"„Åè„Å°„Çí„ÅÇ„Åë„Çã„ÄÇ",zh:"ÂºµÈñãÂò¥Â∑¥„ÄÇ"}},
{id:104,w:"Êâã",rd:"„Å¶",ro:"te",m:"Êâã",pos:"ÂêçË©û",cat:"body",ex:{ja:"Êâã„ÇíÊ¥ó„ÅÜ„ÄÇ",rd:"„Å¶„Çí„ÅÇ„Çâ„ÅÜ„ÄÇ",zh:"Ê¥óÊâã„ÄÇ"}},
{id:105,w:"Ë∂≥",rd:"„ÅÇ„Åó",ro:"ashi",m:"ËÖ≥",pos:"ÂêçË©û",cat:"body",ex:{ja:"Ë∂≥„ÅåÈÄü„ÅÑ„ÄÇ",rd:"„ÅÇ„Åó„Åå„ÅØ„ÇÑ„ÅÑ„ÄÇ",zh:"Ë∑ëÂæóÂø´„ÄÇ"}},
// ===== NEW: ÂãïË©û2 10 =====
{id:106,w:"‰Ωú„Çã",rd:"„Å§„Åè„Çã",ro:"tsukuru",m:"Ë£Ω‰Ωú",pos:"ÂãïË©ûI",cat:"verb2",ex:{ja:"ÊñôÁêÜ„Çí‰Ωú„Çã„ÄÇ",rd:"„Çä„Çá„ÅÜ„Çä„Çí„Å§„Åè„Çã„ÄÇ",zh:"ÂÅöÊñôÁêÜ„ÄÇ"}},
{id:107,w:"‰Ωø„ÅÜ",rd:"„Å§„Åã„ÅÜ",ro:"tsukau",m:"‰ΩøÁî®",pos:"ÂãïË©ûI",cat:"verb2",ex:{ja:"„Éë„ÇΩ„Ç≥„É≥„Çí‰Ωø„ÅÜ„ÄÇ",rd:"„Å±„Åù„Åì„Çì„Çí„Å§„Åã„ÅÜ„ÄÇ",zh:"‰ΩøÁî®ÈõªËÖ¶„ÄÇ"}},
{id:108,w:"ÂæÖ„Å§",rd:"„Åæ„Å§",ro:"matsu",m:"Á≠âÂæÖ",pos:"ÂãïË©ûI",cat:"verb2",ex:{ja:"„Åì„Åì„ÅßÂæÖ„Å§„ÄÇ",rd:"„Åì„Åì„Åß„Åæ„Å§„ÄÇ",zh:"Âú®ÈÄôË£°Á≠â„ÄÇ"}},
{id:109,w:"ÊåÅ„Å§",rd:"„ÇÇ„Å§",ro:"motsu",m:"Êãø;ÊåÅÊúâ",pos:"ÂãïË©ûI",cat:"verb2",ex:{ja:"Ëç∑Áâ©„ÇíÊåÅ„Å§„ÄÇ",rd:"„Å´„ÇÇ„Å§„Çí„ÇÇ„Å§„ÄÇ",zh:"ÊãøË°åÊùé„ÄÇ"}},
{id:110,w:"Áü•„Çã",rd:"„Åó„Çã",ro:"shiru",m:"Áü•ÈÅì",pos:"ÂãïË©ûI",cat:"verb2",ex:{ja:"ÂΩº„ÇíÁü•„Å£„Å¶„ÅÑ„Çã„ÄÇ",rd:"„Åã„Çå„Çí„Åó„Å£„Å¶„ÅÑ„Çã„ÄÇ",zh:"Ë™çË≠ò‰ªñ„ÄÇ"}},
{id:111,w:"‰Ωè„ÇÄ",rd:"„Åô„ÇÄ",ro:"sumu",m:"‰Ωè",pos:"ÂãïË©ûI",cat:"verb2",ex:{ja:"Êù±‰∫¨„Å´‰Ωè„ÇÄ„ÄÇ",rd:"„Å®„ÅÜ„Åç„Çá„ÅÜ„Å´„Åô„ÇÄ„ÄÇ",zh:"‰ΩèÂú®Êù±‰∫¨„ÄÇ"}},
{id:112,w:"ÂÉç„Åè",rd:"„ÅØ„Åü„Çâ„Åè",ro:"hataraku",m:"Â∑•‰Ωú",pos:"ÂãïË©ûI",cat:"verb2",ex:{ja:"‰ºöÁ§æ„ÅßÂÉç„Åè„ÄÇ",rd:"„Åã„ÅÑ„Åó„ÇÉ„Åß„ÅØ„Åü„Çâ„Åè„ÄÇ",zh:"Âú®ÂÖ¨Âè∏Â∑•‰Ωú„ÄÇ"}},
{id:113,w:"ÈÅä„Å∂",rd:"„ÅÇ„Åù„Å∂",ro:"asobu",m:"Áé©",pos:"ÂãïË©ûI",cat:"verb2",ex:{ja:"ÂèãÈÅî„Å®ÈÅä„Å∂„ÄÇ",rd:"„Å®„ÇÇ„Å†„Å°„Å®„ÅÇ„Åù„Å∂„ÄÇ",zh:"ÂíåÊúãÂèãÁé©„ÄÇ"}},
{id:114,w:"Ê≥≥„Åê",rd:"„Åä„Çà„Åê",ro:"oyogu",m:"Ê∏∏Ê≥≥",pos:"ÂãïË©ûI",cat:"verb2",ex:{ja:"„Éó„Éº„É´„ÅßÊ≥≥„Åê„ÄÇ",rd:"„Å∑„Éº„Çã„Åß„Åä„Çà„Åê„ÄÇ",zh:"Âú®Ê∏∏Ê≥≥Ê±†Ê∏∏Ê≥≥„ÄÇ"}},
{id:115,w:"Ëµ∞„Çã",rd:"„ÅØ„Åó„Çã",ro:"hashiru",m:"Ë∑ë",pos:"ÂãïË©ûI",cat:"verb2",ex:{ja:"ÊØéÊúùËµ∞„Çã„ÄÇ",rd:"„Åæ„ÅÑ„ÅÇ„Åï„ÅØ„Åó„Çã„ÄÇ",zh:"ÊØèÂ§©Êó©‰∏äË∑ëÊ≠•„ÄÇ"}},
// ===== NEW: ÂâØË©û 5 =====
{id:116,w:"„Å®„Å¶„ÇÇ",rd:"„Å®„Å¶„ÇÇ",ro:"totemo",m:"ÈùûÂ∏∏",pos:"ÂâØË©û",cat:"adverb",ex:{ja:"„Å®„Å¶„ÇÇÁæéÂë≥„Åó„ÅÑ„ÄÇ",rd:"„Å®„Å¶„ÇÇ„Åä„ÅÑ„Åó„ÅÑ„ÄÇ",zh:"ÈùûÂ∏∏Â•ΩÂêÉ„ÄÇ"}},
{id:117,w:"„ÇÇ„ÅÜ",rd:"„ÇÇ„ÅÜ",ro:"mou",m:"Â∑≤Á∂ì",pos:"ÂâØË©û",cat:"adverb",ex:{ja:"„ÇÇ„ÅÜÈ£ü„Åπ„Åæ„Åó„Åü„ÄÇ",rd:"„ÇÇ„ÅÜ„Åü„Åπ„Åæ„Åó„Åü„ÄÇ",zh:"Â∑≤Á∂ìÂêÉ‰∫Ü„ÄÇ"}},
{id:118,w:"„Åæ„Å†",rd:"„Åæ„Å†",ro:"mada",m:"ÈÇÑ;Â∞öÊú™",pos:"ÂâØË©û",cat:"adverb",ex:{ja:"„Åæ„Å†ÁµÇ„Çè„Å£„Å¶„ÅÑ„Å™„ÅÑ„ÄÇ",rd:"„Åæ„Å†„Åä„Çè„Å£„Å¶„ÅÑ„Å™„ÅÑ„ÄÇ",zh:"ÈÇÑÊ≤íÁµêÊùü„ÄÇ"}},
{id:119,w:"„ÅÑ„Å§„ÇÇ",rd:"„ÅÑ„Å§„ÇÇ",ro:"itsumo",m:"Á∏ΩÊòØ",pos:"ÂâØË©û",cat:"adverb",ex:{ja:"„ÅÑ„Å§„ÇÇÁ¨ë„Å£„Å¶„ÅÑ„Çã„ÄÇ",rd:"„ÅÑ„Å§„ÇÇ„Çè„Çâ„Å£„Å¶„ÅÑ„Çã„ÄÇ",zh:"Á∏ΩÊòØÂú®Á¨ë„ÄÇ"}},
{id:120,w:"„Åü„Åè„Åï„Çì",rd:"„Åü„Åè„Åï„Çì",ro:"takusan",m:"ÂæàÂ§ö",pos:"ÂâØË©û",cat:"adverb",ex:{ja:"„Åü„Åè„Åï„ÇìÈ£ü„Åπ„Åü„ÄÇ",rd:"„Åü„Åè„Åï„Çì„Åü„Åπ„Åü„ÄÇ",zh:"ÂêÉ‰∫ÜÂæàÂ§ö„ÄÇ"}}
];

const ENCOURAGE={
correct:["„Åô„Åî„ÅÑÔºÅ(Â•ΩÂé≤ÂÆ≥ÔºÅ)","Ê≠£Ëß£ÔºÅ„Çà„Åè„Åß„Åç„Åæ„Åó„ÅüÔºÅ","ÂÆåÁíßÔºÅ(ÂÆåÁæéÔºÅ)","„Åù„ÅÆË™øÂ≠êÔºÅ(Â∞±ÊòØÈÄôÊ®£ÔºÅ)","Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅ(Â§™Ê£í‰∫ÜÔºÅ)","Â§©Êâç„Å†ÔºÅ(‰Ω†ÊòØÂ§©ÊâçÔºÅ)"],
wrong:["Â§ß‰∏àÂ§´ÔºÅ„ÇÇ„ÅÜ‰∏ÄÂõûÔºÅ(Ê≤íÈóú‰øÇÔºÅ)","ÊÉú„Åó„ÅÑÔºÅ(Â•ΩÂèØÊÉúÔºÅ)","ÈñìÈÅï„ÅÑ„ÅØÂ≠¶„Å≥„ÅÆÂßã„Åæ„Çä(ÁäØÈåØÊòØÂ≠∏ÁøíÁöÑÈñãÂßã)","„Éâ„É≥„Éû„Ç§ÔºÅ(Don't mind!)","Ê¨°„ÅØÁµ∂ÂØæ„Åß„Åç„ÇãÔºÅ(‰∏ãÊ¨°‰∏ÄÂÆöË°åÔºÅ)"],
completion:["‰ªäÊó•„ÇÇ„ÅäÁñ≤„ÇåÊßòÔºÅ(‰ªäÂ§©‰πüËæõËã¶‰∫ÜÔºÅ)","ÊØéÊó•„ÅÆÂä™Âäõ„ÅåÂ§ßÂàáÔºÅ(ÊØèÂ§©ÁöÑÂä™ÂäõÈÉΩÂæàÈáçË¶ÅÔºÅ)","‰∏ÄÊ≠©‰∏ÄÊ≠©„ÄÅÂâçÈÄ≤„Åó„Çà„ÅÜÔºÅ(‰∏ÄÊ≠•‰∏ÄÊ≠•ÂêëÂâçÔºÅ)","Á∂ôÁ∂ö„ÅØÂäõ„Å™„ÇäÔºÅ(ÊåÅÁ∫åÂ∞±ÊòØÂäõÈáèÔºÅ)"],
streak:{3:"3Êó•ÈÄ£Á∂öÔºÅ„ÅÑ„ÅÑÊÑü„ÅòÔºÅ",7:"‰∏ÄÈÄ±ÈñìÈÄ£Á∂öÔºÅ„Åô„Åî„ÅÑÔºÅ",14:"‰∫åÈÄ±ÈñìÔºÅÊú¨ÂΩì„Å´ÂÅâ„ÅÑÔºÅ",30:"‰∏Ä„É∂ÊúàÔºÅ„ÅÇ„Å™„Åü„ÅØÊú¨Áâ©„Å†ÔºÅ"}
};

// ================================================================
// CORE: FSRS-4.5 Spaced Repetition Engine
// ================================================================
function today(){return new Date().toISOString().split("T")[0]}
function yesterday(){const d=new Date();d.setDate(d.getDate()-1);return d.toISOString().split("T")[0]}
function daysBetween(a,b){return Math.round((new Date(b)-new Date(a))/86400000)}
function shuffle(a){const b=[...a];for(let i=b.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[b[i],b[j]]=[b[j],b[i]]}return b}
function pick(a){return a[Math.floor(Math.random()*a.length)]}

const FSRS={
w:[0.40255,1.18385,3.173,15.69105,7.1949,0.5345,1.4604,0.0046,1.54575,0.1192,1.01925,1.9395,0.11,0.29605,2.2698,0.2315,2.9898,0.51655,0.6621],
DECAY:-0.5,
get FACTOR(){return Math.pow(0.9,1/this.DECAY)-1},
requestRetention:0.9,
maximumInterval:36500,
forgettingCurve(elapsed,s){return Math.pow(1+this.FACTOR*elapsed/s,this.DECAY)},
initStability(r){return Math.max(this.w[r-1],0.1)},
initDifficulty(r){return this.constrainD(this.w[4]-Math.exp(this.w[5]*(r-1))+1)},
constrainD(d){return Math.min(Math.max(d,1),10)},
nextDifficulty(d,r){
  const dd=-this.w[6]*(r-3);const ld=dd*(10-d)/9;const nd=d+ld;
  return this.constrainD(this.w[7]*this.initDifficulty(4)+(1-this.w[7])*nd)},
nextRecallStability(d,s,r,rating){
  const hp=rating===2?this.w[15]:1;const eb=rating===4?this.w[16]:1;
  return s*(1+Math.exp(this.w[8])*(11-d)*Math.pow(s,-this.w[9])*(Math.exp((1-r)*this.w[10])-1)*hp*eb)},
nextForgetStability(d,s,r){
  return Math.min(this.w[11]*Math.pow(d,-this.w[12])*(Math.pow(s+1,this.w[13])-1)*Math.exp((1-r)*this.w[14]),s/Math.exp(this.w[17]*this.w[18]))},
nextInterval(s){
  const iv=s/this.FACTOR*(Math.pow(this.requestRetention,1/this.DECAY)-1);
  return Math.min(Math.max(Math.round(iv),1),this.maximumInterval)},
newCard(){return{difficulty:0,stability:0,reps:0,nextReview:today(),lastReview:null,totalReviews:0,correctCount:0,wrongCount:0}},
// rating: 1=Again, 2=Hard, 3=Good, 4=Easy
review(card,rating){
  const now=today();const elapsed=card.lastReview?Math.max(0,daysBetween(card.lastReview,now)):0;
  let d,s;
  if(card.reps===0){d=this.initDifficulty(rating);s=this.initStability(rating)}
  else{d=this.nextDifficulty(card.difficulty,rating);
    const r=this.forgettingCurve(elapsed,card.stability);
    s=rating>=2?this.nextRecallStability(d,card.stability,r,rating):this.nextForgetStability(d,card.stability,r)}
  const iv=this.nextInterval(s);const nx=new Date();nx.setDate(nx.getDate()+iv);
  return{difficulty:Math.round(d*100)/100,stability:Math.round(s*100)/100,
    reps:rating>=2?card.reps+1:0,interval:iv,nextReview:nx.toISOString().split("T")[0],
    lastReview:now,totalReviews:(card.totalReviews||0)+1,
    correctCount:(card.correctCount||0)+(rating>=2?1:0),
    wrongCount:(card.wrongCount||0)+(rating<2?1:0)}},
getDue(){const d=Store.load();const t=today();const due=[];
  for(const[id,p]of Object.entries(d.vocab)){if(p.nextReview<=t)due.push({id:+id,...p})}
  due.sort((a,b)=>a.nextReview.localeCompare(b.nextReview));return due},
getNew(limit=5){const d=Store.load();const learned=new Set(Object.keys(d.vocab));
  return VOCAB.filter(v=>!learned.has(String(v.id))).slice(0,limit)}
};

// ================================================================
// CORE: Achievements
// ================================================================
const Achievements={
list:[
  {id:'first_word',icon:'üå±',name:'ÂàùÂøÉËÄÖ',desc:'Â≠∏ÊúÉÁ¨¨‰∏ÄÂÄãÂñÆÂ≠ó',check:d=>Object.keys(d.vocab).length>=1},
  {id:'ten_words',icon:'üìö',name:'Â∞èÊõ∏Ëü≤',desc:'Â≠∏ÊúÉ10ÂÄãÂñÆÂ≠ó',check:d=>Object.keys(d.vocab).length>=10},
  {id:'fifty_words',icon:'üéì',name:'Âã§Â≠∏ËÄÖ',desc:'Â≠∏ÊúÉ50ÂÄãÂñÆÂ≠ó',check:d=>Object.keys(d.vocab).length>=50},
  {id:'hundred_words',icon:'üìñ',name:'ÁôæË©ûÊñ¨',desc:'Â≠∏ÊúÉ100ÂÄãÂñÆÂ≠ó',check:d=>Object.keys(d.vocab).length>=100},
  {id:'all_words',icon:'üëë',name:'ÂñÆÂ≠óÁéã',desc:'Â≠∏ÊúÉÂÖ®ÈÉ®ÂñÆÂ≠ó',check:d=>Object.keys(d.vocab).length>=VOCAB.length},
  {id:'streak3',icon:'üî•',name:'‰∏âÊó•Âùä‰∏ªÁ™ÅÁ†¥',desc:'ÈÄ£Á∫åÂ≠∏Áøí3Â§©',check:d=>d.streak.current>=3},
  {id:'streak7',icon:'‚≠ê',name:'‰∏ÄÈÄ±ÈÅî‰∫∫',desc:'ÈÄ£Á∫åÂ≠∏Áøí7Â§©',check:d=>d.streak.current>=7},
  {id:'streak30',icon:'üíé',name:'ÊúàÈñìÂãáËÄÖ',desc:'ÈÄ£Á∫åÂ≠∏Áøí30Â§©',check:d=>d.streak.current>=30},
  {id:'perfect_quiz',icon:'üíØ',name:'ÂÆåÁæéÁ≠îÈ°å',desc:'Ê∏¨È©óÂæóÂà∞100%',check:d=>d.quizHistory.some(q=>q.correctAnswers===q.totalQuestions&&q.totalQuestions>=5)},
  {id:'all_kana',icon:'üèØ',name:'‰∫îÂçÅÈü≥ÈÅî‰∫∫',desc:'ÊéåÊè°ÂÖ®ÈÉ®ÂÅáÂêç',check:d=>Object.values(d.gojuon).filter(g=>g.mastered).length>=ALL_KANA.length},
  {id:'night_owl',icon:'ü¶â',name:'Â§úË≤ìÂ≠∏Èú∏',desc:'Êôö‰∏ä11ÈªûÂæåÂ≠∏Áøí',check:()=>new Date().getHours()>=23},
  {id:'early_bird',icon:'üê¶',name:'Êó©Ëµ∑È≥•',desc:'Êó©‰∏ä6ÈªûÂâçÂ≠∏Áøí',check:()=>new Date().getHours()<6},
  {id:'quiz_master',icon:'üèÜ',name:'Ê∏¨È©óÂ§ßÂ∏´',desc:'ÂÆåÊàê20Ê¨°Ê∏¨È©ó',check:d=>d.quizHistory.length>=20},
],
check(d){
  if(!d.achievements)d.achievements=[];
  const newOnes=[];
  this.list.forEach(a=>{if(!d.achievements.includes(a.id)&&a.check(d)){d.achievements.push(a.id);newOnes.push(a)}});
  if(newOnes.length){Store.save();newOnes.forEach((a,i)=>setTimeout(()=>this.showToast(a),i*2500))}
  return newOnes},
showToast(a){
  const t=document.getElementById('ach-toast');
  t.querySelector('.toast-icon').textContent=a.icon;
  t.querySelector('.toast-text').textContent=`Ëß£ÈéñÊàêÂ∞±Ôºö${a.name}ÔºÅ`;
  t.classList.add('show');
  if(navigator.vibrate)navigator.vibrate([100,50,100]);
  setTimeout(()=>t.classList.remove('show'),2200)}
};

// ================================================================
// CORE: StorageManager (with SM-2 migration)
// ================================================================
const Store={
KEY:"nihongo_app_v2",
OLD_KEY:"nihongo_app_v1",
_cache:null,_timer:null,
load(){
  if(this._cache)return this._cache;
  try{
    let r=localStorage.getItem(this.KEY);
    if(r){this._cache=JSON.parse(r);if(this._checkToday())this.save();return this._cache}
    // Try migrate from v1
    r=localStorage.getItem(this.OLD_KEY);
    if(r){this._cache=this._migrate(JSON.parse(r));this.save();return this._cache}
  }catch(e){}
  this._cache=this._default();this.save();return this._cache},
save(d){if(d)this._cache=d;if(!this._cache)return;this._cache.lastActiveAt=new Date().toISOString();
  try{localStorage.setItem(this.KEY,JSON.stringify(this._cache))}catch(e){
    if(this._cache.quizHistory.length>30)this._cache.quizHistory=this._cache.quizHistory.slice(-30);
    localStorage.setItem(this.KEY,JSON.stringify(this._cache))}},
debounce(){clearTimeout(this._timer);this._timer=setTimeout(()=>this.save(),300)},
_checkToday(){const d=this._cache;const t=today();if(d.todayStats.date!==t){d.todayStats={date:t,newWordsLearned:0,wordsReviewed:0,gojuonPracticed:0,quizzesTaken:0,correctRate:0,timeSpent:0};return true}return false},
_migrate(old){
  // Migrate SM-2 vocab data to FSRS format
  const d=this._default();
  d.gojuon=old.gojuon||{};
  d.quizHistory=old.quizHistory||[];
  d.streak=old.streak||d.streak;
  d.settings={...d.settings,...(old.settings||{})};
  d.achievements=old.achievements||[];
  if(old.vocab){
    for(const[id,card]of Object.entries(old.vocab)){
      if(card.easeFactor!==undefined){
        d.vocab[id]={difficulty:Math.round((6-(card.easeFactor||2.5))*2*100)/100,
          stability:card.interval||1,reps:card.repetitions||0,
          nextReview:card.nextReview||today(),lastReview:card.lastReview||null,
          totalReviews:card.totalReviews||0,correctCount:card.correctCount||0,wrongCount:card.wrongCount||0};
      }else{d.vocab[id]=card}
    }
  }
  return d},
_default(){return{version:"2.0.0",createdAt:new Date().toISOString(),lastActiveAt:new Date().toISOString(),
  settings:{theme:"auto",gojuonMode:"hiragana",dailyGoal:20,soundEnabled:true},
  streak:{current:0,longest:0,lastStudyDate:null,history:[]},
  gojuon:{},vocab:{},quizHistory:[],achievements:[],errorBook:[],
  todayStats:{date:today(),newWordsLearned:0,wordsReviewed:0,gojuonPracticed:0,quizzesTaken:0,correctRate:0,timeSpent:0}}},
updateStreak(){const d=this.load();const t=today();const y=yesterday();
  if(d.streak.lastStudyDate===t)return;
  if(d.streak.lastStudyDate===y){d.streak.current++}else if(d.streak.lastStudyDate!==t){d.streak.current=1}
  d.streak.longest=Math.max(d.streak.longest,d.streak.current);d.streak.lastStudyDate=t;
  const h=d.streak.history;const last=h[h.length-1];if(last&&last.date===t){last.count++}else{h.push({date:t,count:1});if(h.length>60)h.shift()}
  this.save();Achievements.check(d)},
addError(vocabId,userAns,correctAns){
  const d=this.load();if(!d.errorBook)d.errorBook=[];
  const exist=d.errorBook.find(e=>e.vocabId===vocabId);
  if(exist){exist.count++;exist.lastWrong=today()}
  else{d.errorBook.push({vocabId,count:1,lastWrong:today(),userAns,correctAns})}
  if(d.errorBook.length>200)d.errorBook=d.errorBook.slice(-200);
  this.save()},
exportData(){const b=new Blob([JSON.stringify(this.load(),null,2)],{type:"application/json"});
  const a=document.createElement("a");a.href=URL.createObjectURL(b);a.download="nihongo_backup_"+today()+".json";a.click();URL.revokeObjectURL(a.href)},
importData(json){try{const d=JSON.parse(json);if(d.version){this._cache=d;this.save();return true}}catch(e){}return false},
reset(){this._cache=this._default();this.save()}
};

// ================================================================
// CORE: TTS Engine
// ================================================================
const TTS={
_audio:null,_unlocked:false,
get enabled(){return Store.load().settings.soundEnabled},
init(){
  this._audio=new Audio();this._audio.volume=1;
  const unlock=()=>{if(this._unlocked)return;
    this._audio.play().catch(()=>{});this._audio.pause();this._audio.currentTime=0;this._unlocked=true};
  document.addEventListener("touchstart",unlock,{passive:true});
  document.addEventListener("click",unlock)},
speak(text){
  if(!this.enabled||!text)return;
  try{if(this._audio){this._audio.pause();this._audio.currentTime=0}
    const url="https://translate.google.com/translate_tts?ie=UTF-8&client=tw-ob&tl=ja&q="+encodeURIComponent(text);
    this._audio.src=url;this._audio.play().catch(e=>{this._fallback(text)})
  }catch(e){this._fallback(text)}},
_fallback(text){if(!window.speechSynthesis)return;speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance(text);u.lang="ja-JP";u.rate=0.8;u.volume=1;speechSynthesis.speak(u)},
playBtn(text,el){if(!this.enabled)return;this.speak(text);
  if(el){el.classList.add("playing");setTimeout(()=>el.classList.remove("playing"),800)}},
speakerSVG:'<svg viewBox="0 0 24 24"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 010 7.07"/><path d="M19.07 4.93a10 10 0 010 14.14"/></svg>',
speakerSVGsm:'<svg viewBox="0 0 24 24"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 010 7.07"/></svg>',
btn(text,sm){return`<button class="sound-btn${sm?" sound-btn-sm":""}" onclick="event.stopPropagation();TTS.playBtn('${text.replace(/'/g,"\\'")}',this)">${sm?this.speakerSVGsm:this.speakerSVG}</button>`}
};

// ================================================================
// CORE: Theme & Router
// ================================================================
const Theme={
init(){const s=Store.load().settings.theme;
  if(s==="auto"){const m=window.matchMedia("(prefers-color-scheme:dark)");this.apply(m.matches?"dark":"light");
    m.addEventListener("change",e=>{if(Store.load().settings.theme==="auto")this.apply(e.matches?"dark":"light")})}
  else this.apply(s)},
apply(t){document.documentElement.setAttribute("data-theme",t);
  const m=document.querySelector('meta[name="theme-color"]');if(m)m.content=t==="dark"?"#1A1A2E":"#FAFAF8"},
set(t){const d=Store.load();d.settings.theme=t;Store.save();if(t==="auto"){const m=window.matchMedia("(prefers-color-scheme:dark)");this.apply(m.matches?"dark":"light")}else this.apply(t)}
};

const Router={
current:"home",
pages:["home","gojuon","vocab","quiz","settings"],
init(){document.getElementById("bottom-nav").addEventListener("click",e=>{
  const item=e.target.closest(".nav-item");if(!item)return;const p=item.dataset.page;if(p)this.go(p)})},
go(name){if(name===this.current||!this.pages.includes(name))return;
  const cur=document.getElementById("page-"+this.current);const tgt=document.getElementById("page-"+name);
  cur.classList.remove("active");setTimeout(()=>{tgt.classList.add("active");this.current=name;
    document.querySelectorAll(".nav-item").forEach(n=>n.classList.toggle("active",n.dataset.page===name));
    this._load(name)},50)},
_load(n){switch(n){case"home":Home.render();break;case"gojuon":Gojuon.render();break;
  case"vocab":VocabMod.init();break;case"quiz":Quiz.init();break;case"settings":Settings.render();break}}
};

// ================================================================
// CORE: Swipe Handler
// ================================================================
const Swipe={
attach(el,opts){
  let sx,sy,dx,dy;
  el.addEventListener('touchstart',e=>{sx=e.touches[0].clientX;sy=e.touches[0].clientY;dx=0;dy=0},{passive:true});
  el.addEventListener('touchmove',e=>{dx=e.touches[0].clientX-sx;dy=e.touches[0].clientY-sy},{passive:true});
  el.addEventListener('touchend',()=>{
    const adx=Math.abs(dx),ady=Math.abs(dy);
    if(adx<40&&ady<40)return;
    if(adx>ady){if(dx>0&&opts.right)opts.right();else if(dx<0&&opts.left)opts.left()}
    else{if(dy<0&&opts.up)opts.up();else if(dy>0&&opts.down)opts.down()}
  },{passive:true})}
};

// ================================================================
// MODULE: Home Dashboard
// ================================================================
const Home={
render(){
  const d=Store.load();const h=new Date().getHours();
  const gr=h<12?"„Åä„ÅØ„Çà„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô":h<18?"„Åì„Çì„Å´„Å°„ÅØ":"„Åì„Çì„Å∞„Çì„ÅØ";
  const due=FSRS.getDue().length;const nw=FSRS.getNew(d.settings.dailyGoal).length;
  const learned=Object.keys(d.vocab).length;const total=VOCAB.length;
  const mastered=Object.values(d.vocab).filter(v=>v.reps>=3&&v.difficulty<5).length;
  const rate=learned>0?Math.round(mastered/learned*100):0;
  const ts=d.todayStats;const prog=ts.wordsReviewed+ts.newWordsLearned;
  const goal=d.settings.dailyGoal;const pct=Math.min(100,Math.round(prog/goal*100));
  const hist=d.streak.history.slice(-7);while(hist.length<7)hist.unshift({date:"",count:0});
  const maxC=Math.max(...hist.map(h=>h.count),1);
  const days=["Êó•","‰∏Ä","‰∫å","‰∏â","Âõõ","‰∫î","ÂÖ≠"];
  let streakMsg="";
  for(const[k,v]of Object.entries(ENCOURAGE.streak).reverse()){if(d.streak.current>=+k){streakMsg=v;break}}
  // Error book count
  const errCount=(d.errorBook||[]).length;
  document.getElementById("home-content").innerHTML=`
    <div class="greeting">${gr}</div>
    <div class="greeting-sub">${d.streak.current>0?`ÈÄ£Á∫åÂ≠∏ÁøíÁ¨¨ ${d.streak.current} Â§© üî•`:"ÈñãÂßã‰Ω†ÁöÑÊó•Ë™ûÂ≠∏Áøí‰πãÊóÖÂêßÔºÅ"}</div>
    ${streakMsg?`<div style="background:var(--accent-warning);color:#fff;padding:8px 12px;border-radius:var(--radius-sm);font-size:13px;margin-bottom:12px;text-align:center">${streakMsg}</div>`:""}
    <div class="card" style="margin-bottom:12px">
      <div style="display:flex;justify-content:space-between;margin-bottom:8px">
        <span style="font-size:14px;font-weight:600">‰ªäÊó•ÈÄ≤Â∫¶</span>
        <span style="font-size:14px;color:var(--text-secondary)">${prog} / ${goal}</span>
      </div>
      <div class="progress-bar"><div class="fill" style="width:${pct}%;background:${pct>=100?"var(--accent-success)":"var(--accent-primary)"}"></div></div>
    </div>
    <div class="stats-row">
      <div class="stat-card"><div class="stat-value">${learned}</div><div class="stat-label">Â∑≤Â≠∏ÂñÆÂ≠ó</div></div>
      <div class="stat-card"><div class="stat-value">${rate}%</div><div class="stat-label">ÊéåÊè°Áéá</div></div>
      <div class="stat-card"><div class="stat-value">${d.streak.current}üî•</div><div class="stat-label">ÈÄ£Á∫åÂ§©Êï∏</div></div>
    </div>
    <div class="today-info">
      <div class="today-chip"><strong>${due}</strong>ÂæÖË§áÁøí</div>
      <div class="today-chip"><strong>${nw}</strong>Êñ∞ÂñÆÂ≠ó</div>
    </div>
    <button class="btn btn-primary btn-block" style="margin:16px 0" onclick="Router.go('vocab')">ÈñãÂßã‰ªäÊó•Â≠∏Áøí</button>
    ${errCount?`<button class="btn btn-secondary btn-block" style="margin-bottom:16px" onclick="ErrorBook.show()">üìï ÈåØÈ°åÊú¨ (${errCount})</button>`:''}
    <div class="card">
      <div style="font-size:13px;font-weight:600;margin-bottom:8px">ÊúÄËøë 7 Â§©</div>
      <div class="mini-chart">${hist.map((h,i)=>`<div class="bar${i===hist.length-1?" today":""}" style="height:${Math.max(8,h.count/maxC*100)}%"></div>`).join("")}</div>
      <div class="chart-labels">${hist.map(h=>{if(!h.date)return"<span>-</span>";const dd=new Date(h.date);return`<span>${days[dd.getDay()]}</span>`}).join("")}</div>
    </div>
    <div style="font-size:12px;color:var(--text-hint);text-align:center;margin-top:12px">FSRS-4.5 Êô∫ÊÖßÈñìÈöîÈáçË§á ¬∑ ${total} ÂÄã N5 ÂñÆÂ≠ó</div>`;
}};

// ================================================================
// MODULE: Error Book (ÈåØÈ°åÊú¨)
// ================================================================
const ErrorBook={
show(){
  const el=document.getElementById("home-content");
  const d=Store.load();const errors=(d.errorBook||[]).sort((a,b)=>b.count-a.count);
  if(!errors.length){el.innerHTML=`<div class="vocab-empty"><div class="emoji">‚úÖ</div><h3>Ê≤íÊúâÈåØÈ°åÔºÅ</h3><p style="margin-top:8px">ÁπºÁ∫åÂä†Ê≤πÔºÅ</p><button class="btn btn-secondary" style="margin-top:16px" onclick="Home.render()">‚Üê ËøîÂõû</button></div>`;return}
  let html=`<div style="margin-bottom:12px;display:flex;justify-content:space-between;align-items:center">
    <button class="btn btn-secondary" onclick="Home.render()">‚Üê ËøîÂõû</button>
    <button class="btn btn-primary" onclick="ErrorBook.review()">Ë§áÁøíÈåØÈ°å</button>
  </div><div class="section-title">üìï ÈåØÈ°åÊú¨</div>`;
  errors.forEach(e=>{
    const v=VOCAB.find(x=>x.id===e.vocabId);if(!v)return;
    html+=`<div class="error-card">
      <div style="flex:1"><div class="error-word">${v.w} <span style="font-size:14px;color:var(--text-secondary)">${v.rd}</span></div>
      <div class="error-info">${v.m} ¬∑ ${v.pos}</div></div>
      <div class="error-count">ÈåØ${e.count}Ê¨°</div>
      ${TTS.btn(v.rd,true)}
    </div>`});
  el.innerHTML=html},
review(){
  const d=Store.load();const errors=(d.errorBook||[]).slice(0,10);
  if(!errors.length)return;
  VocabMod.deck=errors.map(e=>{const v=VOCAB.find(x=>x.id===e.vocabId);
    return v?{vocab:v,card:d.vocab[String(v.id)]||FSRS.newCard()}:null}).filter(Boolean);
  VocabMod.idx=0;VocabMod.flipped=false;VocabMod.session={correct:0,wrong:0,total:VocabMod.deck.length};
  Router.go('vocab');VocabMod.render()}
};

// ================================================================
// MODULE: Gojuon (with writing mode)
// ================================================================
const Gojuon={
script:"hiragana",mode:"chart",deck:[],idx:0,flipped:false,quizItem:null,quizOpts:[],answered:false,
writingPhase:"show",writingTimer:null,
render(){
  const el=document.getElementById("gojuon-content");
  if(this.mode==="chart")this.renderChart(el);
  else if(this.mode==="flashcard")this.renderFlashcard(el);
  else if(this.mode==="writing")this.renderWriting(el);
  else this.renderQuiz(el)},
renderChart(el){
  const d=Store.load();const sc=this.script;
  const rows=[{label:"Ê∏ÖÈü≥ (Âü∫Êú¨)",data:GOJUON.seion},{label:"ÊøÅÈü≥",data:GOJUON.dakuon},{label:"ÂçäÊøÅÈü≥",data:GOJUON.handakuon}];
  let html="";
  rows.forEach(section=>{
    html+=`<div class="gojuon-row-label">${section.label}</div>`;
    const byRow={};section.data.forEach(k=>{if(!byRow[k.row])byRow[k.row]=[];byRow[k.row].push(k)});
    for(const[rn,items]of Object.entries(byRow)){
      const cols=["a","i","u","e","o"];
      cols.forEach(c=>{
        const k=items.find(i=>{
          if(rn==="y")return(c==="a"&&i.r==="ya")||(c==="u"&&i.r==="yu")||(c==="o"&&i.r==="yo");
          if(rn==="w")return(c==="a"&&i.r==="wa")||(c==="o"&&i.r==="wo");
          if(rn==="nn")return c==="a"&&i.r==="n";
          return i.r.endsWith(c)||(i.r===c)});
        if(!k){html+=`<div class="gojuon-cell empty"></div>`;return}
        const mastered=d.gojuon[k.r]&&d.gojuon[k.r].mastered;
        const display=sc==="hiragana"?k.h:sc==="katakana"?k.k:`${k.h}<span style="font-size:14px;color:var(--text-secondary)"> ${k.k}</span>`;
        html+=`<div class="gojuon-cell${mastered?" mastered":""}" onclick="Gojuon.showDetail('${k.r}')">${display}<span class="romaji">${k.r}</span></div>`})}});
  el.innerHTML=`<div class="gojuon-grid">${html}</div>`},
showDetail(r){
  const k=ALL_KANA.find(x=>x.r===r);if(!k)return;TTS.speak(k.h);
  showModal(k.h+" / "+k.k,`ÁæÖÈ¶¨ÊãºÈü≥Ôºö${k.r}`,[{text:"üîä ÂÜçËÅΩ",cls:"btn-primary",action:()=>TTS.speak(k.h)},{text:"ÈóúÈñâ",cls:"btn-secondary",action:hideModal}])},
renderFlashcard(el){
  if(!this.deck.length){this.deck=shuffle(ALL_KANA);this.idx=0;this.flipped=false}
  const k=this.deck[this.idx];const sc=this.script;const front=sc==="katakana"?k.k:k.h;
  el.innerHTML=`
    <div style="text-align:center;margin-bottom:8px;color:var(--text-secondary);font-size:14px">${this.idx+1} / ${this.deck.length}</div>
    <div class="flashcard-container" id="fc-container">
      <div class="flashcard${this.flipped?" flipped":""}" onclick="Gojuon.flip()">
        <div class="flashcard-face"><div class="char">${front}</div><div class="label">ÈªûÊìäÁøªËΩâ ¬∑ Â∑¶Âè≥ÊªëÂãïÂàáÊèõ</div></div>
        <div class="flashcard-face flashcard-back">
          <div class="romaji-big">${k.r}</div>
          <div style="margin-top:8px;font-size:18px;color:var(--text-secondary)">${k.h} / ${k.k}</div>
          <div style="margin-top:12px">${TTS.btn(k.h)}</div>
        </div>
      </div>
    </div>
    ${this.flipped?`<div class="flashcard-nav">
      <button class="btn btn-error" onclick="Gojuon.rate(false)">‰∏çË™çË≠ò</button>
      <button class="btn btn-success" onclick="Gojuon.rate(true)">Ë™çË≠ò</button>
    </div>`:''}
    <div class="swipe-hint">‚Üê ‰∏çË™çË≠ò ¬∑ Ë™çË≠ò ‚Üí</div>`;
  TTS.speak(k.h);
  setTimeout(()=>{const c=document.getElementById('fc-container');
    if(c)Swipe.attach(c,{left:()=>Gojuon.rate(false),right:()=>Gojuon.rate(true),up:()=>Gojuon.flip()})},100)},
flip(){this.flipped=!this.flipped;this.renderFlashcard(document.getElementById("gojuon-content"))},
rate(ok){
  const k=this.deck[this.idx];const d=Store.load();
  if(!d.gojuon[k.r])d.gojuon[k.r]={mastered:false,correctCount:0,wrongCount:0,lastPracticed:today()};
  if(ok){d.gojuon[k.r].correctCount++;if(d.gojuon[k.r].correctCount>=3)d.gojuon[k.r].mastered=true}
  else{d.gojuon[k.r].wrongCount++;d.gojuon[k.r].mastered=false}
  d.gojuon[k.r].lastPracticed=today();d.todayStats.gojuonPracticed++;
  Store.save();Store.updateStreak();
  if(navigator.vibrate)navigator.vibrate(ok?[30]:[50,30,50]);
  this.idx++;this.flipped=false;
  if(this.idx>=this.deck.length){this.deck=[];this.idx=0;
    showModal("ÂÆåÊàêÔºÅ",pick(ENCOURAGE.completion),[{text:"ÂÜç‰æÜ‰∏ÄÊ¨°",cls:"btn-primary",action:()=>{hideModal();Gojuon.render()}},{text:"ÈóúÈñâ",cls:"btn-secondary",action:hideModal}]);return}
  this.renderFlashcard(document.getElementById("gojuon-content"))},
renderWriting(el){
  if(!this.deck.length){this.deck=shuffle(ALL_KANA);this.idx=0}
  const k=this.deck[this.idx];const sc=this.script;const ch=sc==="katakana"?k.k:k.h;
  if(this.writingPhase==="show"){
    el.innerHTML=`<div style="text-align:center;color:var(--text-secondary);font-size:14px;margin-bottom:8px">${this.idx+1} / ${this.deck.length}</div>
      <div style="text-align:center;font-size:14px;color:var(--accent-primary);margin-bottom:8px">Ë®ò‰ΩèÈÄôÂÄãÂ≠óÔºÅ</div>
      <div class="writing-grid"><div class="writing-char">${ch}</div></div>
      <div style="text-align:center;margin-top:8px;font-size:13px;color:var(--text-hint)">${k.r}</div>`;
    TTS.speak(k.h);
    clearTimeout(this.writingTimer);
    this.writingTimer=setTimeout(()=>{this.writingPhase="practice";this.renderWriting(el)},2500);
  }else if(this.writingPhase==="practice"){
    el.innerHTML=`<div style="text-align:center;color:var(--text-secondary);font-size:14px;margin-bottom:8px">${this.idx+1} / ${this.deck.length}</div>
      <div style="text-align:center;font-size:14px;color:var(--accent-warning);margin-bottom:8px">Âú®ËÖ¶‰∏≠ÂõûÊÉ≥ÈÄôÂÄãÂ≠ó...</div>
      <div class="writing-grid"><div class="writing-char dim">${ch}</div></div>
      <div style="text-align:center;margin-top:8px;font-size:16px;font-weight:600">${k.r}</div>
      <div style="text-align:center;margin-top:16px">
        <button class="btn btn-secondary" onclick="Gojuon.writingReveal()">È°ØÁ§∫Á≠îÊ°à</button>
      </div>`;
  }else{
    el.innerHTML=`<div style="text-align:center;color:var(--text-secondary);font-size:14px;margin-bottom:8px">${this.idx+1} / ${this.deck.length}</div>
      <div style="text-align:center;font-size:14px;color:var(--accent-success);margin-bottom:8px">Á≠îÊ°àÊè≠Êõâ</div>
      <div class="writing-grid"><div class="writing-char">${ch}</div></div>
      <div style="text-align:center;margin-top:8px;font-size:16px">${k.r} ¬∑ ${k.h} / ${k.k}</div>
      <div style="display:flex;gap:12px;justify-content:center;margin-top:16px">
        <button class="btn btn-error" onclick="Gojuon.writingRate(false)">‰∏çË®òÂæó</button>
        <button class="btn btn-success" onclick="Gojuon.writingRate(true)">Ë®òÂæó</button>
      </div>`;
    TTS.speak(k.h)}},
writingReveal(){this.writingPhase="reveal";this.renderWriting(document.getElementById("gojuon-content"))},
writingRate(ok){
  const k=this.deck[this.idx];const d=Store.load();
  if(!d.gojuon[k.r])d.gojuon[k.r]={mastered:false,correctCount:0,wrongCount:0,lastPracticed:today()};
  if(ok){d.gojuon[k.r].correctCount++;if(d.gojuon[k.r].correctCount>=3)d.gojuon[k.r].mastered=true}
  else{d.gojuon[k.r].wrongCount++}
  d.gojuon[k.r].lastPracticed=today();d.todayStats.gojuonPracticed++;Store.save();Store.updateStreak();
  this.idx++;this.writingPhase="show";
  if(this.idx>=this.deck.length){this.deck=[];this.idx=0;
    showModal("Êõ∏ÂØ´Á∑¥ÁøíÂÆåÊàêÔºÅ",pick(ENCOURAGE.completion),[{text:"ÂÜç‰æÜ",cls:"btn-primary",action:()=>{hideModal();Gojuon.render()}},{text:"ÈóúÈñâ",cls:"btn-secondary",action:hideModal}]);return}
  this.renderWriting(document.getElementById("gojuon-content"))},
renderQuiz(el){
  if(!this.quizItem||this.answered){
    this.answered=false;const pool=shuffle(ALL_KANA);this.quizItem=pool[0];
    const wrongs=pool.slice(1,4);this.quizOpts=shuffle([this.quizItem,...wrongs])}
  const k=this.quizItem;const sc=this.script;const qChar=sc==="katakana"?k.k:k.h;
  el.innerHTML=`
    <div class="quiz-header"><div style="font-size:14px;color:var(--text-secondary)">ÈÄôÂÄãÂÅáÂêçÁöÑÁæÖÈ¶¨ÊãºÈü≥ÊòØÔºü</div></div>
    <div class="quiz-question">${qChar}</div>
    <div class="quiz-options">${this.quizOpts.map((o,i)=>`<button class="quiz-option" id="gq${i}" onclick="Gojuon.answer(${i})">${o.r}</button>`).join("")}</div>
    <div class="quiz-feedback" id="gojuon-feedback"></div>`;
  TTS.speak(k.h)},
answer(i){
  if(this.answered)return;this.answered=true;
  const chosen=this.quizOpts[i];const correct=chosen.r===this.quizItem.r;
  const d=Store.load();const k=this.quizItem;
  if(!d.gojuon[k.r])d.gojuon[k.r]={mastered:false,correctCount:0,wrongCount:0,lastPracticed:today()};
  if(correct){d.gojuon[k.r].correctCount++;if(d.gojuon[k.r].correctCount>=3)d.gojuon[k.r].mastered=true}
  else{d.gojuon[k.r].wrongCount++}
  d.gojuon[k.r].lastPracticed=today();d.todayStats.gojuonPracticed++;Store.save();Store.updateStreak();
  if(navigator.vibrate)navigator.vibrate(correct?[30]:[50,30,50]);
  document.getElementById("gq"+i).classList.add(correct?"correct":"wrong");
  if(!correct){const ci=this.quizOpts.findIndex(o=>o.r===this.quizItem.r);document.getElementById("gq"+ci).classList.add("correct")}
  document.getElementById("gojuon-feedback").textContent=correct?pick(ENCOURAGE.correct):pick(ENCOURAGE.wrong);
  document.getElementById("gojuon-feedback").style.color=correct?"var(--accent-success)":"var(--accent-error)";
  TTS.speak(this.quizItem.h);
  setTimeout(()=>{this.quizItem=null;this.renderQuiz(document.getElementById("gojuon-content"))},1200)}
};
// Gojuon pill handlers
document.getElementById("gojuon-script-pills").addEventListener("click",e=>{
  const p=e.target.closest(".pill");if(!p)return;
  document.querySelectorAll("#gojuon-script-pills .pill").forEach(x=>x.classList.remove("active"));
  p.classList.add("active");Gojuon.script=p.dataset.script;Gojuon.render()});
document.getElementById("gojuon-mode-pills").addEventListener("click",e=>{
  const p=e.target.closest(".pill");if(!p)return;
  document.querySelectorAll("#gojuon-mode-pills .pill").forEach(x=>x.classList.remove("active"));
  p.classList.add("active");Gojuon.mode=p.dataset.mode;Gojuon.deck=[];Gojuon.quizItem=null;Gojuon.writingPhase="show";Gojuon.render()});

// ================================================================
// MODULE: Vocab
// ================================================================
const VocabMod={
deck:[],idx:0,flipped:false,session:{correct:0,wrong:0,total:0},
init(){
  const d=Store.load();const due=FSRS.getDue();
  const newCards=FSRS.getNew(Math.max(1,d.settings.dailyGoal-due.length));
  this.deck=[...due.map(c=>{const v=VOCAB.find(x=>x.id===+c.id);return v?{vocab:v,card:c}:null}).filter(Boolean),
    ...newCards.map(v=>({vocab:v,card:FSRS.newCard()}))];
  this.idx=0;this.flipped=false;this.session={correct:0,wrong:0,total:this.deck.length};
  this.render()},
render(){
  const el=document.getElementById("vocab-content");
  if(!this.deck.length){el.innerHTML=`<div class="vocab-empty"><div class="emoji">üéå</div><h3>‰ªäÊó•Â≠∏ÁøíÂÆåÊàêÔºÅ</h3><p style="margin-top:8px;color:var(--text-secondary)">ÊòéÂ§©ÂÜç‰æÜË§áÁøíÂêß</p><button class="btn btn-secondary" style="margin-top:16px" onclick="VocabMod.browseAll()">ÁÄèË¶ΩÊâÄÊúâÂñÆÂ≠ó</button></div>`;return}
  if(this.idx>=this.deck.length){this.renderComplete(el);return}
  const item=this.deck[this.idx];const v=item.vocab;
  const pct=Math.round(this.idx/this.deck.length*100);
  el.innerHTML=`
    <div class="vocab-progress">
      <div class="count">${this.idx+1} / ${this.deck.length}</div>
      <div class="progress-bar" style="flex:1"><div class="fill" style="width:${pct}%"></div></div>
    </div>
    <div class="vocab-card-container" id="vc-container">
      <div class="vocab-card${this.flipped?" flipped":""}" onclick="VocabMod.flip()">
        <div class="vocab-face"><div class="word">${v.w}</div><div class="hint">ÈªûÊìäÁøªËΩâ ¬∑ Â∑¶Âè≥ÊªëÂãïË©ïÂàÜ</div></div>
        <div class="vocab-face vocab-back">
          <div style="display:flex;align-items:center;justify-content:center;gap:8px">
            <div class="reading">${v.rd}</div>${TTS.btn(v.rd,true)}
          </div>
          <div class="romaji-sm">${v.ro}</div>
          <div class="meaning">${v.m}</div>
          <div class="pos">${v.pos}</div>
          <div class="example"><div class="ja">${v.ex.ja}</div><div class="zh">${v.ex.zh}</div></div>
        </div>
      </div>
    </div>
    ${this.flipped?`<div class="vocab-rating">
      <button class="rate-btn r1" onclick="VocabMod.rate(1)">üòµ ÂøòË®ò</button>
      <button class="rate-btn r2" onclick="VocabMod.rate(2)">üòê Âõ∞Èõ£</button>
      <button class="rate-btn r3" onclick="VocabMod.rate(3)">üôÇ ÊÉ≥‰∏Ä‰∏ã</button>
      <button class="rate-btn r4" onclick="VocabMod.rate(4)">üòé ÁßíÁ≠î</button>
    </div>`:""}
    <div class="swipe-hint">‚Üê ÂøòË®ò ¬∑ ÁßíÁ≠î ‚Üí</div>`;
  TTS.speak(v.rd);
  setTimeout(()=>{const c=document.getElementById('vc-container');
    if(c)Swipe.attach(c,{left:()=>{if(this.flipped)this.rate(1);else this.flip()},
      right:()=>{if(this.flipped)this.rate(4);else this.flip()},up:()=>this.flip()})},100)},
flip(){if(!this.flipped){this.flipped=true;this.render()}},
rate(q){
  const item=this.deck[this.idx];const d=Store.load();const id=String(item.vocab.id);
  if(!d.vocab[id])d.vocab[id]=FSRS.newCard();
  const result=FSRS.review(d.vocab[id],q);
  d.vocab[id]={...d.vocab[id],...result};
  if(q>=2){this.session.correct++;
    if(item.card.reps===0)d.todayStats.newWordsLearned++;else d.todayStats.wordsReviewed++}
  else{this.session.wrong++;d.todayStats.wordsReviewed++;Store.addError(item.vocab.id)}
  Store.save();Store.updateStreak();
  if(navigator.vibrate)navigator.vibrate(q>=3?[30]:[50,30,50]);
  this.idx++;this.flipped=false;this.render()},
renderComplete(el){
  const total=this.session.correct+this.session.wrong;
  const pct=total>0?Math.round(this.session.correct/total*100):0;
  const d=Store.load();Achievements.check(d);
  el.innerHTML=`<div class="vocab-complete anim-fade-in">
    <div class="emoji">üéâ</div><h2>‰ªäÊó•Â≠∏ÁøíÂÆåÊàêÔºÅ</h2>
    <div class="result-circle" style="background:conic-gradient(var(--accent-success) ${pct*3.6}deg,var(--bg-secondary) 0)">
      <div style="width:110px;height:110px;border-radius:50%;background:var(--bg-primary);display:flex;flex-direction:column;align-items:center;justify-content:center">
        <div class="pct">${pct}%</div><div class="pct-label">Ê≠£Á¢∫Áéá</div>
      </div>
    </div>
    <div class="stats" style="color:var(--text-secondary);line-height:2">Ê≠£Á¢∫Ôºö${this.session.correct} ÂÄã<br>ÈúÄÂä†Âº∑Ôºö${this.session.wrong} ÂÄã<br>Á∏ΩË®àÔºö${total} ÂÄã</div>
    <div style="font-size:16px;font-weight:600;margin-bottom:16px;color:var(--accent-primary)">${pick(ENCOURAGE.completion)}</div>
    <button class="btn btn-primary" onclick="Router.go('home')">ÂõûÂà∞È¶ñÈ†Å</button>
  </div>`},
browseAll(){
  const el=document.getElementById("vocab-content");
  const cats={verb:"ÂãïË©û",noun:"ÂêçË©û",adj:"ÂΩ¢ÂÆπË©û",place:"Â†¥ÊâÄ",people:"‰∫∫Áâ©",time:"ÊôÇÈñì",greet:"ÊãõÂëº",num:"Êï∏Èáè",food:"È£ü„ÅπÁâ©",color:"Ëâ≤",nature:"Ëá™ÁÑ∂",body:"‰Ωì",verb2:"ÂãïË©û2",adverb:"ÂâØË©û"};
  let html='<div style="margin-bottom:12px"><button class="btn btn-secondary" onclick="VocabMod.init()">‚Üê ËøîÂõû</button></div>';
  Object.entries(cats).forEach(([cat,label])=>{
    const words=VOCAB.filter(v=>v.cat===cat);if(!words.length)return;
    html+=`<div style="font-size:14px;font-weight:600;margin:12px 0 8px;color:var(--accent-secondary)">${label} (${words.length})</div>`;
    words.forEach(v=>{
      html+=`<div class="card" style="margin-bottom:8px;padding:12px">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
          <div style="flex:1"><span style="font-size:18px;font-weight:700">${v.w}</span> <span style="color:var(--text-secondary);font-size:14px">${v.rd}</span></div>
          ${TTS.btn(v.rd,true)}<div style="font-size:15px">${v.m}</div>
        </div>
        <div style="font-size:12px;color:var(--text-hint);margin-top:4px">${v.pos} | ${v.ex.ja} ‚Üí ${v.ex.zh}</div>
      </div>`})});
  el.innerHTML=html}
};

// ================================================================
// MODULE: Quiz
// ================================================================
const Quiz={
state:"setup",type:"vocab_choice",count:10,questions:[],qIdx:0,answers:[],startTime:0,
init(){this.state="setup";this.renderSetup()},
renderSetup(){
  const el=document.getElementById("quiz-content");
  const types=[
    {id:"vocab_choice",name:"ÂñÆÂ≠óÈÅ∏ÊìáÈ°å (Êó•‚Üí‰∏≠)",desc:"ÁúãÊó•ÊñáÈÅ∏‰∏≠ÊñáÊÑèÊÄù"},
    {id:"vocab_reverse",name:"ÂèçÂêëÈÅ∏ÊìáÈ°å (‰∏≠‚ÜíÊó•)",desc:"Áúã‰∏≠ÊñáÈÅ∏Êó•Êñá"},
    {id:"vocab_typing",name:"ÊâìÂ≠óÂ°´Á©∫",desc:"Áúã‰∏≠ÊñáÊâìÂá∫ÂÅáÂêçËÆÄÈü≥"},
    {id:"gojuon_quiz",name:"‰∫îÂçÅÈü≥Ê∏¨È©ó",desc:"ÁúãÂÅáÂêçÈÅ∏ÁæÖÈ¶¨ÊãºÈü≥"}
  ];
  el.innerHTML=`<div class="quiz-setup">
    <h2 style="text-align:center;margin-bottom:16px">ÈÅ∏ÊìáÊ∏¨È©óÈ°ûÂûã</h2>
    <div class="quiz-type-list">${types.map(t=>`<div class="quiz-type-item${this.type===t.id?" selected":""}" onclick="Quiz.setType('${t.id}')"><h4>${t.name}</h4><p>${t.desc}</p></div>`).join("")}</div>
    <div style="text-align:center;font-size:14px;color:var(--text-secondary);margin-bottom:4px">È°åÊï∏</div>
    <div class="quiz-count">
      <button onclick="Quiz.adjCount(-5)">-</button><div class="num">${this.count}</div><button onclick="Quiz.adjCount(5)">+</button>
    </div>
    <button class="btn btn-primary btn-block" style="margin-top:16px" onclick="Quiz.start()">ÈñãÂßãÊ∏¨È©ó</button>
  </div>`},
setType(t){this.type=t;this.renderSetup()},
adjCount(n){this.count=Math.max(5,Math.min(30,this.count+n));this.renderSetup()},
start(){
  this.questions=[];this.answers=[];this.qIdx=0;this.startTime=Date.now();
  if(this.type==="gojuon_quiz"){
    const pool=shuffle(ALL_KANA).slice(0,this.count);
    pool.forEach(k=>{const opts=shuffle([k,...shuffle(ALL_KANA.filter(x=>x.r!==k.r)).slice(0,3)]);
      this.questions.push({type:"gojuon",question:k.h,answer:k.r,options:opts.map(o=>o.r)})});
  }else{
    const pool=shuffle(VOCAB).slice(0,this.count);
    pool.forEach(v=>{
      const sameC=VOCAB.filter(x=>x.cat===v.cat&&x.id!==v.id);
      const otherC=VOCAB.filter(x=>x.cat!==v.cat);
      let wrongs=[...shuffle(sameC).slice(0,2),...shuffle(otherC).slice(0,2)].slice(0,3);
      if(wrongs.length<3)wrongs=[...wrongs,...shuffle(VOCAB.filter(x=>x.id!==v.id)).slice(0,3-wrongs.length)];
      if(this.type==="vocab_choice")this.questions.push({type:"choice",question:v.w,answer:v.m,answerFull:v,options:shuffle([v,...wrongs]).map(o=>o.m)});
      else if(this.type==="vocab_reverse")this.questions.push({type:"reverse",question:v.m,answer:v.w,answerFull:v,options:shuffle([v,...wrongs]).map(o=>o.w)});
      else this.questions.push({type:"typing",question:v.m+"Ôºà"+v.pos+"Ôºâ",answer:v.rd,answerRo:v.ro,answerFull:v})});
  }
  this.state="playing";this.renderQuestion()},
renderQuestion(){
  const el=document.getElementById("quiz-content");
  if(this.qIdx>=this.questions.length){this.renderResult(el);return}
  const q=this.questions[this.qIdx];
  let html=`<div style="text-align:center;color:var(--text-secondary);font-size:14px;margin-bottom:8px">${this.qIdx+1} / ${this.questions.length}</div>
    <div class="progress-bar" style="margin-bottom:16px"><div class="fill" style="width:${Math.round(this.qIdx/this.questions.length*100)}%"></div></div>`;
  if(q.type==="typing"){
    html+=`<div style="text-align:center;font-size:14px;color:var(--text-secondary);margin-bottom:8px">Ë´ãËº∏ÂÖ•ÂÅáÂêçËÆÄÈü≥</div>
      <div class="quiz-question" style="font-size:28px">${q.question}</div>
      <input class="typing-input" id="typing-ans" placeholder="Ëº∏ÂÖ•ËÆÄÈü≥..." onkeydown="if(event.key==='Enter')Quiz.submitTyping()">
      <div class="typing-feedback" id="typing-fb"></div>
      <button class="btn btn-primary btn-block" style="margin-top:12px;max-width:300px;margin-left:auto;margin-right:auto" onclick="Quiz.submitTyping()">Á¢∫Ë™ç</button>`;
  }else{
    html+=`<div style="text-align:center;font-size:14px;color:var(--text-secondary)">${q.type==="gojuon"?"ÈÄôÂÄãÂÅáÂêçÁöÑÁæÖÈ¶¨ÊãºÈü≥ÊòØÔºü":"ÈÅ∏Âá∫Ê≠£Á¢∫Á≠îÊ°à"}</div>
      <div class="quiz-question">${q.question}</div>
      <div class="quiz-options">${q.options.map((o,i)=>`<button class="quiz-option" id="qo${i}" onclick="Quiz.pick(${i})">${o}</button>`).join("")}</div>
      <div class="quiz-feedback" id="quiz-fb"></div>`}
  el.innerHTML=html;
  if(q.type==="typing")setTimeout(()=>{const inp=document.getElementById("typing-ans");if(inp)inp.focus()},100);
  if(q.type==="choice"&&q.answerFull)TTS.speak(q.answerFull.rd);
  else if(q.type==="gojuon"){const k=ALL_KANA.find(x=>x.h===q.question);if(k)TTS.speak(k.h)}},
pick(i){
  const q=this.questions[this.qIdx];const chosen=q.options[i];const correct=chosen===q.answer;
  this.answers.push({q:q.question,chosen,correct:q.answer,isCorrect:correct});
  document.getElementById("qo"+i).classList.add(correct?"correct":"wrong");
  if(!correct){const ci=q.options.indexOf(q.answer);if(ci>=0)document.getElementById("qo"+ci).classList.add("correct");
    if(q.answerFull)Store.addError(q.answerFull.id,chosen,q.answer)}
  const fb=document.getElementById("quiz-fb");fb.textContent=correct?pick(ENCOURAGE.correct):pick(ENCOURAGE.wrong);
  fb.style.color=correct?"var(--accent-success)":"var(--accent-error)";
  document.querySelectorAll(".quiz-option").forEach(b=>b.style.pointerEvents="none");
  if(navigator.vibrate)navigator.vibrate(correct?[30]:[50,30,50]);
  if(q.answerFull)TTS.speak(q.answerFull.rd);
  else if(q.type==="gojuon"){const k=ALL_KANA.find(x=>x.r===q.answer);if(k)TTS.speak(k.h)}
  setTimeout(()=>{this.qIdx++;this.renderQuestion()},1000)},
submitTyping(){
  const inp=document.getElementById("typing-ans");if(!inp)return;
  const val=inp.value.trim();if(!val)return;
  const q=this.questions[this.qIdx];const correct=this.checkTyping(val,q.answer,q.answerRo);
  this.answers.push({q:q.question,chosen:val,correct:q.answer,isCorrect:correct});
  if(!correct&&q.answerFull)Store.addError(q.answerFull.id,val,q.answer);
  const fb=document.getElementById("typing-fb");
  fb.innerHTML=correct?`<span style="color:var(--accent-success)">${pick(ENCOURAGE.correct)}</span>`
    :`<span style="color:var(--accent-error)">${pick(ENCOURAGE.wrong)}<br>Ê≠£Á¢∫Á≠îÊ°àÔºö${q.answer}</span>`;
  inp.disabled=true;TTS.speak(q.answer);
  setTimeout(()=>{this.qIdx++;this.renderQuestion()},1200)},
checkTyping(input,answer,romaji){
  const n=input.toLowerCase().trim();const a=answer.toLowerCase();
  if(n===a||n===romaji)return true;
  const vars={si:"shi",ti:"chi",tu:"tsu",hu:"fu",zi:"ji"};
  let mod=n;for(const[k,v]of Object.entries(vars)){mod=mod.replace(k,v)}
  if(mod===romaji)return true;
  mod=n;for(const[k,v]of Object.entries(vars)){mod=mod.replace(v,k)}
  if(mod===romaji)return true;return false},
renderResult(el){
  const d=Store.load();const correct=this.answers.filter(a=>a.isCorrect).length;
  const total=this.answers.length;const pct=Math.round(correct/total*100);
  const duration=Math.round((Date.now()-this.startTime)/1000);
  const wrongs=this.answers.filter(a=>!a.isCorrect);
  d.quizHistory.push({id:"q_"+Date.now(),type:this.type,date:new Date().toISOString(),
    totalQuestions:total,correctAnswers:correct,wrongAnswers:wrongs.map(w=>({q:w.q,user:w.chosen,correct:w.correct})),duration});
  if(d.quizHistory.length>50)d.quizHistory=d.quizHistory.slice(-50);
  d.todayStats.quizzesTaken++;d.todayStats.correctRate=pct;
  Store.save();Store.updateStreak();Achievements.check(d);
  this.state="result";
  el.innerHTML=`<div class="quiz-result anim-fade-in">
    <h2>Ê∏¨È©óÁµêÊûú</h2>
    <div class="result-circle" style="background:conic-gradient(${pct>=80?"var(--accent-success)":pct>=50?"var(--accent-warning)":"var(--accent-error)"} ${pct*3.6}deg,var(--bg-secondary) 0);margin:20px auto">
      <div style="width:110px;height:110px;border-radius:50%;background:var(--bg-primary);display:flex;flex-direction:column;align-items:center;justify-content:center">
        <div class="pct">${pct}%</div><div class="pct-label">Ê≠£Á¢∫Áéá</div>
      </div>
    </div>
    <div style="color:var(--text-secondary);margin-bottom:16px">Á≠îÂ∞ç ${correct} / ${total} È°å ¬∑ ËÄóÊôÇ ${duration} Áßí</div>
    <div style="font-size:16px;font-weight:600;color:var(--accent-primary);margin-bottom:16px">${pick(pct>=80?ENCOURAGE.correct:ENCOURAGE.wrong)}</div>
    ${wrongs.length?`<div class="wrong-list"><div style="font-weight:600;margin-bottom:8px">ÈåØÈ°åÂõûÈ°ßÔºö</div>${wrongs.map(w=>`<div class="wrong-item"><div class="q">${w.q}</div><div class="a">‰Ω†ÁöÑÁ≠îÊ°àÔºö${w.chosen}</div><div class="c">Ê≠£Á¢∫Á≠îÊ°àÔºö${w.correct}</div></div>`).join("")}</div>`:""}
    <div style="display:flex;gap:8px;margin-top:16px">
      ${wrongs.length?`<button class="btn btn-secondary" style="flex:1" onclick="Quiz.retryWrong()">ÈáçÊ∏¨ÈåØÈ°å</button>`:""}
      <button class="btn btn-primary" style="flex:1" onclick="Quiz.init()">ÂÜçÊ∏¨‰∏ÄÊ¨°</button>
    </div>
  </div>`},
retryWrong(){
  const wrongs=this.answers.filter(a=>!a.isCorrect);
  this.questions=[];this.answers=[];this.qIdx=0;this.startTime=Date.now();
  wrongs.forEach(w=>{
    if(this.type==="gojuon_quiz"){
      const k=ALL_KANA.find(x=>x.h===w.q);if(!k)return;
      const opts=shuffle([k,...shuffle(ALL_KANA.filter(x=>x.r!==k.r)).slice(0,3)]);
      this.questions.push({type:"gojuon",question:k.h,answer:k.r,options:opts.map(o=>o.r)});
    }else{
      const v=VOCAB.find(x=>x.w===w.q||x.m===w.q||x.m+"Ôºà"+x.pos+"Ôºâ"===w.q);if(!v)return;
      const wr=shuffle(VOCAB.filter(x=>x.id!==v.id)).slice(0,3);
      if(this.type==="vocab_choice")this.questions.push({type:"choice",question:v.w,answer:v.m,answerFull:v,options:shuffle([v,...wr]).map(o=>o.m)});
      else if(this.type==="vocab_reverse")this.questions.push({type:"reverse",question:v.m,answer:v.w,answerFull:v,options:shuffle([v,...wr]).map(o=>o.w)});
      else this.questions.push({type:"typing",question:v.m+"Ôºà"+v.pos+"Ôºâ",answer:v.rd,answerRo:v.ro,answerFull:v})}
  });
  if(!this.questions.length){this.init();return}
  this.state="playing";this.renderQuestion()}
};

// ================================================================
// MODULE: Settings (with Achievements gallery + Install prompt)
// ================================================================
let deferredInstallPrompt=null;
const Settings={
render(){
  const d=Store.load();const el=document.getElementById("settings-content");
  const achHtml=Achievements.list.map(a=>{
    const unlocked=d.achievements&&d.achievements.includes(a.id);
    return`<div class="achievement-item ${unlocked?'unlocked':'locked'}">
      <div class="ach-icon">${a.icon}</div><div class="ach-name">${a.name}</div><div class="ach-desc">${a.desc}</div></div>`}).join('');
  el.innerHTML=`
    <div class="settings-group">
      <div class="settings-group-title">Â§ñËßÄ</div>
      <div class="settings-item">
        <span class="label">‰∏ªÈ°åÊ®°Âºè</span>
        <div class="theme-btns">
          <button class="theme-btn${d.settings.theme==="light"?" active":""}" onclick="Settings.setTheme('light')">Ê∑∫Ëâ≤</button>
          <button class="theme-btn${d.settings.theme==="dark"?" active":""}" onclick="Settings.setTheme('dark')">Ê∑±Ëâ≤</button>
          <button class="theme-btn${d.settings.theme==="auto"?" active":""}" onclick="Settings.setTheme('auto')">Ëá™Âãï</button>
        </div>
      </div>
    </div>
    <div class="settings-group">
      <div class="settings-group-title">Â≠∏ÁøíË®≠ÂÆö</div>
      <div class="settings-item">
        <span class="label">ÊØèÊó•Êñ∞ÂñÆÂ≠ó</span>
        <div class="daily-adj">
          <button onclick="Settings.adjGoal(-1)">-</button>
          <span class="num">${d.settings.dailyGoal}</span>
          <button onclick="Settings.adjGoal(1)">+</button>
        </div>
      </div>
      <div class="settings-item">
        <span class="label">üîä ÁôºÈü≥ÂäüËÉΩ</span>
        <div class="theme-btns">
          <button class="theme-btn${d.settings.soundEnabled?" active":""}" onclick="Settings.setSound(true)">ÈñãÂïü</button>
          <button class="theme-btn${!d.settings.soundEnabled?" active":""}" onclick="Settings.setSound(false)">ÈóúÈñâ</button>
        </div>
      </div>
    </div>
    <div class="settings-group">
      <div class="settings-group-title">ÊàêÂ∞± (${(d.achievements||[]).length}/${Achievements.list.length})</div>
      <div class="achievement-grid">${achHtml}</div>
    </div>
    <div class="settings-group">
      <div class="settings-group-title">ÊáâÁî®Á®ãÂºè</div>
      <button class="install-btn" id="install-btn" onclick="Settings.installApp()">üì≤ ÂÆâË£ùÂà∞‰∏ªËû¢Âπï</button>
    </div>
    <div class="settings-group">
      <div class="settings-group-title">Ë≥áÊñôÁÆ°ÁêÜ</div>
      <div class="settings-item" style="cursor:pointer" onclick="Store.exportData()">
        <span class="label">ÂåØÂá∫Â≠∏ÁøíË®òÈåÑ</span><span class="value">‰∏ãËºâ JSON ‚Üí</span>
      </div>
      <div class="settings-item" style="cursor:pointer" onclick="document.getElementById('import-file').click()">
        <span class="label">ÂåØÂÖ•Â≠∏ÁøíË®òÈåÑ</span><span class="value">‰∏äÂÇ≥ JSON ‚Üí</span>
      </div>
      <input type="file" id="import-file" class="file-input" accept=".json" onchange="Settings.importFile(event)">
    </div>
    <div class="settings-group">
      <div class="settings-group-title">Â≠∏ÁøíÁµ±Ë®à</div>
      <div class="settings-item"><span class="label">Á∏ΩÂ≠∏ÁøíÂñÆÂ≠ó</span><span class="value">${Object.keys(d.vocab).length} / ${VOCAB.length}</span></div>
      <div class="settings-item"><span class="label">ÊúÄÈï∑ÈÄ£Á∫åÂ§©Êï∏</span><span class="value">${d.streak.longest} Â§©</span></div>
      <div class="settings-item"><span class="label">Ê∏¨È©óÊ¨°Êï∏</span><span class="value">${d.quizHistory.length} Ê¨°</span></div>
      <div class="settings-item"><span class="label">ÈåØÈ°åÊï∏</span><span class="value">${(d.errorBook||[]).length}</span></div>
      <div class="settings-item"><span class="label">ÊºîÁÆóÊ≥ï</span><span class="value">FSRS-4.5</span></div>
    </div>
    <div class="settings-group">
      <div class="settings-group-title">Âç±Èö™ÂçÄÂüü</div>
      <button class="danger-btn" onclick="Settings.confirmReset()">ÈáçÁΩÆÊâÄÊúâÈÄ≤Â∫¶</button>
    </div>
    <div class="version-info">Êó•Êú¨Ë™û„Éû„Çπ„Çø„Éº v2.0.0<br>FSRS-4.5 Êô∫ÊÖßÈñìÈöîÈáçË§áÊºîÁÆóÊ≥ï<br>Ë≥áÊñôÂÑ≤Â≠òÊñºÁÄèË¶ΩÂô®Êú¨Ê©ü</div>`;
  // Show install button if available
  if(deferredInstallPrompt){document.getElementById('install-btn').style.display='block'}},
setTheme(t){Theme.set(t);this.render()},
setSound(v){const d=Store.load();d.settings.soundEnabled=v;Store.save();this.render();if(v)TTS.speak("„Åì„Çì„Å´„Å°„ÅØ")},
adjGoal(n){const d=Store.load();d.settings.dailyGoal=Math.max(1,Math.min(30,d.settings.dailyGoal+n));Store.save();this.render()},
importFile(e){const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=ev=>{
  if(Store.importData(ev.target.result)){showModal("ÂåØÂÖ•ÊàêÂäü","Â≠∏ÁøíË®òÈåÑÂ∑≤ÊàêÂäüÈÇÑÂéüÔºÅ",[{text:"Á¢∫ÂÆö",cls:"btn-primary",action:()=>{hideModal();Settings.render()}}])}
  else{showModal("ÂåØÂÖ•Â§±Êïó","Ê™îÊ°àÊ†ºÂºè‰∏çÊ≠£Á¢∫",[{text:"ÈóúÈñâ",cls:"btn-secondary",action:hideModal}])}};r.readAsText(f)},
confirmReset(){showModal("Á¢∫Ë™çÈáçÁΩÆ","ÈÄôÂ∞áÊ∏ÖÈô§ÊâÄÊúâÂ≠∏ÁøíÈÄ≤Â∫¶ÂíåË®≠ÂÆöÔºåÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÊÅ¢Âæ©ÔºÅ",[
  {text:"ÂèñÊ∂à",cls:"btn-secondary",action:hideModal},
  {text:"Á¢∫Ë™çÈáçÁΩÆ",cls:"btn-error",action:()=>{Store.reset();hideModal();Settings.render();
    showModal("Â∑≤ÈáçÁΩÆ","ÊâÄÊúâÈÄ≤Â∫¶Â∑≤Ê∏ÖÈô§",[{text:"Á¢∫ÂÆö",cls:"btn-primary",action:hideModal}])}}])},
installApp(){if(deferredInstallPrompt){deferredInstallPrompt.prompt();
  deferredInstallPrompt.userChoice.then(r=>{deferredInstallPrompt=null;
    document.getElementById('install-btn').style.display='none'})}}
};

// ================================================================
// MODAL helpers
// ================================================================
function showModal(title,msg,actions){
  document.getElementById("modal-title").textContent=title;
  document.getElementById("modal-msg").textContent=msg;
  const ac=document.getElementById("modal-actions");
  ac.innerHTML=actions.map((a,i)=>`<button class="btn ${a.cls}" id="modal-btn-${i}">${a.text}</button>`).join("");
  actions.forEach((a,i)=>document.getElementById("modal-btn-"+i).addEventListener("click",a.action));
  document.getElementById("modal-overlay").classList.add("show");
}
function hideModal(){document.getElementById("modal-overlay").classList.remove("show")}

// ================================================================
// PWA: Service Worker + Manifest
// ================================================================
(function initPWA(){
  // Inline manifest
  const manifest={
    name:"Êó•Êú¨Ë™û„Éû„Çπ„Çø„Éº",short_name:"Êó•Ë™ûÂ≠∏Áøí",
    start_url:".",display:"standalone",
    background_color:"#FAFAF8",theme_color:"#C41E3A",
    icons:[{src:"data:image/svg+xml,"+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" rx="20" fill="#C41E3A"/><text x="50" y="65" font-size="50" text-anchor="middle" fill="white" font-family="serif">Ë™û</text></svg>'),sizes:"512x512",type:"image/svg+xml"}]
  };
  const mBlob=new Blob([JSON.stringify(manifest)],{type:'application/json'});
  const mURL=URL.createObjectURL(mBlob);
  const link=document.createElement('link');link.rel='manifest';link.href=mURL;
  document.head.appendChild(link);

  // Inline service worker
  const swCode=`
    const CACHE='nihongo-v2';
    self.addEventListener('install',e=>{e.waitUntil(caches.open(CACHE).then(c=>c.addAll(['/'])).catch(()=>{}));self.skipWaiting()});
    self.addEventListener('activate',e=>{e.waitUntil(caches.keys().then(ks=>Promise.all(ks.filter(k=>k!==CACHE).map(k=>caches.delete(k)))));self.clients.claim()});
    self.addEventListener('fetch',e=>{e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request).then(res=>{if(res.status===200){const c=res.clone();caches.open(CACHE).then(ca=>ca.put(e.request,c))}return res}).catch(()=>new Response('Offline',{status:503})))});
  `;
  if('serviceWorker' in navigator){
    try{
      const swBlob=new Blob([swCode],{type:'application/javascript'});
      const swURL=URL.createObjectURL(swBlob);
      navigator.serviceWorker.register(swURL,{scope:'.'}).catch(()=>{});
    }catch(e){}
  }

  // Install prompt capture
  window.addEventListener('beforeinstallprompt',e=>{e.preventDefault();deferredInstallPrompt=e;
    const btn=document.getElementById('install-btn');if(btn)btn.style.display='block'});
})();

// ================================================================
// APP INIT
// ================================================================
(function(){
  Store.load();Theme.init();TTS.init();Router.init();Home.render();
  const d=Store.load();
  if(d.todayStats.date!==today()){
    d.todayStats={date:today(),newWordsLearned:0,wordsReviewed:0,gojuonPracticed:0,quizzesTaken:0,correctRate:0,timeSpent:0};
    Store.save()}
  Achievements.check(d);
  // WebView detection
  const ua=navigator.userAgent||"";
  const knownWebView=/Telegram|TelegramBot|Instagram|FBAN|FBAV|Line\/|Twitter|Snapchat/i.test(ua);
  function showBanner(){
    const b=document.getElementById("webview-banner");
    if(b&&b.style.display!=="flex"){b.style.display="flex";
      document.querySelectorAll(".page").forEach(p=>p.style.paddingTop="56px")}}
  if(knownWebView){showBanner()}
  else{const testAudio=()=>{const a=new Audio();
    a.src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=";
    const p=a.play();if(p&&p.catch)p.catch(()=>showBanner());
    document.removeEventListener("click",testAudio);document.removeEventListener("touchstart",testAudio)};
    setTimeout(()=>{document.addEventListener("click",testAudio,{once:true});
      document.addEventListener("touchstart",testAudio,{once:true,passive:true})},1000)}
})();
</script>
</body>
</html>
