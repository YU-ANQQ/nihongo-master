<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#FAFAF8">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<title>æ—¥æœ¬èªãƒã‚¹ã‚¿ãƒ¼ - æ—¥èªèƒŒèª¦å­¸ç¿’</title>
<style>
/* ========== USER CARE PHILOSOPHY: "Every interaction should feel like a warm conversation" ========== */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent;scroll-behavior:smooth}
body{font-family:-apple-system,"SF Pro Display","Hiragino Sans","Yu Gothic","Noto Sans JP","Microsoft JhengHei",system-ui,sans-serif;
  background:var(--bg-primary);color:var(--text-primary);overflow:hidden;
  -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
  letter-spacing:0.01em;line-height:1.5}
button{font-family:inherit;cursor:pointer;border:none;background:none;color:inherit;font-size:inherit;
  -webkit-tap-highlight-color:transparent;touch-action:manipulation}
input{font-family:inherit;border:none;outline:none;background:none;color:inherit}
/* ========== WABI-SABI COLOR PALETTE ========== */
:root{
  --bg-primary:#F7F6F3;--bg-secondary:#EFEEE9;--bg-card:rgba(255,255,255,0.72);
  --bg-glass:rgba(255,255,255,0.6);
  --text-primary:#1D1D1F;--text-secondary:#86868B;--text-hint:#AEAEB2;
  --accent-primary:#D4513D;--accent-secondary:#3478F6;
  --accent-success:#34C759;--accent-warning:#FF9F0A;--accent-error:#FF3B30;
  --accent-purple:#AF52DE;
  --border-color:rgba(60,60,67,0.08);
  --shadow-sm:0 1px 4px rgba(0,0,0,0.04);
  --shadow-md:0 8px 30px rgba(0,0,0,0.06);
  --shadow-lg:0 20px 60px rgba(0,0,0,0.08);
  --radius-sm:12px;--radius-md:16px;--radius-lg:24px;
  --nav-height:64px;
  --blur:saturate(180%) blur(12px);
}
[data-theme="dark"]{
  --bg-primary:#000000;--bg-secondary:#1C1C1E;--bg-card:rgba(28,28,30,0.72);
  --bg-glass:rgba(28,28,30,0.6);
  --text-primary:#F5F5F7;--text-secondary:#98989D;--text-hint:#636366;
  --accent-primary:#FF6B5B;--accent-secondary:#5B9BD5;
  --accent-success:#30D158;--accent-warning:#FFD60A;--accent-error:#FF453A;
  --accent-purple:#BF5AF2;
  --border-color:rgba(255,255,255,0.08);
  --shadow-sm:none;--shadow-md:0 8px 30px rgba(0,0,0,0.3);
  --shadow-lg:0 20px 60px rgba(0,0,0,0.4);
}
/* ========== APP SHELL ========== */
#app{display:flex;flex-direction:column;height:100vh;height:100dvh;
  max-width:480px;margin:0 auto;position:relative;overflow:hidden}
.page{position:absolute;top:0;left:0;right:0;bottom:0;
  padding:20px 20px calc(var(--nav-height) + 24px + env(safe-area-inset-bottom,0px));
  overflow-y:auto;-webkit-overflow-scrolling:touch;
  opacity:0;transform:translateY(8px) scale(0.99);
  transition:opacity .4s cubic-bezier(0.25,0.1,0.25,1),transform .4s cubic-bezier(0.25,0.1,0.25,1);
  pointer-events:none;z-index:1;background:var(--bg-primary)}
.page.active{opacity:1;transform:translateY(0) scale(1);pointer-events:auto;z-index:2}
/* ========== BOTTOM NAV ========== */
.bottom-nav{position:absolute;bottom:0;left:0;right:0;
  height:calc(var(--nav-height) + env(safe-area-inset-bottom,0px));
  padding-bottom:env(safe-area-inset-bottom,0px);
  display:flex;justify-content:space-around;align-items:center;
  background:var(--bg-glass);-webkit-backdrop-filter:var(--blur);backdrop-filter:var(--blur);
  border-top:0.5px solid var(--border-color);z-index:100}
.nav-item{display:flex;flex-direction:column;align-items:center;gap:3px;
  padding:8px 16px;border-radius:var(--radius-sm);
  transition:all .3s cubic-bezier(0.25,0.1,0.25,1);min-width:56px;color:var(--text-hint)}
.nav-item.active{color:var(--accent-primary)}
.nav-item:active{transform:scale(0.92)}
.nav-item svg{width:22px;height:22px;fill:none;stroke:currentColor;stroke-width:1.8;stroke-linecap:round;stroke-linejoin:round}
.nav-item .nav-text{font-size:10px;font-weight:500;letter-spacing:0.02em}
.nav-item .nav-icon-text{font-size:20px;font-weight:700;line-height:22px}
/* ========== TYPOGRAPHY ========== */
.section-title{font-size:28px;font-weight:700;margin-bottom:20px;color:var(--text-primary);
  letter-spacing:-0.02em;line-height:1.2}
/* ========== CARDS ========== */
.card{background:var(--bg-card);-webkit-backdrop-filter:var(--blur);backdrop-filter:var(--blur);
  border-radius:var(--radius-md);padding:20px;
  box-shadow:var(--shadow-md);border:0.5px solid var(--border-color);
  transition:transform .3s cubic-bezier(0.25,0.1,0.25,1),box-shadow .3s ease}
.card:active{transform:scale(0.98)}
/* ========== BUTTONS ========== */
.btn{display:inline-flex;align-items:center;justify-content:center;
  padding:14px 28px;border-radius:var(--radius-sm);font-weight:600;font-size:16px;
  transition:all .25s cubic-bezier(0.25,0.1,0.25,1);min-height:50px;min-width:50px;
  letter-spacing:-0.01em}
.btn-primary{background:var(--accent-primary);color:#fff;
  box-shadow:0 4px 16px rgba(212,81,61,0.3)}
.btn-primary:active{transform:scale(0.95);box-shadow:0 2px 8px rgba(212,81,61,0.2)}
.btn-secondary{background:var(--bg-glass);-webkit-backdrop-filter:var(--blur);backdrop-filter:var(--blur);
  color:var(--text-primary);border:0.5px solid var(--border-color)}
.btn-secondary:active{transform:scale(0.95)}
.btn-success{background:var(--accent-success);color:#fff;box-shadow:0 4px 16px rgba(52,199,89,0.3)}
.btn-error{background:var(--accent-error);color:#fff;box-shadow:0 4px 16px rgba(255,59,48,0.3)}
.btn-block{width:100%;display:flex}
/* ========== PILLS ========== */
.pill-group{display:flex;gap:4px;background:var(--bg-secondary);border-radius:10px;padding:3px}
.pill{padding:8px 16px;border-radius:8px;font-size:13px;font-weight:500;
  transition:all .3s cubic-bezier(0.25,0.1,0.25,1);color:var(--text-secondary)}
.pill.active{background:var(--bg-card);-webkit-backdrop-filter:var(--blur);backdrop-filter:var(--blur);
  color:var(--text-primary);box-shadow:0 1px 4px rgba(0,0,0,0.08)}
/* ========== PROGRESS ========== */
.progress-bar{width:100%;height:6px;background:var(--bg-secondary);border-radius:3px;overflow:hidden}
.progress-bar .fill{height:100%;border-radius:3px;transition:width .6s cubic-bezier(0.25,0.1,0.25,1);background:var(--accent-primary)}
.badge{display:inline-flex;align-items:center;justify-content:center;
  padding:3px 10px;border-radius:12px;font-size:11px;font-weight:600;
  background:var(--accent-primary);color:#fff}
/* ========== MODAL ========== */
.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;
  background:rgba(0,0,0,0.4);-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);
  z-index:200;display:flex;align-items:center;justify-content:center;padding:24px;
  opacity:0;pointer-events:none;transition:opacity .3s ease}
.modal-overlay.show{opacity:1;pointer-events:auto}
.modal{background:var(--bg-card);-webkit-backdrop-filter:var(--blur);backdrop-filter:var(--blur);
  border-radius:var(--radius-lg);padding:28px;
  max-width:320px;width:100%;transform:scale(0.85);
  transition:transform .4s cubic-bezier(0.34,1.56,0.64,1);
  border:0.5px solid var(--border-color);box-shadow:var(--shadow-lg)}
.modal-overlay.show .modal{transform:scale(1)}
.modal h3{font-size:20px;font-weight:700;margin-bottom:8px;letter-spacing:-0.02em}
.modal p{color:var(--text-secondary);margin-bottom:24px;font-size:15px;line-height:1.6}
.modal-actions{display:flex;gap:10px}
.modal-actions .btn{flex:1}
/* ========== ANIMATIONS ========== */
@keyframes correctBounce{0%{transform:scale(1)}40%{transform:scale(1.08)}60%{transform:scale(0.97)}80%{transform:scale(1.02)}100%{transform:scale(1)}}
@keyframes wrongShake{0%,100%{transform:translateX(0)}15%{transform:translateX(-6px)}30%{transform:translateX(6px)}45%{transform:translateX(-4px)}60%{transform:translateX(4px)}75%{transform:translateX(-2px)}}
@keyframes fadeInUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
@keyframes popIn{0%{transform:scale(0.8);opacity:0}50%{transform:scale(1.04)}100%{transform:scale(1);opacity:1}}
@keyframes confetti{0%{transform:translateY(0) rotate(0);opacity:1}100%{transform:translateY(400px) rotate(720deg);opacity:0}}
@keyframes breathe{0%,100%{opacity:0.5}50%{opacity:1}}
@keyframes slideUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
@keyframes shimmer{0%{background-position:-200% 0}100%{background-position:200% 0}}
@keyframes celebrate{0%{transform:scale(1) rotate(0)}25%{transform:scale(1.2) rotate(-5deg)}50%{transform:scale(1.3) rotate(5deg)}75%{transform:scale(1.1) rotate(-3deg)}100%{transform:scale(1) rotate(0)}}
.anim-correct{animation:correctBounce .5s cubic-bezier(0.34,1.56,0.64,1)}
.anim-wrong{animation:wrongShake .5s cubic-bezier(0.25,0.1,0.25,1)}
.anim-fade-in{animation:fadeInUp .5s cubic-bezier(0.25,0.1,0.25,1)}
.anim-pop{animation:popIn .4s cubic-bezier(0.34,1.56,0.64,1)}
.anim-float{animation:float 3s ease-in-out infinite}
/* ========== ONBOARDING ========== */
.onboarding-overlay{position:fixed;top:0;left:0;right:0;bottom:0;z-index:500;
  background:var(--bg-primary);display:flex;flex-direction:column;align-items:center;justify-content:center;
  padding:40px 24px;text-align:center;transition:opacity .5s ease}
.onboarding-overlay.hiding{opacity:0;pointer-events:none}
.onboard-mascot{font-size:80px;margin-bottom:20px;animation:float 3s ease-in-out infinite}
.onboard-title{font-size:28px;font-weight:700;letter-spacing:-0.02em;margin-bottom:8px}
.onboard-desc{font-size:16px;color:var(--text-secondary);line-height:1.6;margin-bottom:32px;max-width:300px}
.onboard-dots{display:flex;gap:8px;margin-bottom:32px}
.onboard-dot{width:8px;height:8px;border-radius:50%;background:var(--border-color);transition:all .3s ease}
.onboard-dot.active{width:24px;background:var(--accent-primary)}
/* ========== MASCOT ========== */
.mascot{display:inline-block;transition:transform .3s cubic-bezier(0.34,1.56,0.64,1)}
.mascot-sm{font-size:24px}
.mascot-md{font-size:40px}
.mascot-lg{font-size:64px}
.mascot-happy{animation:celebrate .6s cubic-bezier(0.34,1.56,0.64,1)}
.mascot-sad{animation:wrongShake .5s ease}
/* ========== SESSION RITUAL ========== */
.session-start{position:fixed;top:0;left:0;right:0;bottom:0;z-index:300;
  background:var(--bg-primary);display:flex;flex-direction:column;align-items:center;justify-content:center;
  text-align:center;padding:40px;opacity:0;pointer-events:none;transition:opacity .4s ease}
.session-start.show{opacity:1;pointer-events:auto}
.session-breathe{width:80px;height:80px;border-radius:50%;
  background:radial-gradient(circle,rgba(212,81,61,0.15),transparent);
  display:flex;align-items:center;justify-content:center;
  animation:pulse 2s ease-in-out infinite}
.session-breathe-inner{width:48px;height:48px;border-radius:50%;
  background:radial-gradient(circle,rgba(212,81,61,0.3),rgba(212,81,61,0.1));
  animation:pulse 2s ease-in-out infinite 0.2s}
/* ========== DAILY SENTENCE ========== */
.daily-sentence{background:linear-gradient(135deg,rgba(212,81,61,0.08),rgba(52,120,246,0.08));
  border-radius:var(--radius-md);padding:20px;margin-bottom:16px;
  border:0.5px solid var(--border-color);position:relative;overflow:hidden}
.daily-sentence::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;
  background:linear-gradient(90deg,var(--accent-primary),var(--accent-secondary),var(--accent-purple));
  background-size:200% 100%;animation:shimmer 3s linear infinite}
.daily-sentence .ds-label{font-size:11px;color:var(--accent-primary);font-weight:600;
  text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px}
.daily-sentence .ds-ja{font-size:22px;font-weight:600;margin-bottom:4px;letter-spacing:-0.01em}
.daily-sentence .ds-rd{font-size:14px;color:var(--text-secondary);margin-bottom:4px}
.daily-sentence .ds-zh{font-size:15px;color:var(--text-secondary)}
/* ========== MEMORY MAP ========== */
.memory-map{display:grid;grid-template-columns:repeat(10,1fr);gap:3px;margin:12px 0}
.memory-cell{aspect-ratio:1;border-radius:4px;position:relative;cursor:pointer;
  transition:transform .2s ease;display:flex;align-items:center;justify-content:center;font-size:9px}
.memory-cell:active{transform:scale(0.85)}
.memory-cell .tooltip{position:absolute;bottom:calc(100% + 4px);left:50%;transform:translateX(-50%);
  background:var(--text-primary);color:var(--bg-primary);padding:4px 8px;border-radius:6px;
  font-size:11px;white-space:nowrap;pointer-events:none;opacity:0;transition:opacity .2s}
.memory-cell:hover .tooltip{opacity:1}
/* ========== STREAK FREEZE ========== */
.streak-freeze-badge{display:inline-flex;align-items:center;gap:4px;
  padding:4px 10px;border-radius:8px;font-size:12px;font-weight:600;
  background:rgba(52,120,246,0.1);color:var(--accent-secondary);border:0.5px solid rgba(52,120,246,0.2)}
/* ========== SCENARIO DIALOGUE ========== */
.dialogue-container{max-width:340px;margin:0 auto}
.dialogue-bubble{padding:14px 18px;border-radius:var(--radius-md);margin-bottom:10px;
  max-width:85%;font-size:15px;line-height:1.5;animation:fadeInUp .3s ease}
.dialogue-npc{background:var(--bg-card);border:0.5px solid var(--border-color);
  margin-right:auto;border-bottom-left-radius:4px}
.dialogue-user{background:var(--accent-primary);color:#fff;
  margin-left:auto;border-bottom-right-radius:4px}
.dialogue-choices{display:flex;flex-direction:column;gap:8px;margin-top:16px}
.dialogue-choice{padding:14px 18px;border-radius:var(--radius-md);
  background:var(--bg-card);border:1.5px solid var(--border-color);
  text-align:left;font-size:15px;transition:all .2s ease}
.dialogue-choice:active{transform:scale(0.97);border-color:var(--accent-primary)}
.dialogue-choice.correct{border-color:var(--accent-success);background:rgba(52,199,89,0.08)}
.dialogue-choice.wrong{border-color:var(--accent-error);background:rgba(255,59,48,0.05)}
.dialogue-choice .dc-ja{font-weight:600}
.dialogue-choice .dc-zh{font-size:12px;color:var(--text-secondary);margin-top:2px}
/* ========== HOME ========== */
.greeting{font-size:32px;font-weight:700;margin-bottom:4px;letter-spacing:-0.03em}
.greeting-sub{font-size:15px;color:var(--text-secondary);margin-bottom:24px;line-height:1.5}
.stats-row{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:20px 0}
.stat-card{text-align:center;padding:18px 8px;background:var(--bg-card);
  -webkit-backdrop-filter:var(--blur);backdrop-filter:var(--blur);
  border-radius:var(--radius-md);border:0.5px solid var(--border-color);
  box-shadow:var(--shadow-sm)}
.stat-value{font-size:30px;font-weight:800;color:var(--accent-primary);letter-spacing:-0.02em}
.stat-label{font-size:11px;color:var(--text-secondary);margin-top:6px;letter-spacing:0.02em}
.today-info{display:flex;gap:10px;margin:16px 0}
.today-chip{flex:1;padding:14px 10px;border-radius:var(--radius-md);text-align:center;
  background:var(--bg-card);-webkit-backdrop-filter:var(--blur);backdrop-filter:var(--blur);
  border:0.5px solid var(--border-color);box-shadow:var(--shadow-sm)}
.today-chip strong{display:block;font-size:24px;font-weight:800;color:var(--accent-secondary);
  margin-bottom:2px;letter-spacing:-0.02em}
.mini-chart{display:flex;align-items:flex-end;gap:6px;height:64px;padding:8px 0;margin-top:12px}
.mini-chart .bar{flex:1;background:linear-gradient(to top,var(--accent-primary),rgba(212,81,61,0.6));
  border-radius:4px 4px 0 0;min-height:4px;transition:height .6s cubic-bezier(0.25,0.1,0.25,1);opacity:0.6}
.mini-chart .bar.today{opacity:1}
.chart-labels{display:flex;gap:6px;margin-top:6px}
.chart-labels span{flex:1;text-align:center;font-size:10px;color:var(--text-hint)}
/* ========== GOJUON ========== */
.gojuon-controls{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap}
.gojuon-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:6px;margin-top:16px}
.gojuon-cell{aspect-ratio:1;display:flex;flex-direction:column;align-items:center;justify-content:center;
  background:var(--bg-card);-webkit-backdrop-filter:var(--blur);backdrop-filter:var(--blur);
  border:0.5px solid var(--border-color);border-radius:var(--radius-sm);
  font-size:22px;cursor:pointer;transition:all .3s cubic-bezier(0.25,0.1,0.25,1);position:relative}
.gojuon-cell:active{transform:scale(0.9)}
.gojuon-cell .romaji{font-size:9px;color:var(--text-hint);margin-top:3px;letter-spacing:0.04em}
.gojuon-cell.mastered{border-color:var(--accent-success);background:rgba(52,199,89,0.06)}
.gojuon-cell.mastered::after{content:'';position:absolute;top:4px;right:4px;width:6px;height:6px;
  border-radius:50%;background:var(--accent-success)}
.gojuon-cell.empty{visibility:hidden}
.gojuon-row-label{grid-column:1/-1;font-size:13px;font-weight:600;color:var(--text-secondary);
  padding:12px 0 6px;letter-spacing:0.03em}
/* ========== FLASHCARD ========== */
.flashcard-container{perspective:1200px;width:100%;max-width:300px;margin:24px auto}
.flashcard{position:relative;width:100%;height:220px;
  transition:transform .7s cubic-bezier(0.34,1.56,0.64,1);
  transform-style:preserve-3d;cursor:pointer}
.flashcard.flipped{transform:rotateY(180deg)}
.flashcard-face{position:absolute;width:100%;height:100%;backface-visibility:hidden;
  border-radius:var(--radius-lg);display:flex;flex-direction:column;align-items:center;justify-content:center;
  box-shadow:var(--shadow-lg);background:var(--bg-card);
  -webkit-backdrop-filter:var(--blur);backdrop-filter:var(--blur);
  border:0.5px solid var(--border-color)}
.flashcard-back{transform:rotateY(180deg)}
.flashcard-face .char{font-size:72px;font-weight:300;letter-spacing:-0.02em}
.flashcard-face .label{font-size:13px;color:var(--text-hint);margin-top:12px;animation:breathe 2s infinite}
.flashcard-face .romaji-big{font-size:40px;font-weight:600;color:var(--accent-primary);letter-spacing:-0.02em}
.flashcard-nav{display:flex;gap:14px;justify-content:center;margin-top:20px}
.quiz-header{text-align:center;margin-bottom:20px}
.quiz-question{font-size:52px;font-weight:300;text-align:center;margin:24px 0;min-height:70px;
  letter-spacing:-0.02em}
.quiz-options{display:grid;grid-template-columns:1fr 1fr;gap:10px;max-width:320px;margin:0 auto}
.quiz-option{padding:16px;border-radius:var(--radius-md);
  background:var(--bg-card);-webkit-backdrop-filter:var(--blur);backdrop-filter:var(--blur);
  border:1.5px solid var(--border-color);font-size:18px;font-weight:600;
  text-align:center;transition:all .3s cubic-bezier(0.25,0.1,0.25,1);min-height:56px;
  box-shadow:var(--shadow-sm)}
.quiz-option:active{transform:scale(0.94)}
.quiz-option.correct{border-color:var(--accent-success);background:rgba(52,199,89,0.1);color:var(--accent-success);
  box-shadow:0 0 0 3px rgba(52,199,89,0.15)}
.quiz-option.wrong{border-color:var(--accent-error);background:rgba(255,59,48,0.08);color:var(--accent-error);
  box-shadow:0 0 0 3px rgba(255,59,48,0.12)}
.quiz-feedback{text-align:center;margin-top:16px;font-size:16px;font-weight:600;min-height:24px}
/* ========== VOCAB CARD ========== */
.vocab-card-container{perspective:1200px;width:100%;max-width:340px;margin:20px auto;touch-action:pan-y}
.vocab-card{position:relative;width:100%;min-height:260px;
  transition:transform .7s cubic-bezier(0.34,1.56,0.64,1);
  transform-style:preserve-3d;cursor:pointer}
.vocab-card.flipped{transform:rotateY(180deg)}
.vocab-face{position:absolute;width:100%;min-height:260px;backface-visibility:hidden;
  border-radius:var(--radius-lg);padding:28px;
  box-shadow:var(--shadow-lg);background:var(--bg-card);
  -webkit-backdrop-filter:var(--blur);backdrop-filter:var(--blur);
  border:0.5px solid var(--border-color)}
.vocab-back{transform:rotateY(180deg)}
.vocab-face .word{font-size:52px;font-weight:300;text-align:center;margin:28px 0 8px;letter-spacing:-0.02em}
.vocab-face .hint{font-size:13px;color:var(--text-hint);text-align:center;animation:breathe 2s infinite}
.vocab-back .reading{font-size:24px;font-weight:600;text-align:center;color:var(--accent-primary);margin-bottom:4px}
.vocab-back .romaji-sm{font-size:13px;color:var(--text-hint);text-align:center;margin-bottom:8px}
.vocab-back .meaning{font-size:28px;font-weight:700;text-align:center;margin-bottom:4px}
.vocab-back .pos{font-size:12px;color:var(--text-secondary);text-align:center;margin-bottom:12px}
.vocab-back .example{background:var(--bg-secondary);padding:10px;border-radius:var(--radius-sm);font-size:13px;line-height:1.6}
.vocab-back .example .ja{font-weight:600}
.vocab-back .example .zh{color:var(--text-secondary);margin-top:2px}
/* ========== RATING ========== */
.vocab-rating{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:16px;max-width:340px;margin-left:auto;margin-right:auto}
.rate-btn{padding:12px 4px;border-radius:var(--radius-sm);font-size:12px;font-weight:600;color:#fff;text-align:center;
  transition:all .25s cubic-bezier(0.25,0.1,0.25,1)}
.rate-btn:active{transform:scale(0.93)}
.rate-btn.r1{background:var(--accent-error);box-shadow:0 3px 12px rgba(255,59,48,0.25)}
.rate-btn.r2{background:#E67E22;box-shadow:0 3px 12px rgba(230,126,34,0.25)}
.rate-btn.r3{background:var(--accent-warning);box-shadow:0 3px 12px rgba(255,159,10,0.25)}
.rate-btn.r4{background:var(--accent-success);box-shadow:0 3px 12px rgba(52,199,89,0.25)}
.vocab-progress{display:flex;align-items:center;gap:8px;margin-bottom:12px}
.vocab-progress .count{font-size:14px;color:var(--text-secondary);white-space:nowrap}
.vocab-empty{text-align:center;padding:40px 20px;color:var(--text-secondary)}
.vocab-empty .emoji{font-size:48px;margin-bottom:12px}
.vocab-complete{text-align:center;padding:30px 20px}
.vocab-complete .emoji{font-size:64px;margin-bottom:16px}
.vocab-complete h2{margin-bottom:8px}
.vocab-complete .stats{color:var(--text-secondary);margin-bottom:20px;line-height:1.8}
.quiz-setup{max-width:340px;margin:0 auto}
.quiz-setup h2{text-align:center;margin-bottom:20px}
.quiz-type-list{display:flex;flex-direction:column;gap:8px;margin-bottom:20px}
.quiz-type-item{padding:14px;border-radius:var(--radius-md);background:var(--bg-card);
  border:2px solid var(--border-color);cursor:pointer;transition:all .2s ease}
.quiz-type-item.selected{border-color:var(--accent-primary);background:rgba(196,30,58,0.05)}
.quiz-type-item h4{font-size:15px;margin-bottom:2px}
.quiz-type-item p{font-size:12px;color:var(--text-secondary)}
.quiz-count{display:flex;align-items:center;justify-content:center;gap:16px;margin:16px 0}
.quiz-count .num{font-size:32px;font-weight:800;min-width:50px;text-align:center}
.quiz-count button{width:40px;height:40px;border-radius:50%;background:var(--bg-secondary);
  font-size:20px;font-weight:700;display:flex;align-items:center;justify-content:center;border:1px solid var(--border-color)}
.quiz-result{text-align:center;padding:20px}
.result-circle{width:148px;height:148px;border-radius:50%;margin:0 auto 24px;
  display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;
  box-shadow:var(--shadow-md)}
.result-circle .pct{font-size:40px;font-weight:800;letter-spacing:-0.03em}
.result-circle .pct-label{font-size:12px;color:var(--text-secondary);letter-spacing:0.04em}
.wrong-list{text-align:left;margin:16px 0}
.wrong-item{padding:10px;border-radius:var(--radius-sm);background:var(--bg-secondary);margin-bottom:6px;font-size:14px}
.wrong-item .q{font-weight:600}
.wrong-item .a{color:var(--accent-error);font-size:12px}
.wrong-item .c{color:var(--accent-success);font-size:12px}
.typing-input{width:100%;max-width:300px;margin:0 auto;display:block;padding:14px;
  font-size:24px;text-align:center;border-radius:var(--radius-md);
  background:var(--bg-card);border:2px solid var(--border-color);transition:border-color .2s ease}
.typing-input:focus{border-color:var(--accent-primary)}
.typing-feedback{text-align:center;margin-top:12px;font-size:15px;font-weight:600;min-height:24px}
/* ========== SETTINGS ========== */
.settings-group{margin-bottom:28px}
.settings-group-title{font-size:12px;color:var(--text-hint);font-weight:600;
  text-transform:uppercase;letter-spacing:1.5px;margin-bottom:10px;padding-left:4px}
.settings-item{display:flex;align-items:center;justify-content:space-between;
  padding:16px;background:var(--bg-card);-webkit-backdrop-filter:var(--blur);backdrop-filter:var(--blur);
  border:0.5px solid var(--border-color);border-radius:var(--radius-sm);margin-bottom:6px;
  transition:transform .2s ease}
.settings-item:active{transform:scale(0.98)}
.settings-item .label{font-size:15px;font-weight:500}
.settings-item .value{color:var(--text-secondary);font-size:14px}
.theme-btns{display:flex;gap:4px}
.theme-btn{padding:8px 14px;border-radius:8px;font-size:13px;font-weight:500;
  background:var(--bg-secondary);border:0.5px solid transparent;
  transition:all .3s cubic-bezier(0.25,0.1,0.25,1)}
.theme-btn:active{transform:scale(0.94)}
.theme-btn.active{background:var(--accent-primary);color:#fff;
  box-shadow:0 2px 8px rgba(212,81,61,0.3)}
.daily-adj{display:flex;align-items:center;gap:10px}
.daily-adj button{width:32px;height:32px;border-radius:50%;background:var(--bg-secondary);
  font-size:18px;font-weight:700;display:flex;align-items:center;justify-content:center;border:1px solid var(--border-color)}
.daily-adj .num{font-size:18px;font-weight:700;min-width:30px;text-align:center}
.danger-btn{width:100%;padding:16px;border-radius:var(--radius-sm);
  background:rgba(255,59,48,0.06);color:var(--accent-error);font-weight:600;font-size:15px;
  border:0.5px solid rgba(255,59,48,0.2);text-align:center;
  transition:all .3s cubic-bezier(0.25,0.1,0.25,1)}
.danger-btn:active{background:var(--accent-error);color:#fff;transform:scale(0.97)}
.version-info{text-align:center;color:var(--text-hint);font-size:11px;margin-top:28px;line-height:1.8;
  letter-spacing:0.02em}
.file-input{display:none}
/* ========== SOUND BUTTON ========== */
.sound-btn{display:inline-flex;align-items:center;justify-content:center;
  width:40px;height:40px;border-radius:50%;
  background:var(--bg-glass);-webkit-backdrop-filter:var(--blur);backdrop-filter:var(--blur);
  border:0.5px solid var(--border-color);cursor:pointer;
  transition:all .3s cubic-bezier(0.25,0.1,0.25,1);
  position:relative;overflow:hidden;flex-shrink:0}
.sound-btn:active{transform:scale(0.88)}
.sound-btn svg{width:18px;height:18px;fill:none;stroke:var(--accent-primary);stroke-width:1.8;stroke-linecap:round;stroke-linejoin:round}
.sound-btn.playing{background:var(--accent-primary);border-color:var(--accent-primary)}
.sound-btn.playing svg{stroke:#fff}
@keyframes soundPulse{0%{box-shadow:0 0 0 0 rgba(212,81,61,0.35)}70%{box-shadow:0 0 0 12px rgba(212,81,61,0)}100%{box-shadow:0 0 0 0 rgba(212,81,61,0)}}
.sound-btn.playing{animation:soundPulse .8s ease}
.sound-btn-sm{width:34px;height:34px}
.sound-btn-sm svg{width:16px;height:16px}
.webview-banner{position:fixed;top:0;left:0;right:0;z-index:300;
  background:rgba(212,81,61,0.92);-webkit-backdrop-filter:blur(12px);backdrop-filter:blur(12px);
  color:#fff;padding:12px 16px;
  display:flex;align-items:center;gap:10px;font-size:13px;line-height:1.4;
  box-shadow:0 4px 20px rgba(0,0,0,0.15);max-width:480px;margin:0 auto}
.webview-banner .banner-text{flex:1}
.webview-banner .banner-btn{padding:6px 14px;border-radius:6px;
  background:#fff;color:var(--accent-primary);font-weight:700;font-size:13px;
  white-space:nowrap;flex-shrink:0}
.webview-banner .banner-close{width:28px;height:28px;display:flex;
  align-items:center;justify-content:center;font-size:18px;opacity:0.8;flex-shrink:0}
/* Achievement */
.achievement-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.achievement-item{text-align:center;padding:12px 4px;background:var(--bg-card);
  border-radius:var(--radius-md);border:1px solid var(--border-color);transition:all .3s ease}
.achievement-item.unlocked{border-color:var(--accent-warning);background:rgba(212,160,23,0.05)}
.achievement-item.locked{opacity:0.4;filter:grayscale(1)}
.achievement-item .ach-icon{font-size:32px;margin-bottom:4px}
.achievement-item .ach-name{font-size:11px;font-weight:600}
.achievement-item .ach-desc{font-size:9px;color:var(--text-hint);margin-top:2px}
.achievement-toast{position:fixed;top:20px;left:50%;transform:translateX(-50%) translateY(-120px);
  z-index:400;background:var(--bg-glass);-webkit-backdrop-filter:var(--blur);backdrop-filter:var(--blur);
  color:var(--text-primary);padding:14px 24px;
  border-radius:var(--radius-lg);box-shadow:var(--shadow-lg);border:0.5px solid var(--border-color);
  display:flex;align-items:center;gap:12px;font-weight:600;font-size:15px;
  transition:transform .6s cubic-bezier(0.34,1.56,0.64,1);white-space:nowrap}
.achievement-toast.show{transform:translateX(-50%) translateY(0)}
.achievement-toast .toast-icon{font-size:32px}
.swipe-hint{text-align:center;font-size:12px;color:var(--text-hint);margin-top:8px}
.error-card{padding:12px;background:var(--bg-card);border:1px solid var(--border-color);
  border-radius:var(--radius-sm);margin-bottom:8px;display:flex;justify-content:space-between;align-items:center;gap:8px}
.error-card .error-word{font-size:18px;font-weight:700}
.error-card .error-info{font-size:12px;color:var(--text-secondary)}
.error-card .error-count{font-size:11px;color:var(--accent-error);font-weight:600}
.install-btn{width:100%;padding:14px;border-radius:var(--radius-sm);
  background:var(--accent-secondary);color:#fff;font-weight:600;font-size:15px;
  text-align:center;transition:all .2s ease;display:none}
.install-btn:active{opacity:0.8}
.writing-grid{width:220px;height:220px;margin:24px auto;
  border:1px solid var(--border-color);
  border-radius:var(--radius-lg);position:relative;
  background:var(--bg-card);-webkit-backdrop-filter:var(--blur);backdrop-filter:var(--blur);
  box-shadow:var(--shadow-md)}
.writing-grid::before,.writing-grid::after{content:'';position:absolute;background:var(--border-color)}
.writing-grid::before{left:50%;top:0;width:0.5px;height:100%;opacity:0.25}
.writing-grid::after{top:50%;left:0;width:100%;height:0.5px;opacity:0.25}
.writing-char{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
  font-size:130px;font-weight:200;color:var(--text-primary);
  transition:opacity .6s cubic-bezier(0.25,0.1,0.25,1)}
.writing-char.dim{opacity:0.08}
/* ========== CONFETTI ========== */
.confetti-container{position:fixed;top:0;left:0;right:0;bottom:0;pointer-events:none;z-index:350;overflow:hidden}
.confetti-piece{position:absolute;width:10px;height:10px;top:-10px;animation:confetti 1.5s ease forwards}
</style>
</head>
<body>
<!-- Onboarding overlay (shown first time only) -->
<div class="onboarding-overlay" id="onboarding" style="display:none">
  <div class="onboard-mascot" id="onboard-mascot">ğŸ¦Š</div>
  <div class="onboard-title" id="onboard-title"></div>
  <div class="onboard-desc" id="onboard-desc"></div>
  <div class="onboard-dots" id="onboard-dots"></div>
  <button class="btn btn-primary" id="onboard-btn" style="min-width:200px"></button>
</div>
<!-- Session start ritual -->
<div class="session-start" id="session-start">
  <div class="session-breathe"><div class="session-breathe-inner"></div></div>
  <div style="margin-top:24px;font-size:20px;font-weight:600" id="session-msg">æº–å‚™å¥½äº†å—ï¼Ÿ</div>
  <div style="margin-top:8px;font-size:14px;color:var(--text-secondary)" id="session-sub"></div>
</div>
<!-- WebView banner -->
<div class="webview-banner" id="webview-banner" style="display:none;flex-wrap:wrap">
  <div class="banner-text">ğŸ”‡ ç„¡æ³•æ’­æ”¾è²éŸ³ï¼Œè«‹é»å³ä¸Š â‹® é¸ã€Œåœ¨ç€è¦½å™¨ä¸­é–‹å•Ÿã€</div>
  <button class="banner-btn" id="copy-url-btn" onclick="navigator.clipboard.writeText(location.href).then(()=>{this.textContent='âœ… å·²è¤‡è£½'}).catch(()=>{prompt('è¤‡è£½æ­¤ç¶²å€åˆ°ç€è¦½å™¨é–‹å•Ÿï¼š',location.href)})">è¤‡è£½ç¶²å€</button>
  <button class="banner-close" onclick="document.getElementById('webview-banner').style.display='none';document.querySelectorAll('.page').forEach(p=>p.style.paddingTop='')">âœ•</button>
</div>
<!-- Achievement toast -->
<div class="achievement-toast" id="ach-toast"><span class="toast-icon"></span><span class="toast-text"></span></div>
<!-- Confetti container -->
<div class="confetti-container" id="confetti-box"></div>
<!-- App -->
<div id="app">
<div class="page active" id="page-home"><div id="home-content"></div></div>
<div class="page" id="page-gojuon">
  <div class="section-title">äº”åéŸ³ç·´ç¿’</div>
  <div class="gojuon-controls">
    <div class="pill-group" id="gojuon-script-pills">
      <button class="pill active" data-script="hiragana">å¹³å‡å</button>
      <button class="pill" data-script="katakana">ç‰‡å‡å</button>
      <button class="pill" data-script="both">å°ç…§</button>
    </div>
  </div>
  <div class="pill-group" id="gojuon-mode-pills" style="margin-bottom:12px">
    <button class="pill active" data-mode="chart">è¡¨æ ¼</button>
    <button class="pill" data-mode="flashcard">å¡ç‰‡</button>
    <button class="pill" data-mode="quiz">æ¸¬é©—</button>
    <button class="pill" data-mode="writing">æ›¸å¯«</button>
  </div>
  <div id="gojuon-content"></div>
</div>
<div class="page" id="page-vocab"><div class="section-title">å˜èªå­¸ç¿’</div><div id="vocab-content"></div></div>
<div class="page" id="page-quiz"><div class="section-title">ãƒ†ã‚¹ãƒˆ</div><div id="quiz-content"></div></div>
<div class="page" id="page-settings"><div class="section-title">è¨­å®š</div><div id="settings-content"></div></div>
<nav class="bottom-nav" id="bottom-nav">
  <button class="nav-item active" data-page="home">
    <svg viewBox="0 0 24 24"><path d="M3 12L12 3l9 9"/><path d="M5 10v9a1 1 0 001 1h4v-5h4v5h4a1 1 0 001-1v-9"/></svg>
    <span class="nav-text">ãƒ›ãƒ¼ãƒ </span>
  </button>
  <button class="nav-item" data-page="gojuon"><span class="nav-icon-text">ã‚</span><span class="nav-text">äº”åéŸ³</span></button>
  <button class="nav-item" data-page="vocab">
    <svg viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/></svg>
    <span class="nav-text">å˜èª</span>
  </button>
  <button class="nav-item" data-page="quiz">
    <svg viewBox="0 0 24 24"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
    <span class="nav-text">ãƒ†ã‚¹ãƒˆ</span>
  </button>
  <button class="nav-item" data-page="settings">
    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
    <span class="nav-text">è¨­å®š</span>
  </button>
</nav>
<div class="modal-overlay" id="modal-overlay">
  <div class="modal" id="modal-box"><h3 id="modal-title"></h3><p id="modal-msg"></p><div class="modal-actions" id="modal-actions"></div></div>
</div>
</div>
<script>
// ================================================================
// DATA: äº”åéŸ³
// ================================================================
const GOJUON={
seion:[
{r:"a",h:"ã‚",k:"ã‚¢",row:"vowel"},{r:"i",h:"ã„",k:"ã‚¤",row:"vowel"},{r:"u",h:"ã†",k:"ã‚¦",row:"vowel"},{r:"e",h:"ãˆ",k:"ã‚¨",row:"vowel"},{r:"o",h:"ãŠ",k:"ã‚ª",row:"vowel"},
{r:"ka",h:"ã‹",k:"ã‚«",row:"k"},{r:"ki",h:"ã",k:"ã‚­",row:"k"},{r:"ku",h:"ã",k:"ã‚¯",row:"k"},{r:"ke",h:"ã‘",k:"ã‚±",row:"k"},{r:"ko",h:"ã“",k:"ã‚³",row:"k"},
{r:"sa",h:"ã•",k:"ã‚µ",row:"s"},{r:"shi",h:"ã—",k:"ã‚·",row:"s"},{r:"su",h:"ã™",k:"ã‚¹",row:"s"},{r:"se",h:"ã›",k:"ã‚»",row:"s"},{r:"so",h:"ã",k:"ã‚½",row:"s"},
{r:"ta",h:"ãŸ",k:"ã‚¿",row:"t"},{r:"chi",h:"ã¡",k:"ãƒ",row:"t"},{r:"tsu",h:"ã¤",k:"ãƒ„",row:"t"},{r:"te",h:"ã¦",k:"ãƒ†",row:"t"},{r:"to",h:"ã¨",k:"ãƒˆ",row:"t"},
{r:"na",h:"ãª",k:"ãƒŠ",row:"n"},{r:"ni",h:"ã«",k:"ãƒ‹",row:"n"},{r:"nu",h:"ã¬",k:"ãƒŒ",row:"n"},{r:"ne",h:"ã­",k:"ãƒ",row:"n"},{r:"no",h:"ã®",k:"ãƒ",row:"n"},
{r:"ha",h:"ã¯",k:"ãƒ",row:"h"},{r:"hi",h:"ã²",k:"ãƒ’",row:"h"},{r:"fu",h:"ãµ",k:"ãƒ•",row:"h"},{r:"he",h:"ã¸",k:"ãƒ˜",row:"h"},{r:"ho",h:"ã»",k:"ãƒ›",row:"h"},
{r:"ma",h:"ã¾",k:"ãƒ",row:"m"},{r:"mi",h:"ã¿",k:"ãƒŸ",row:"m"},{r:"mu",h:"ã‚€",k:"ãƒ ",row:"m"},{r:"me",h:"ã‚",k:"ãƒ¡",row:"m"},{r:"mo",h:"ã‚‚",k:"ãƒ¢",row:"m"},
{r:"ya",h:"ã‚„",k:"ãƒ¤",row:"y"},{r:"yu",h:"ã‚†",k:"ãƒ¦",row:"y"},{r:"yo",h:"ã‚ˆ",k:"ãƒ¨",row:"y"},
{r:"ra",h:"ã‚‰",k:"ãƒ©",row:"r"},{r:"ri",h:"ã‚Š",k:"ãƒª",row:"r"},{r:"ru",h:"ã‚‹",k:"ãƒ«",row:"r"},{r:"re",h:"ã‚Œ",k:"ãƒ¬",row:"r"},{r:"ro",h:"ã‚",k:"ãƒ­",row:"r"},
{r:"wa",h:"ã‚",k:"ãƒ¯",row:"w"},{r:"wo",h:"ã‚’",k:"ãƒ²",row:"w"},
{r:"n",h:"ã‚“",k:"ãƒ³",row:"nn"}
],
dakuon:[
{r:"ga",h:"ãŒ",k:"ã‚¬",row:"g"},{r:"gi",h:"ã",k:"ã‚®",row:"g"},{r:"gu",h:"ã",k:"ã‚°",row:"g"},{r:"ge",h:"ã’",k:"ã‚²",row:"g"},{r:"go",h:"ã”",k:"ã‚´",row:"g"},
{r:"za",h:"ã–",k:"ã‚¶",row:"z"},{r:"ji",h:"ã˜",k:"ã‚¸",row:"z"},{r:"zu",h:"ãš",k:"ã‚º",row:"z"},{r:"ze",h:"ãœ",k:"ã‚¼",row:"z"},{r:"zo",h:"ã",k:"ã‚¾",row:"z"},
{r:"da",h:"ã ",k:"ãƒ€",row:"d"},{r:"di",h:"ã¢",k:"ãƒ‚",row:"d"},{r:"du",h:"ã¥",k:"ãƒ…",row:"d"},{r:"de",h:"ã§",k:"ãƒ‡",row:"d"},{r:"do",h:"ã©",k:"ãƒ‰",row:"d"},
{r:"ba",h:"ã°",k:"ãƒ",row:"b"},{r:"bi",h:"ã³",k:"ãƒ“",row:"b"},{r:"bu",h:"ã¶",k:"ãƒ–",row:"b"},{r:"be",h:"ã¹",k:"ãƒ™",row:"b"},{r:"bo",h:"ã¼",k:"ãƒœ",row:"b"}
],
handakuon:[
{r:"pa",h:"ã±",k:"ãƒ‘",row:"p"},{r:"pi",h:"ã´",k:"ãƒ”",row:"p"},{r:"pu",h:"ã·",k:"ãƒ—",row:"p"},{r:"pe",h:"ãº",k:"ãƒš",row:"p"},{r:"po",h:"ã½",k:"ãƒ",row:"p"}
]
};
const ALL_KANA=[...GOJUON.seion,...GOJUON.dakuon,...GOJUON.handakuon];

// ================================================================
// DATA: N5 å–®å­— (120å€‹)
// ================================================================
const VOCAB=[
// æ—¥å¸¸å‹•è© 15
{id:1,w:"é£Ÿã¹ã‚‹",rd:"ãŸã¹ã‚‹",ro:"taberu",m:"åƒ",pos:"å‹•è©II",cat:"verb",ex:{ja:"æœã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹ã€‚",rd:"ã‚ã•ã”ã¯ã‚“ã‚’ãŸã¹ã‚‹ã€‚",zh:"åƒæ—©é¤ã€‚"}},
{id:2,w:"é£²ã‚€",rd:"ã®ã‚€",ro:"nomu",m:"å–",pos:"å‹•è©I",cat:"verb",ex:{ja:"æ°´ã‚’é£²ã‚€ã€‚",rd:"ã¿ãšã‚’ã®ã‚€ã€‚",zh:"å–æ°´ã€‚"}},
{id:3,w:"è¡Œã",rd:"ã„ã",ro:"iku",m:"å»",pos:"å‹•è©I",cat:"verb",ex:{ja:"å­¦æ ¡ã«è¡Œãã€‚",rd:"ãŒã£ã“ã†ã«ã„ãã€‚",zh:"å»å­¸æ ¡ã€‚"}},
{id:4,w:"æ¥ã‚‹",rd:"ãã‚‹",ro:"kuru",m:"ä¾†",pos:"å‹•è©III",cat:"verb",ex:{ja:"å‹é”ãŒæ¥ã‚‹ã€‚",rd:"ã¨ã‚‚ã ã¡ãŒãã‚‹ã€‚",zh:"æœ‹å‹ä¾†äº†ã€‚"}},
{id:5,w:"è¦‹ã‚‹",rd:"ã¿ã‚‹",ro:"miru",m:"çœ‹",pos:"å‹•è©II",cat:"verb",ex:{ja:"æ˜ ç”»ã‚’è¦‹ã‚‹ã€‚",rd:"ãˆã„ãŒã‚’ã¿ã‚‹ã€‚",zh:"çœ‹é›»å½±ã€‚"}},
{id:6,w:"èã",rd:"ãã",ro:"kiku",m:"è½;å•",pos:"å‹•è©I",cat:"verb",ex:{ja:"éŸ³æ¥½ã‚’èãã€‚",rd:"ãŠã‚“ãŒãã‚’ããã€‚",zh:"è½éŸ³æ¨‚ã€‚"}},
{id:7,w:"èª­ã‚€",rd:"ã‚ˆã‚€",ro:"yomu",m:"è®€",pos:"å‹•è©I",cat:"verb",ex:{ja:"æœ¬ã‚’èª­ã‚€ã€‚",rd:"ã»ã‚“ã‚’ã‚ˆã‚€ã€‚",zh:"è®€æ›¸ã€‚"}},
{id:8,w:"æ›¸ã",rd:"ã‹ã",ro:"kaku",m:"å¯«",pos:"å‹•è©I",cat:"verb",ex:{ja:"æ‰‹ç´™ã‚’æ›¸ãã€‚",rd:"ã¦ãŒã¿ã‚’ã‹ãã€‚",zh:"å¯«ä¿¡ã€‚"}},
{id:9,w:"è©±ã™",rd:"ã¯ãªã™",ro:"hanasu",m:"èªªè©±",pos:"å‹•è©I",cat:"verb",ex:{ja:"æ—¥æœ¬èªã‚’è©±ã™ã€‚",rd:"ã«ã»ã‚“ã”ã‚’ã¯ãªã™ã€‚",zh:"èªªæ—¥èªã€‚"}},
{id:10,w:"è²·ã†",rd:"ã‹ã†",ro:"kau",m:"è²·",pos:"å‹•è©I",cat:"verb",ex:{ja:"ãƒ‘ãƒ³ã‚’è²·ã†ã€‚",rd:"ã±ã‚“ã‚’ã‹ã†ã€‚",zh:"è²·éºµåŒ…ã€‚"}},
{id:11,w:"æ•™ãˆã‚‹",rd:"ãŠã—ãˆã‚‹",ro:"oshieru",m:"æ•™",pos:"å‹•è©II",cat:"verb",ex:{ja:"è‹±èªã‚’æ•™ãˆã‚‹ã€‚",rd:"ãˆã„ã”ã‚’ãŠã—ãˆã‚‹ã€‚",zh:"æ•™è‹±èªã€‚"}},
{id:12,w:"å‹‰å¼·ã™ã‚‹",rd:"ã¹ã‚“ãã‚‡ã†ã™ã‚‹",ro:"benkyousuru",m:"å­¸ç¿’;ç”¨åŠŸ",pos:"å‹•è©III",cat:"verb",ex:{ja:"æ¯æ—¥å‹‰å¼·ã™ã‚‹ã€‚",rd:"ã¾ã„ã«ã¡ã¹ã‚“ãã‚‡ã†ã™ã‚‹ã€‚",zh:"æ¯å¤©å­¸ç¿’ã€‚"}},
{id:13,w:"å¯ã‚‹",rd:"ã­ã‚‹",ro:"neru",m:"ç¡è¦º",pos:"å‹•è©II",cat:"verb",ex:{ja:"æ—©ãå¯ã‚‹ã€‚",rd:"ã¯ã‚„ãã­ã‚‹ã€‚",zh:"æ—©é»ç¡ã€‚"}},
{id:14,w:"èµ·ãã‚‹",rd:"ãŠãã‚‹",ro:"okiru",m:"èµ·åºŠ",pos:"å‹•è©II",cat:"verb",ex:{ja:"æœæ—©ãèµ·ãã‚‹ã€‚",rd:"ã‚ã•ã¯ã‚„ããŠãã‚‹ã€‚",zh:"æ—©ä¸Šæ—©èµ·ã€‚"}},
{id:15,w:"æ­©ã",rd:"ã‚ã‚‹ã",ro:"aruku",m:"èµ°è·¯",pos:"å‹•è©I",cat:"verb",ex:{ja:"å…¬åœ’ã‚’æ­©ãã€‚",rd:"ã“ã†ãˆã‚“ã‚’ã‚ã‚‹ãã€‚",zh:"åœ¨å…¬åœ’èµ°è·¯ã€‚"}},
// æ—¥å¸¸åè© 15
{id:16,w:"å­¦æ ¡",rd:"ãŒã£ã“ã†",ro:"gakkou",m:"å­¸æ ¡",pos:"åè©",cat:"noun",ex:{ja:"å­¦æ ¡ã«è¡Œãã€‚",rd:"ãŒã£ã“ã†ã«ã„ãã€‚",zh:"å»å­¸æ ¡ã€‚"}},
{id:17,w:"å…ˆç”Ÿ",rd:"ã›ã‚“ã›ã„",ro:"sensei",m:"è€å¸«",pos:"åè©",cat:"noun",ex:{ja:"å…ˆç”Ÿã¯å„ªã—ã„ã€‚",rd:"ã›ã‚“ã›ã„ã¯ã‚„ã•ã—ã„ã€‚",zh:"è€å¸«å¾ˆæº«æŸ”ã€‚"}},
{id:18,w:"å‹é”",rd:"ã¨ã‚‚ã ã¡",ro:"tomodachi",m:"æœ‹å‹",pos:"åè©",cat:"noun",ex:{ja:"å‹é”ã¨éŠã¶ã€‚",rd:"ã¨ã‚‚ã ã¡ã¨ã‚ãã¶ã€‚",zh:"å’Œæœ‹å‹ç©ã€‚"}},
{id:19,w:"å®¶",rd:"ã„ãˆ",ro:"ie",m:"å®¶",pos:"åè©",cat:"noun",ex:{ja:"å®¶ã«å¸°ã‚‹ã€‚",rd:"ã„ãˆã«ã‹ãˆã‚‹ã€‚",zh:"å›å®¶ã€‚"}},
{id:20,w:"é§…",rd:"ãˆã",ro:"eki",m:"è»Šç«™",pos:"åè©",cat:"noun",ex:{ja:"é§…ã¾ã§æ­©ãã€‚",rd:"ãˆãã¾ã§ã‚ã‚‹ãã€‚",zh:"èµ°åˆ°è»Šç«™ã€‚"}},
{id:21,w:"é›»è»Š",rd:"ã§ã‚“ã—ã‚ƒ",ro:"densha",m:"é›»è»Š",pos:"åè©",cat:"noun",ex:{ja:"é›»è»Šã«ä¹—ã‚‹ã€‚",rd:"ã§ã‚“ã—ã‚ƒã«ã®ã‚‹ã€‚",zh:"æ­é›»è»Šã€‚"}},
{id:22,w:"æ™‚é–“",rd:"ã˜ã‹ã‚“",ro:"jikan",m:"æ™‚é–“",pos:"åè©",cat:"noun",ex:{ja:"æ™‚é–“ãŒãªã„ã€‚",rd:"ã˜ã‹ã‚“ãŒãªã„ã€‚",zh:"æ²’æœ‰æ™‚é–“ã€‚"}},
{id:23,w:"å¤©æ°—",rd:"ã¦ã‚“ã",ro:"tenki",m:"å¤©æ°£",pos:"åè©",cat:"noun",ex:{ja:"ä»Šæ—¥ã¯å¤©æ°—ãŒã„ã„ã€‚",rd:"ãã‚‡ã†ã¯ã¦ã‚“ããŒã„ã„ã€‚",zh:"ä»Šå¤©å¤©æ°£å¥½ã€‚"}},
{id:24,w:"æ°´",rd:"ã¿ãš",ro:"mizu",m:"æ°´",pos:"åè©",cat:"noun",ex:{ja:"æ°´ã‚’é£²ã‚€ã€‚",rd:"ã¿ãšã‚’ã®ã‚€ã€‚",zh:"å–æ°´ã€‚"}},
{id:25,w:"æœ¬",rd:"ã»ã‚“",ro:"hon",m:"æ›¸",pos:"åè©",cat:"noun",ex:{ja:"æœ¬ã‚’èª­ã‚€ã€‚",rd:"ã»ã‚“ã‚’ã‚ˆã‚€ã€‚",zh:"è®€æ›¸ã€‚"}},
{id:26,w:"é›»è©±",rd:"ã§ã‚“ã‚",ro:"denwa",m:"é›»è©±",pos:"åè©",cat:"noun",ex:{ja:"é›»è©±ã‚’ã‹ã‘ã‚‹ã€‚",rd:"ã§ã‚“ã‚ã‚’ã‹ã‘ã‚‹ã€‚",zh:"æ‰“é›»è©±ã€‚"}},
{id:27,w:"æ–°è",rd:"ã—ã‚“ã¶ã‚“",ro:"shinbun",m:"å ±ç´™",pos:"åè©",cat:"noun",ex:{ja:"æ–°èã‚’èª­ã‚€ã€‚",rd:"ã—ã‚“ã¶ã‚“ã‚’ã‚ˆã‚€ã€‚",zh:"è®€å ±ç´™ã€‚"}},
{id:28,w:"æ˜ ç”»",rd:"ãˆã„ãŒ",ro:"eiga",m:"é›»å½±",pos:"åè©",cat:"noun",ex:{ja:"æ˜ ç”»ã‚’è¦‹ã‚‹ã€‚",rd:"ãˆã„ãŒã‚’ã¿ã‚‹ã€‚",zh:"çœ‹é›»å½±ã€‚"}},
{id:29,w:"éŸ³æ¥½",rd:"ãŠã‚“ãŒã",ro:"ongaku",m:"éŸ³æ¨‚",pos:"åè©",cat:"noun",ex:{ja:"éŸ³æ¥½ã‚’èãã€‚",rd:"ãŠã‚“ãŒãã‚’ããã€‚",zh:"è½éŸ³æ¨‚ã€‚"}},
{id:30,w:"å†™çœŸ",rd:"ã—ã‚ƒã—ã‚“",ro:"shashin",m:"ç…§ç‰‡",pos:"åè©",cat:"noun",ex:{ja:"å†™çœŸã‚’æ’®ã‚‹ã€‚",rd:"ã—ã‚ƒã—ã‚“ã‚’ã¨ã‚‹ã€‚",zh:"æ‹ç…§ã€‚"}},
// å½¢å®¹è© 10
{id:31,w:"å¤§ãã„",rd:"ãŠãŠãã„",ro:"ookii",m:"å¤§çš„",pos:"ã„å½¢å®¹è©",cat:"adj",ex:{ja:"å¤§ãã„çŠ¬ãŒã„ã‚‹ã€‚",rd:"ãŠãŠãã„ã„ã¬ãŒã„ã‚‹ã€‚",zh:"æœ‰ä¸€éš»å¤§ç‹—ã€‚"}},
{id:32,w:"å°ã•ã„",rd:"ã¡ã„ã•ã„",ro:"chiisai",m:"å°çš„",pos:"ã„å½¢å®¹è©",cat:"adj",ex:{ja:"å°ã•ã„çŒ«ãŒå¥½ãã€‚",rd:"ã¡ã„ã•ã„ã­ã“ãŒã™ãã€‚",zh:"å–œæ­¡å°è²“ã€‚"}},
{id:33,w:"é«˜ã„",rd:"ãŸã‹ã„",ro:"takai",m:"é«˜çš„;è²´çš„",pos:"ã„å½¢å®¹è©",cat:"adj",ex:{ja:"ã“ã®å±±ã¯é«˜ã„ã€‚",rd:"ã“ã®ã‚„ã¾ã¯ãŸã‹ã„ã€‚",zh:"é€™åº§å±±å¾ˆé«˜ã€‚"}},
{id:34,w:"å®‰ã„",rd:"ã‚„ã™ã„",ro:"yasui",m:"ä¾¿å®œçš„",pos:"ã„å½¢å®¹è©",cat:"adj",ex:{ja:"ã“ã®åº—ã¯å®‰ã„ã€‚",rd:"ã“ã®ã¿ã›ã¯ã‚„ã™ã„ã€‚",zh:"é€™å®¶åº—å¾ˆä¾¿å®œã€‚"}},
{id:35,w:"æ–°ã—ã„",rd:"ã‚ãŸã‚‰ã—ã„",ro:"atarashii",m:"æ–°çš„",pos:"ã„å½¢å®¹è©",cat:"adj",ex:{ja:"æ–°ã—ã„é´ã‚’è²·ã£ãŸã€‚",rd:"ã‚ãŸã‚‰ã—ã„ãã¤ã‚’ã‹ã£ãŸã€‚",zh:"è²·äº†æ–°é‹ã€‚"}},
{id:36,w:"å¤ã„",rd:"ãµã‚‹ã„",ro:"furui",m:"èˆŠçš„",pos:"ã„å½¢å®¹è©",cat:"adj",ex:{ja:"å¤ã„æœ¬ã‚’èª­ã‚€ã€‚",rd:"ãµã‚‹ã„ã»ã‚“ã‚’ã‚ˆã‚€ã€‚",zh:"è®€èˆŠæ›¸ã€‚"}},
{id:37,w:"è‰¯ã„",rd:"ã„ã„",ro:"ii",m:"å¥½çš„",pos:"ã„å½¢å®¹è©",cat:"adj",ex:{ja:"å¤©æ°—ãŒè‰¯ã„ã€‚",rd:"ã¦ã‚“ããŒã„ã„ã€‚",zh:"å¤©æ°£å¥½ã€‚"}},
{id:38,w:"æ‚ªã„",rd:"ã‚ã‚‹ã„",ro:"warui",m:"å£çš„",pos:"ã„å½¢å®¹è©",cat:"adj",ex:{ja:"æ°—åˆ†ãŒæ‚ªã„ã€‚",rd:"ãã¶ã‚“ãŒã‚ã‚‹ã„ã€‚",zh:"å¿ƒæƒ…ä¸å¥½ã€‚"}},
{id:39,w:"æš‘ã„",rd:"ã‚ã¤ã„",ro:"atsui",m:"ç†±çš„(å¤©æ°£)",pos:"ã„å½¢å®¹è©",cat:"adj",ex:{ja:"ä»Šæ—¥ã¯æš‘ã„ã€‚",rd:"ãã‚‡ã†ã¯ã‚ã¤ã„ã€‚",zh:"ä»Šå¤©å¾ˆç†±ã€‚"}},
{id:40,w:"å¯’ã„",rd:"ã•ã‚€ã„",ro:"samui",m:"å†·çš„(å¤©æ°£)",pos:"ã„å½¢å®¹è©",cat:"adj",ex:{ja:"å†¬ã¯å¯’ã„ã€‚",rd:"ãµã‚†ã¯ã•ã‚€ã„ã€‚",zh:"å†¬å¤©å¾ˆå†·ã€‚"}},
// å ´æ‰€ 8
{id:41,w:"ç—…é™¢",rd:"ã³ã‚‡ã†ã„ã‚“",ro:"byouin",m:"é†«é™¢",pos:"åè©",cat:"place",ex:{ja:"ç—…é™¢ã«è¡Œãã€‚",rd:"ã³ã‚‡ã†ã„ã‚“ã«ã„ãã€‚",zh:"å»é†«é™¢ã€‚"}},
{id:42,w:"éŠ€è¡Œ",rd:"ãã‚“ã“ã†",ro:"ginkou",m:"éŠ€è¡Œ",pos:"åè©",cat:"place",ex:{ja:"éŠ€è¡Œã§ãŠé‡‘ã‚’ä¸‹ã‚ã™ã€‚",rd:"ãã‚“ã“ã†ã§ãŠã‹ã­ã‚’ãŠã‚ã™ã€‚",zh:"åœ¨éŠ€è¡Œé ˜éŒ¢ã€‚"}},
{id:43,w:"éƒµä¾¿å±€",rd:"ã‚†ã†ã³ã‚“ãã‚‡ã",ro:"yuubinkyoku",m:"éƒµå±€",pos:"åè©",cat:"place",ex:{ja:"éƒµä¾¿å±€ã§æ‰‹ç´™ã‚’å‡ºã™ã€‚",rd:"ã‚†ã†ã³ã‚“ãã‚‡ãã§ã¦ãŒã¿ã‚’ã ã™ã€‚",zh:"åœ¨éƒµå±€å¯„ä¿¡ã€‚"}},
{id:44,w:"å›³æ›¸é¤¨",rd:"ã¨ã—ã‚‡ã‹ã‚“",ro:"toshokan",m:"åœ–æ›¸é¤¨",pos:"åè©",cat:"place",ex:{ja:"å›³æ›¸é¤¨ã§å‹‰å¼·ã™ã‚‹ã€‚",rd:"ã¨ã—ã‚‡ã‹ã‚“ã§ã¹ã‚“ãã‚‡ã†ã™ã‚‹ã€‚",zh:"åœ¨åœ–æ›¸é¤¨è®€æ›¸ã€‚"}},
{id:45,w:"å…¬åœ’",rd:"ã“ã†ãˆã‚“",ro:"kouen",m:"å…¬åœ’",pos:"åè©",cat:"place",ex:{ja:"å…¬åœ’ã§éŠã¶ã€‚",rd:"ã“ã†ãˆã‚“ã§ã‚ãã¶ã€‚",zh:"åœ¨å…¬åœ’ç©ã€‚"}},
{id:46,w:"ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³",rd:"ã‚Œã™ã¨ã‚‰ã‚“",ro:"resutoran",m:"é¤å»³",pos:"åè©",cat:"place",ex:{ja:"ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã§é£Ÿã¹ã‚‹ã€‚",rd:"ã‚Œã™ã¨ã‚‰ã‚“ã§ãŸã¹ã‚‹ã€‚",zh:"åœ¨é¤å»³åƒé£¯ã€‚"}},
{id:47,w:"ã‚³ãƒ³ãƒ“ãƒ‹",rd:"ã“ã‚“ã³ã«",ro:"konbini",m:"ä¾¿åˆ©å•†åº—",pos:"åè©",cat:"place",ex:{ja:"ã‚³ãƒ³ãƒ“ãƒ‹ã§è²·ã†ã€‚",rd:"ã“ã‚“ã³ã«ã§ã‹ã†ã€‚",zh:"åœ¨ä¾¿åˆ©å•†åº—è²·ã€‚"}},
{id:48,w:"ã‚¹ãƒ¼ãƒ‘ãƒ¼",rd:"ã™ãƒ¼ã±ãƒ¼",ro:"suupaa",m:"è¶…å¸‚",pos:"åè©",cat:"place",ex:{ja:"ã‚¹ãƒ¼ãƒ‘ãƒ¼ã§é‡èœã‚’è²·ã†ã€‚",rd:"ã™ãƒ¼ã±ãƒ¼ã§ã‚„ã•ã„ã‚’ã‹ã†ã€‚",zh:"åœ¨è¶…å¸‚è²·è”¬èœã€‚"}},
// äººç‰© 8
{id:49,w:"ãŠçˆ¶ã•ã‚“",rd:"ãŠã¨ã†ã•ã‚“",ro:"otousan",m:"çˆ¸çˆ¸",pos:"åè©",cat:"people",ex:{ja:"ãŠçˆ¶ã•ã‚“ã¯ä¼šç¤¾å“¡ã§ã™ã€‚",rd:"ãŠã¨ã†ã•ã‚“ã¯ã‹ã„ã—ã‚ƒã„ã‚“ã§ã™ã€‚",zh:"çˆ¸çˆ¸æ˜¯ä¸Šç­æ—ã€‚"}},
{id:50,w:"ãŠæ¯ã•ã‚“",rd:"ãŠã‹ã‚ã•ã‚“",ro:"okaasan",m:"åª½åª½",pos:"åè©",cat:"people",ex:{ja:"ãŠæ¯ã•ã‚“ã¯æ–™ç†ãŒä¸Šæ‰‹ã€‚",rd:"ãŠã‹ã‚ã•ã‚“ã¯ã‚Šã‚‡ã†ã‚ŠãŒã˜ã‚‡ã†ãšã€‚",zh:"åª½åª½å¾ˆæœƒåšèœã€‚"}},
{id:51,w:"å…„",rd:"ã‚ã«",ro:"ani",m:"å“¥å“¥",pos:"åè©",cat:"people",ex:{ja:"å…„ã¯å¤§å­¦ç”Ÿã§ã™ã€‚",rd:"ã‚ã«ã¯ã ã„ãŒãã›ã„ã§ã™ã€‚",zh:"å“¥å“¥æ˜¯å¤§å­¸ç”Ÿã€‚"}},
{id:52,w:"å§‰",rd:"ã‚ã­",ro:"ane",m:"å§Šå§Š",pos:"åè©",cat:"people",ex:{ja:"å§‰ã¯å…ˆç”Ÿã§ã™ã€‚",rd:"ã‚ã­ã¯ã›ã‚“ã›ã„ã§ã™ã€‚",zh:"å§Šå§Šæ˜¯è€å¸«ã€‚"}},
{id:53,w:"å¼Ÿ",rd:"ãŠã¨ã†ã¨",ro:"otouto",m:"å¼Ÿå¼Ÿ",pos:"åè©",cat:"people",ex:{ja:"å¼Ÿã¯é«˜æ ¡ç”Ÿã§ã™ã€‚",rd:"ãŠã¨ã†ã¨ã¯ã“ã†ã“ã†ã›ã„ã§ã™ã€‚",zh:"å¼Ÿå¼Ÿæ˜¯é«˜ä¸­ç”Ÿã€‚"}},
{id:54,w:"å¦¹",rd:"ã„ã‚‚ã†ã¨",ro:"imouto",m:"å¦¹å¦¹",pos:"åè©",cat:"people",ex:{ja:"å¦¹ã¯ä¸­å­¦ç”Ÿã§ã™ã€‚",rd:"ã„ã‚‚ã†ã¨ã¯ã¡ã‚…ã†ãŒãã›ã„ã§ã™ã€‚",zh:"å¦¹å¦¹æ˜¯åœ‹ä¸­ç”Ÿã€‚"}},
{id:55,w:"å­ä¾›",rd:"ã“ã©ã‚‚",ro:"kodomo",m:"å°å­©",pos:"åè©",cat:"people",ex:{ja:"å­ä¾›ãŒéŠã‚“ã§ã„ã‚‹ã€‚",rd:"ã“ã©ã‚‚ãŒã‚ãã‚“ã§ã„ã‚‹ã€‚",zh:"å°å­©åœ¨ç©ã€‚"}},
{id:56,w:"å­¦ç”Ÿ",rd:"ãŒãã›ã„",ro:"gakusei",m:"å­¸ç”Ÿ",pos:"åè©",cat:"people",ex:{ja:"ç§ã¯å­¦ç”Ÿã§ã™ã€‚",rd:"ã‚ãŸã—ã¯ãŒãã›ã„ã§ã™ã€‚",zh:"æˆ‘æ˜¯å­¸ç”Ÿã€‚"}},
// æ™‚é–“ 8
{id:57,w:"ä»Šæ—¥",rd:"ãã‚‡ã†",ro:"kyou",m:"ä»Šå¤©",pos:"åè©",cat:"time",ex:{ja:"ä»Šæ—¥ã¯æœˆæ›œæ—¥ã§ã™ã€‚",rd:"ãã‚‡ã†ã¯ã’ã¤ã‚ˆã†ã³ã§ã™ã€‚",zh:"ä»Šå¤©æ˜¯æ˜ŸæœŸä¸€ã€‚"}},
{id:58,w:"æ˜æ—¥",rd:"ã‚ã—ãŸ",ro:"ashita",m:"æ˜å¤©",pos:"åè©",cat:"time",ex:{ja:"æ˜æ—¥ã¯ä¼‘ã¿ã§ã™ã€‚",rd:"ã‚ã—ãŸã¯ã‚„ã™ã¿ã§ã™ã€‚",zh:"æ˜å¤©ä¼‘æ¯ã€‚"}},
{id:59,w:"æ˜¨æ—¥",rd:"ãã®ã†",ro:"kinou",m:"æ˜¨å¤©",pos:"åè©",cat:"time",ex:{ja:"æ˜¨æ—¥ã¯é›¨ã ã£ãŸã€‚",rd:"ãã®ã†ã¯ã‚ã‚ã ã£ãŸã€‚",zh:"æ˜¨å¤©ä¸‹é›¨äº†ã€‚"}},
{id:60,w:"æœ",rd:"ã‚ã•",ro:"asa",m:"æ—©ä¸Š",pos:"åè©",cat:"time",ex:{ja:"æœã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹ã€‚",rd:"ã‚ã•ã”ã¯ã‚“ã‚’ãŸã¹ã‚‹ã€‚",zh:"åƒæ—©é¤ã€‚"}},
{id:61,w:"æ˜¼",rd:"ã²ã‚‹",ro:"hiru",m:"ä¸­åˆ",pos:"åè©",cat:"time",ex:{ja:"æ˜¼ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹ã€‚",rd:"ã²ã‚‹ã”ã¯ã‚“ã‚’ãŸã¹ã‚‹ã€‚",zh:"åƒåˆé¤ã€‚"}},
{id:62,w:"å¤œ",rd:"ã‚ˆã‚‹",ro:"yoru",m:"æ™šä¸Š",pos:"åè©",cat:"time",ex:{ja:"å¤œã¯é™ã‹ã§ã™ã€‚",rd:"ã‚ˆã‚‹ã¯ã—ãšã‹ã§ã™ã€‚",zh:"æ™šä¸Šå¾ˆå®‰éœã€‚"}},
{id:63,w:"ä»Š",rd:"ã„ã¾",ro:"ima",m:"ç¾åœ¨",pos:"åè©",cat:"time",ex:{ja:"ä»Šã€ä½•æ™‚ã§ã™ã‹ã€‚",rd:"ã„ã¾ã€ãªã‚“ã˜ã§ã™ã‹ã€‚",zh:"ç¾åœ¨å¹¾é»ï¼Ÿ"}},
{id:64,w:"æ¯æ—¥",rd:"ã¾ã„ã«ã¡",ro:"mainichi",m:"æ¯å¤©",pos:"åè©",cat:"time",ex:{ja:"æ¯æ—¥å‹‰å¼·ã™ã‚‹ã€‚",rd:"ã¾ã„ã«ã¡ã¹ã‚“ãã‚‡ã†ã™ã‚‹ã€‚",zh:"æ¯å¤©å­¸ç¿’ã€‚"}},
// æ‹›å‘¼ 8
{id:65,w:"ãŠã¯ã‚ˆã†",rd:"ãŠã¯ã‚ˆã†",ro:"ohayou",m:"æ—©å®‰",pos:"æ„Ÿå˜†è©",cat:"greet",ex:{ja:"ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ã€‚",rd:"ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ã€‚",zh:"æ—©å®‰ï¼ˆç¦®è²Œå½¢ï¼‰ã€‚"}},
{id:66,w:"ã“ã‚“ã«ã¡ã¯",rd:"ã“ã‚“ã«ã¡ã¯",ro:"konnichiwa",m:"ä½ å¥½",pos:"æ„Ÿå˜†è©",cat:"greet",ex:{ja:"ã“ã‚“ã«ã¡ã¯ã€å…ƒæ°—ã§ã™ã‹ã€‚",rd:"ã“ã‚“ã«ã¡ã¯ã€ã’ã‚“ãã§ã™ã‹ã€‚",zh:"ä½ å¥½ï¼Œä½ å¥½å—ï¼Ÿ"}},
{id:67,w:"ã‚ã‚ŠãŒã¨ã†",rd:"ã‚ã‚ŠãŒã¨ã†",ro:"arigatou",m:"è¬è¬",pos:"æ„Ÿå˜†è©",cat:"greet",ex:{ja:"ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚",rd:"ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚",zh:"éå¸¸æ„Ÿè¬ã€‚"}},
{id:68,w:"ã™ã¿ã¾ã›ã‚“",rd:"ã™ã¿ã¾ã›ã‚“",ro:"sumimasen",m:"ä¸å¥½æ„æ€;å°ä¸èµ·",pos:"æ„Ÿå˜†è©",cat:"greet",ex:{ja:"ã™ã¿ã¾ã›ã‚“ã€é§…ã¯ã©ã“ã§ã™ã‹ã€‚",rd:"ã™ã¿ã¾ã›ã‚“ã€ãˆãã¯ã©ã“ã§ã™ã‹ã€‚",zh:"ä¸å¥½æ„æ€ï¼Œè»Šç«™åœ¨å“ªè£¡ï¼Ÿ"}},
{id:69,w:"ãŠé¡˜ã„ã—ã¾ã™",rd:"ãŠã­ãŒã„ã—ã¾ã™",ro:"onegaishimasu",m:"æ‹œè¨—äº†;éº»ç…©ä½ ",pos:"æ„Ÿå˜†è©",cat:"greet",ex:{ja:"ã“ã‚Œã€ãŠé¡˜ã„ã—ã¾ã™ã€‚",rd:"ã“ã‚Œã€ãŠã­ãŒã„ã—ã¾ã™ã€‚",zh:"éº»ç…©ä½ é€™å€‹ã€‚"}},
{id:70,w:"ã•ã‚ˆã†ãªã‚‰",rd:"ã•ã‚ˆã†ãªã‚‰",ro:"sayounara",m:"å†è¦‹",pos:"æ„Ÿå˜†è©",cat:"greet",ex:{ja:"ã•ã‚ˆã†ãªã‚‰ã€ã¾ãŸæ˜æ—¥ã€‚",rd:"ã•ã‚ˆã†ãªã‚‰ã€ã¾ãŸã‚ã—ãŸã€‚",zh:"å†è¦‹ï¼Œæ˜å¤©è¦‹ã€‚"}},
{id:71,w:"ã¯ã„",rd:"ã¯ã„",ro:"hai",m:"æ˜¯;å¥½",pos:"æ„Ÿå˜†è©",cat:"greet",ex:{ja:"ã¯ã„ã€ã‚ã‹ã‚Šã¾ã—ãŸã€‚",rd:"ã¯ã„ã€ã‚ã‹ã‚Šã¾ã—ãŸã€‚",zh:"æ˜¯çš„ï¼Œæˆ‘çŸ¥é“äº†ã€‚"}},
{id:72,w:"ã„ã„ãˆ",rd:"ã„ã„ãˆ",ro:"iie",m:"ä¸æ˜¯;ä¸",pos:"æ„Ÿå˜†è©",cat:"greet",ex:{ja:"ã„ã„ãˆã€é•ã„ã¾ã™ã€‚",rd:"ã„ã„ãˆã€ã¡ãŒã„ã¾ã™ã€‚",zh:"ä¸ï¼Œä¸æ˜¯çš„ã€‚"}},
// æ•¸é‡ 8
{id:73,w:"ä¸€ã¤",rd:"ã²ã¨ã¤",ro:"hitotsu",m:"ä¸€å€‹",pos:"æ•¸é‡è©",cat:"num",ex:{ja:"ã‚Šã‚“ã”ã‚’ä¸€ã¤ãã ã•ã„ã€‚",rd:"ã‚Šã‚“ã”ã‚’ã²ã¨ã¤ãã ã•ã„ã€‚",zh:"è«‹çµ¦æˆ‘ä¸€å€‹è˜‹æœã€‚"}},
{id:74,w:"äºŒã¤",rd:"ãµãŸã¤",ro:"futatsu",m:"å…©å€‹",pos:"æ•¸é‡è©",cat:"num",ex:{ja:"åµã‚’äºŒã¤è²·ã†ã€‚",rd:"ãŸã¾ã”ã‚’ãµãŸã¤ã‹ã†ã€‚",zh:"è²·å…©å€‹è›‹ã€‚"}},
{id:75,w:"ä¸‰ã¤",rd:"ã¿ã£ã¤",ro:"mittsu",m:"ä¸‰å€‹",pos:"æ•¸é‡è©",cat:"num",ex:{ja:"ç®±ãŒä¸‰ã¤ã‚ã‚‹ã€‚",rd:"ã¯ã“ãŒã¿ã£ã¤ã‚ã‚‹ã€‚",zh:"æœ‰ä¸‰å€‹ç®±å­ã€‚"}},
{id:76,w:"ç™¾",rd:"ã²ã‚ƒã",ro:"hyaku",m:"ç™¾",pos:"æ•¸è©",cat:"num",ex:{ja:"ç™¾å††ã§ã™ã€‚",rd:"ã²ã‚ƒããˆã‚“ã§ã™ã€‚",zh:"ä¸€ç™¾æ—¥åœ“ã€‚"}},
{id:77,w:"åƒ",rd:"ã›ã‚“",ro:"sen",m:"åƒ",pos:"æ•¸è©",cat:"num",ex:{ja:"åƒå††æœ­ã€‚",rd:"ã›ã‚“ãˆã‚“ã•ã¤ã€‚",zh:"åƒåœ“éˆ”ç¥¨ã€‚"}},
{id:78,w:"ä¸‡",rd:"ã¾ã‚“",ro:"man",m:"è¬",pos:"æ•¸è©",cat:"num",ex:{ja:"ä¸€ä¸‡å††ã€‚",rd:"ã„ã¡ã¾ã‚“ãˆã‚“ã€‚",zh:"ä¸€è¬æ—¥åœ“ã€‚"}},
{id:79,w:"å††",rd:"ãˆã‚“",ro:"en",m:"æ—¥åœ“",pos:"åè©",cat:"num",ex:{ja:"äº”ç™¾å††ã§ã™ã€‚",rd:"ã”ã²ã‚ƒããˆã‚“ã§ã™ã€‚",zh:"äº”ç™¾æ—¥åœ“ã€‚"}},
{id:80,w:"å€‹",rd:"ã“",ro:"ko",m:"å€‹(é‡è©)",pos:"é‡è©",cat:"num",ex:{ja:"ä¸‰å€‹ãã ã•ã„ã€‚",rd:"ã•ã‚“ã“ãã ã•ã„ã€‚",zh:"è«‹çµ¦æˆ‘ä¸‰å€‹ã€‚"}},
// ===== é£Ÿã¹ç‰© 10 =====
{id:81,w:"ã”é£¯",rd:"ã”ã¯ã‚“",ro:"gohan",m:"é£¯;é¤",pos:"åè©",cat:"food",ex:{ja:"ã”é£¯ã‚’é£Ÿã¹ã¾ã—ã‚‡ã†ã€‚",rd:"ã”ã¯ã‚“ã‚’ãŸã¹ã¾ã—ã‚‡ã†ã€‚",zh:"ä¸€èµ·åƒé£¯å§ã€‚"}},
{id:82,w:"è‚‰",rd:"ã«ã",ro:"niku",m:"è‚‰",pos:"åè©",cat:"food",ex:{ja:"è‚‰ãŒå¥½ãã§ã™ã€‚",rd:"ã«ããŒã™ãã§ã™ã€‚",zh:"å–œæ­¡åƒè‚‰ã€‚"}},
{id:83,w:"é­š",rd:"ã•ã‹ãª",ro:"sakana",m:"é­š",pos:"åè©",cat:"food",ex:{ja:"é­šã‚’ç„¼ãã€‚",rd:"ã•ã‹ãªã‚’ã‚„ãã€‚",zh:"çƒ¤é­šã€‚"}},
{id:84,w:"é‡èœ",rd:"ã‚„ã•ã„",ro:"yasai",m:"è”¬èœ",pos:"åè©",cat:"food",ex:{ja:"é‡èœã‚’ãŸãã•ã‚“é£Ÿã¹ã‚‹ã€‚",rd:"ã‚„ã•ã„ã‚’ãŸãã•ã‚“ãŸã¹ã‚‹ã€‚",zh:"å¤šåƒè”¬èœã€‚"}},
{id:85,w:"æœç‰©",rd:"ãã ã‚‚ã®",ro:"kudamono",m:"æ°´æœ",pos:"åè©",cat:"food",ex:{ja:"æœç‰©ãŒç¾å‘³ã—ã„ã€‚",rd:"ãã ã‚‚ã®ãŒãŠã„ã—ã„ã€‚",zh:"æ°´æœå¥½åƒã€‚"}},
{id:86,w:"ãƒ‘ãƒ³",rd:"ã±ã‚“",ro:"pan",m:"éºµåŒ…",pos:"åè©",cat:"food",ex:{ja:"æœãƒ‘ãƒ³ã‚’é£Ÿã¹ã‚‹ã€‚",rd:"ã‚ã•ã±ã‚“ã‚’ãŸã¹ã‚‹ã€‚",zh:"æ—©ä¸ŠåƒéºµåŒ…ã€‚"}},
{id:87,w:"åµ",rd:"ãŸã¾ã”",ro:"tamago",m:"è›‹",pos:"åè©",cat:"food",ex:{ja:"åµã‚’å‰²ã‚‹ã€‚",rd:"ãŸã¾ã”ã‚’ã‚ã‚‹ã€‚",zh:"æ‰“è›‹ã€‚"}},
{id:88,w:"ç‰›ä¹³",rd:"ãã‚…ã†ã«ã‚…ã†",ro:"gyuunyuu",m:"ç‰›å¥¶",pos:"åè©",cat:"food",ex:{ja:"ç‰›ä¹³ã‚’é£²ã‚€ã€‚",rd:"ãã‚…ã†ã«ã‚…ã†ã‚’ã®ã‚€ã€‚",zh:"å–ç‰›å¥¶ã€‚"}},
{id:89,w:"ãŠèŒ¶",rd:"ãŠã¡ã‚ƒ",ro:"ocha",m:"èŒ¶",pos:"åè©",cat:"food",ex:{ja:"ãŠèŒ¶ã‚’ã©ã†ãã€‚",rd:"ãŠã¡ã‚ƒã‚’ã©ã†ãã€‚",zh:"è«‹å–èŒ¶ã€‚"}},
{id:90,w:"ã‚³ãƒ¼ãƒ’ãƒ¼",rd:"ã“ãƒ¼ã²ãƒ¼",ro:"koohii",m:"å’–å•¡",pos:"åè©",cat:"food",ex:{ja:"ã‚³ãƒ¼ãƒ’ãƒ¼ã‚’ä¸€æ¯ãã ã•ã„ã€‚",rd:"ã“ãƒ¼ã²ãƒ¼ã‚’ã„ã£ã±ã„ãã ã•ã„ã€‚",zh:"è«‹çµ¦æˆ‘ä¸€æ¯å’–å•¡ã€‚"}},
// ===== è‰² 5 =====
{id:91,w:"èµ¤",rd:"ã‚ã‹",ro:"aka",m:"ç´…è‰²",pos:"åè©",cat:"color",ex:{ja:"èµ¤ã„èŠ±ãŒå’²ã„ãŸã€‚",rd:"ã‚ã‹ã„ã¯ãªãŒã•ã„ãŸã€‚",zh:"ç´…è‰²çš„èŠ±é–‹äº†ã€‚"}},
{id:92,w:"é’",rd:"ã‚ãŠ",ro:"ao",m:"è—è‰²",pos:"åè©",cat:"color",ex:{ja:"ç©ºã¯é’ã„ã€‚",rd:"ãã‚‰ã¯ã‚ãŠã„ã€‚",zh:"å¤©ç©ºæ˜¯è—è‰²çš„ã€‚"}},
{id:93,w:"ç™½",rd:"ã—ã‚",ro:"shiro",m:"ç™½è‰²",pos:"åè©",cat:"color",ex:{ja:"ç™½ã„é›²ãŒè¦‹ãˆã‚‹ã€‚",rd:"ã—ã‚ã„ãã‚‚ãŒã¿ãˆã‚‹ã€‚",zh:"çœ‹å¾—åˆ°ç™½è‰²çš„é›²ã€‚"}},
{id:94,w:"é»’",rd:"ãã‚",ro:"kuro",m:"é»‘è‰²",pos:"åè©",cat:"color",ex:{ja:"é»’ã„çŒ«ãŒã„ã‚‹ã€‚",rd:"ãã‚ã„ã­ã“ãŒã„ã‚‹ã€‚",zh:"æœ‰ä¸€éš»é»‘è²“ã€‚"}},
{id:95,w:"é»„è‰²",rd:"ãã„ã‚",ro:"kiiro",m:"é»ƒè‰²",pos:"åè©",cat:"color",ex:{ja:"é»„è‰²ã„èŠ±ãŒå¥½ãã€‚",rd:"ãã„ã‚ã„ã¯ãªãŒã™ãã€‚",zh:"å–œæ­¡é»ƒè‰²çš„èŠ±ã€‚"}},
// ===== è‡ªç„¶ 5 =====
{id:96,w:"å±±",rd:"ã‚„ã¾",ro:"yama",m:"å±±",pos:"åè©",cat:"nature",ex:{ja:"å±±ã«ç™»ã‚‹ã€‚",rd:"ã‚„ã¾ã«ã®ã¼ã‚‹ã€‚",zh:"çˆ¬å±±ã€‚"}},
{id:97,w:"æµ·",rd:"ã†ã¿",ro:"umi",m:"æµ·",pos:"åè©",cat:"nature",ex:{ja:"æµ·ã§æ³³ãã€‚",rd:"ã†ã¿ã§ãŠã‚ˆãã€‚",zh:"åœ¨æµ·è£¡æ¸¸æ³³ã€‚"}},
{id:98,w:"å·",rd:"ã‹ã‚",ro:"kawa",m:"æ²³",pos:"åè©",cat:"nature",ex:{ja:"å·ã§é­šã‚’é‡£ã‚‹ã€‚",rd:"ã‹ã‚ã§ã•ã‹ãªã‚’ã¤ã‚‹ã€‚",zh:"åœ¨æ²³è£¡é‡£é­šã€‚"}},
{id:99,w:"èŠ±",rd:"ã¯ãª",ro:"hana",m:"èŠ±",pos:"åè©",cat:"nature",ex:{ja:"èŠ±ãŒå’²ã„ã¦ã„ã‚‹ã€‚",rd:"ã¯ãªãŒã•ã„ã¦ã„ã‚‹ã€‚",zh:"èŠ±æ­£åœ¨é–‹ã€‚"}},
{id:100,w:"ç©º",rd:"ãã‚‰",ro:"sora",m:"å¤©ç©º",pos:"åè©",cat:"nature",ex:{ja:"ç©ºãŒãã‚Œã„ã ã€‚",rd:"ãã‚‰ãŒãã‚Œã„ã ã€‚",zh:"å¤©ç©ºå¾ˆç¾ã€‚"}},
// ===== ä½“ 5 =====
{id:101,w:"ç›®",rd:"ã‚",ro:"me",m:"çœ¼ç›",pos:"åè©",cat:"body",ex:{ja:"ç›®ãŒå¤§ãã„ã€‚",rd:"ã‚ãŒãŠãŠãã„ã€‚",zh:"çœ¼ç›å¾ˆå¤§ã€‚"}},
{id:102,w:"è€³",rd:"ã¿ã¿",ro:"mimi",m:"è€³æœµ",pos:"åè©",cat:"body",ex:{ja:"è€³ãŒç—›ã„ã€‚",rd:"ã¿ã¿ãŒã„ãŸã„ã€‚",zh:"è€³æœµç—›ã€‚"}},
{id:103,w:"å£",rd:"ãã¡",ro:"kuchi",m:"å˜´å·´",pos:"åè©",cat:"body",ex:{ja:"å£ã‚’é–‹ã‘ã‚‹ã€‚",rd:"ãã¡ã‚’ã‚ã‘ã‚‹ã€‚",zh:"å¼µé–‹å˜´å·´ã€‚"}},
{id:104,w:"æ‰‹",rd:"ã¦",ro:"te",m:"æ‰‹",pos:"åè©",cat:"body",ex:{ja:"æ‰‹ã‚’æ´—ã†ã€‚",rd:"ã¦ã‚’ã‚ã‚‰ã†ã€‚",zh:"æ´—æ‰‹ã€‚"}},
{id:105,w:"è¶³",rd:"ã‚ã—",ro:"ashi",m:"è…³",pos:"åè©",cat:"body",ex:{ja:"è¶³ãŒé€Ÿã„ã€‚",rd:"ã‚ã—ãŒã¯ã‚„ã„ã€‚",zh:"è·‘å¾—å¿«ã€‚"}},
// ===== å‹•è©2 10 =====
{id:106,w:"ä½œã‚‹",rd:"ã¤ãã‚‹",ro:"tsukuru",m:"è£½ä½œ",pos:"å‹•è©I",cat:"verb2",ex:{ja:"æ–™ç†ã‚’ä½œã‚‹ã€‚",rd:"ã‚Šã‚‡ã†ã‚Šã‚’ã¤ãã‚‹ã€‚",zh:"åšæ–™ç†ã€‚"}},
{id:107,w:"ä½¿ã†",rd:"ã¤ã‹ã†",ro:"tsukau",m:"ä½¿ç”¨",pos:"å‹•è©I",cat:"verb2",ex:{ja:"ãƒ‘ã‚½ã‚³ãƒ³ã‚’ä½¿ã†ã€‚",rd:"ã±ãã“ã‚“ã‚’ã¤ã‹ã†ã€‚",zh:"ä½¿ç”¨é›»è…¦ã€‚"}},
{id:108,w:"å¾…ã¤",rd:"ã¾ã¤",ro:"matsu",m:"ç­‰å¾…",pos:"å‹•è©I",cat:"verb2",ex:{ja:"ã“ã“ã§å¾…ã¤ã€‚",rd:"ã“ã“ã§ã¾ã¤ã€‚",zh:"åœ¨é€™è£¡ç­‰ã€‚"}},
{id:109,w:"æŒã¤",rd:"ã‚‚ã¤",ro:"motsu",m:"æ‹¿;æŒæœ‰",pos:"å‹•è©I",cat:"verb2",ex:{ja:"è·ç‰©ã‚’æŒã¤ã€‚",rd:"ã«ã‚‚ã¤ã‚’ã‚‚ã¤ã€‚",zh:"æ‹¿è¡Œæã€‚"}},
{id:110,w:"çŸ¥ã‚‹",rd:"ã—ã‚‹",ro:"shiru",m:"çŸ¥é“",pos:"å‹•è©I",cat:"verb2",ex:{ja:"å½¼ã‚’çŸ¥ã£ã¦ã„ã‚‹ã€‚",rd:"ã‹ã‚Œã‚’ã—ã£ã¦ã„ã‚‹ã€‚",zh:"èªè­˜ä»–ã€‚"}},
{id:111,w:"ä½ã‚€",rd:"ã™ã‚€",ro:"sumu",m:"ä½",pos:"å‹•è©I",cat:"verb2",ex:{ja:"æ±äº¬ã«ä½ã‚€ã€‚",rd:"ã¨ã†ãã‚‡ã†ã«ã™ã‚€ã€‚",zh:"ä½åœ¨æ±äº¬ã€‚"}},
{id:112,w:"åƒã",rd:"ã¯ãŸã‚‰ã",ro:"hataraku",m:"å·¥ä½œ",pos:"å‹•è©I",cat:"verb2",ex:{ja:"ä¼šç¤¾ã§åƒãã€‚",rd:"ã‹ã„ã—ã‚ƒã§ã¯ãŸã‚‰ãã€‚",zh:"åœ¨å…¬å¸å·¥ä½œã€‚"}},
{id:113,w:"éŠã¶",rd:"ã‚ãã¶",ro:"asobu",m:"ç©",pos:"å‹•è©I",cat:"verb2",ex:{ja:"å‹é”ã¨éŠã¶ã€‚",rd:"ã¨ã‚‚ã ã¡ã¨ã‚ãã¶ã€‚",zh:"å’Œæœ‹å‹ç©ã€‚"}},
{id:114,w:"æ³³ã",rd:"ãŠã‚ˆã",ro:"oyogu",m:"æ¸¸æ³³",pos:"å‹•è©I",cat:"verb2",ex:{ja:"ãƒ—ãƒ¼ãƒ«ã§æ³³ãã€‚",rd:"ã·ãƒ¼ã‚‹ã§ãŠã‚ˆãã€‚",zh:"åœ¨æ¸¸æ³³æ± æ¸¸æ³³ã€‚"}},
{id:115,w:"èµ°ã‚‹",rd:"ã¯ã—ã‚‹",ro:"hashiru",m:"è·‘",pos:"å‹•è©I",cat:"verb2",ex:{ja:"æ¯æœèµ°ã‚‹ã€‚",rd:"ã¾ã„ã‚ã•ã¯ã—ã‚‹ã€‚",zh:"æ¯å¤©æ—©ä¸Šè·‘æ­¥ã€‚"}},
// ===== å‰¯è© 5 =====
{id:116,w:"ã¨ã¦ã‚‚",rd:"ã¨ã¦ã‚‚",ro:"totemo",m:"éå¸¸",pos:"å‰¯è©",cat:"adverb",ex:{ja:"ã¨ã¦ã‚‚ç¾å‘³ã—ã„ã€‚",rd:"ã¨ã¦ã‚‚ãŠã„ã—ã„ã€‚",zh:"éå¸¸å¥½åƒã€‚"}},
{id:117,w:"ã‚‚ã†",rd:"ã‚‚ã†",ro:"mou",m:"å·²ç¶“",pos:"å‰¯è©",cat:"adverb",ex:{ja:"ã‚‚ã†é£Ÿã¹ã¾ã—ãŸã€‚",rd:"ã‚‚ã†ãŸã¹ã¾ã—ãŸã€‚",zh:"å·²ç¶“åƒäº†ã€‚"}},
{id:118,w:"ã¾ã ",rd:"ã¾ã ",ro:"mada",m:"é‚„;å°šæœª",pos:"å‰¯è©",cat:"adverb",ex:{ja:"ã¾ã çµ‚ã‚ã£ã¦ã„ãªã„ã€‚",rd:"ã¾ã ãŠã‚ã£ã¦ã„ãªã„ã€‚",zh:"é‚„æ²’çµæŸã€‚"}},
{id:119,w:"ã„ã¤ã‚‚",rd:"ã„ã¤ã‚‚",ro:"itsumo",m:"ç¸½æ˜¯",pos:"å‰¯è©",cat:"adverb",ex:{ja:"ã„ã¤ã‚‚ç¬‘ã£ã¦ã„ã‚‹ã€‚",rd:"ã„ã¤ã‚‚ã‚ã‚‰ã£ã¦ã„ã‚‹ã€‚",zh:"ç¸½æ˜¯åœ¨ç¬‘ã€‚"}},
{id:120,w:"ãŸãã•ã‚“",rd:"ãŸãã•ã‚“",ro:"takusan",m:"å¾ˆå¤š",pos:"å‰¯è©",cat:"adverb",ex:{ja:"ãŸãã•ã‚“é£Ÿã¹ãŸã€‚",rd:"ãŸãã•ã‚“ãŸã¹ãŸã€‚",zh:"åƒäº†å¾ˆå¤šã€‚"}}
];

// ================================================================
// DATA: æ¯æ—¥ä¸€å¥ & å ´æ™¯å°è©± & é¼“å‹µèª
// ================================================================
const DAILY_SENTENCES=[
{ja:"ä¸€æœŸä¸€ä¼š",rd:"ã„ã¡ã”ã„ã¡ãˆ",zh:"ä¸€æœŸä¸€æœƒï¼ˆçæƒœæ¯æ¬¡ç›¸é‡ï¼‰",note:"èŒ¶é“ç²¾ç¥"},
{ja:"èŠ±ã‚ˆã‚Šå›£å­",rd:"ã¯ãªã‚ˆã‚Šã ã‚“ã”",zh:"æ¯”èµ·è³èŠ±æ›´æƒ³åƒç³°å­ï¼ˆå¯¦éš›æ¯”æµªæ¼«é‡è¦ï¼‰",note:"è«ºèª"},
{ja:"çŒ¿ã‚‚æœ¨ã‹ã‚‰è½ã¡ã‚‹",rd:"ã•ã‚‹ã‚‚ãã‹ã‚‰ãŠã¡ã‚‹",zh:"çŒ´å­ä¹Ÿæœƒå¾æ¨¹ä¸Šæ‰ä¸‹ä¾†ï¼ˆæ™ºè€…åƒæ…®å¿…æœ‰ä¸€å¤±ï¼‰",note:"è«ºèª"},
{ja:"ä¸ƒè»¢ã³å…«èµ·ã",rd:"ãªãªã“ã‚ã³ã‚„ãŠã",zh:"è·Œå€’ä¸ƒæ¬¡ç«™èµ·ä¾†å…«æ¬¡ï¼ˆæ°¸ä¸æ”¾æ£„ï¼‰",note:"äººç”Ÿå“²å­¸"},
{ja:"é›¨é™ã£ã¦åœ°å›ºã¾ã‚‹",rd:"ã‚ã‚ãµã£ã¦ã˜ã‹ãŸã¾ã‚‹",zh:"é›¨å¾Œåœ°æ›´å …å¯¦ï¼ˆç¶“æ­·å›°é›£å¾Œæ›´å …å¼·ï¼‰",note:"è«ºèª"},
{ja:"æ˜æ—¥ã¯æ˜æ—¥ã®é¢¨ãŒå¹ã",rd:"ã‚ã—ãŸã¯ã‚ã—ãŸã®ã‹ãœãŒãµã",zh:"æ˜å¤©è‡ªæœ‰æ˜å¤©çš„é¢¨ï¼ˆèˆ¹åˆ°æ©‹é ­è‡ªç„¶ç›´ï¼‰",note:"ç”Ÿæ´»æ™ºæ…§"},
{ja:"ç¬‘ã†é–€ã«ã¯ç¦æ¥ã‚‹",rd:"ã‚ã‚‰ã†ã‹ã©ã«ã¯ãµãããŸã‚‹",zh:"ç¬‘å£å¸¸é–‹ï¼Œç¦æ°£è‡ªä¾†",note:"è«ºèª"},
{ja:"å¡µã‚‚ç©ã‚‚ã‚Œã°å±±ã¨ãªã‚‹",rd:"ã¡ã‚Šã‚‚ã¤ã‚‚ã‚Œã°ã‚„ã¾ã¨ãªã‚‹",zh:"ç©å°‘æˆå¤šï¼ˆæ¯å¤©å­¸ä¸€é»ä¹Ÿå¾ˆå²å®³ï¼ï¼‰",note:"é¼“å‹µ"},
{ja:"çŸ³ã®ä¸Šã«ã‚‚ä¸‰å¹´",rd:"ã„ã—ã®ã†ãˆã«ã‚‚ã•ã‚“ã­ã‚“",zh:"åçŸ³é ­ä¸Šä¹Ÿè¦ä¸‰å¹´ï¼ˆå …æŒå°±æœƒæœ‰çµæœï¼‰",note:"æ¯…åŠ›"},
{ja:"äº•ã®ä¸­ã®è›™å¤§æµ·ã‚’çŸ¥ã‚‰ãš",rd:"ã„ã®ãªã‹ã®ã‹ã‚ãšãŸã„ã‹ã„ã‚’ã—ã‚‰ãš",zh:"äº•åº•ä¹‹è›™ä¸çŸ¥å¤§æµ·",note:"è¦–é‡"},
{ja:"æ¡ˆãšã‚‹ã‚ˆã‚Šç”£ã‚€ãŒæ˜“ã—",rd:"ã‚ã‚“ãšã‚‹ã‚ˆã‚Šã†ã‚€ãŒã‚„ã™ã—",zh:"èˆ‡å…¶æ“”å¿ƒä¸å¦‚è¡Œå‹•ï¼ˆåšäº†æ¯”æƒ³åƒä¸­ç°¡å–®ï¼‰",note:"è¡Œå‹•åŠ›"},
{ja:"ç¶™ç¶šã¯åŠ›ãªã‚Š",rd:"ã‘ã„ããã¯ã¡ã‹ã‚‰ãªã‚Š",zh:"æŒçºŒå°±æ˜¯åŠ›é‡",note:"å­¸ç¿’ç²¾ç¥"},
{ja:"åƒé‡Œã®é“ã‚‚ä¸€æ­©ã‹ã‚‰",rd:"ã›ã‚“ã‚Šã®ã¿ã¡ã‚‚ã„ã£ã½ã‹ã‚‰",zh:"åƒé‡Œä¹‹è¡Œå§‹æ–¼è¶³ä¸‹",note:"é¼“å‹µ"},
{ja:"ç¿’ã†ã‚ˆã‚Šæ…£ã‚Œã‚",rd:"ãªã‚‰ã†ã‚ˆã‚Šãªã‚Œã‚",zh:"èˆ‡å…¶å­¸ä¸å¦‚å¤šç·´ç¿’",note:"å­¸ç¿’æ–¹æ³•"},
{ja:"å¤±æ•—ã¯æˆåŠŸã®ã‚‚ã¨",rd:"ã—ã£ã±ã„ã¯ã›ã„ã“ã†ã®ã‚‚ã¨",zh:"å¤±æ•—ç‚ºæˆåŠŸä¹‹æ¯",note:"é¼“å‹µ"},
{ja:"æ€¥ãŒã°å›ã‚Œ",rd:"ã„ããŒã°ã¾ã‚ã‚Œ",zh:"æ¬²é€Ÿå‰‡ä¸é”",note:"æ™ºæ…§"},
{ja:"éƒ·ã«å…¥ã£ã¦ã¯éƒ·ã«å¾“ãˆ",rd:"ã”ã†ã«ã„ã£ã¦ã¯ã”ã†ã«ã—ãŸãŒãˆ",zh:"å…¥å¢ƒéš¨ä¿—",note:"æ–‡åŒ–"},
{ja:"æ™‚ã¯é‡‘ãªã‚Š",rd:"ã¨ãã¯ã‹ã­ãªã‚Š",zh:"æ™‚é–“å°±æ˜¯é‡‘éŒ¢",note:"åƒ¹å€¼è§€"},
{ja:"ç™¾èã¯ä¸€è¦‹ã«å¦‚ã‹ãš",rd:"ã²ã‚ƒãã¶ã‚“ã¯ã„ã£ã‘ã‚“ã«ã—ã‹ãš",zh:"ç™¾èä¸å¦‚ä¸€è¦‹",note:"ç¶“é©—"},
{ja:"é ‘å¼µã£ã¦ãã ã•ã„",rd:"ãŒã‚“ã°ã£ã¦ãã ã•ã„",zh:"è«‹åŠ æ²¹ï¼",note:"æ‡‰æ´"},
{ja:"ãŠç–²ã‚Œæ§˜ã§ã—ãŸ",rd:"ãŠã¤ã‹ã‚Œã•ã¾ã§ã—ãŸ",zh:"è¾›è‹¦äº†",note:"è·å ´ç”¨èª"},
{ja:"ã„ãŸã ãã¾ã™",rd:"ã„ãŸã ãã¾ã™",zh:"æˆ‘é–‹å‹•äº†ï¼ˆç”¨é¤å‰èªªï¼‰",note:"é£²é£Ÿç¦®å„€"},
{ja:"ã”ã¡ãã†ã•ã¾ã§ã—ãŸ",rd:"ã”ã¡ãã†ã•ã¾ã§ã—ãŸ",zh:"å¤šè¬æ¬¾å¾…ï¼ˆç”¨é¤å¾Œèªªï¼‰",note:"é£²é£Ÿç¦®å„€"},
{ja:"ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™",rd:"ã‚ˆã‚ã—ããŠã­ãŒã„ã—ã¾ã™",zh:"è«‹å¤šå¤šæŒ‡æ•™",note:"åˆæ¬¡è¦‹é¢"},
{ja:"æ°—ã‚’ã¤ã‘ã¦ã­",rd:"ãã‚’ã¤ã‘ã¦ã­",zh:"è·¯ä¸Šå°å¿ƒå–”",note:"é—œå¿ƒèª"},
{ja:"å¤§ä¸ˆå¤«ã§ã™ã‹",rd:"ã ã„ã˜ã‚‡ã†ã¶ã§ã™ã‹",zh:"ä½ é‚„å¥½å—ï¼Ÿ",note:"é—œå¿ƒèª"},
{ja:"ä¸€ç·’ã«é ‘å¼µã‚ã†",rd:"ã„ã£ã—ã‚‡ã«ãŒã‚“ã°ã‚ã†",zh:"ä¸€èµ·åŠ æ²¹å§ï¼",note:"é¼“å‹µ"},
{ja:"å¤¢ã‚’è¿½ã„ã‹ã‘ã‚ˆã†",rd:"ã‚†ã‚ã‚’ãŠã„ã‹ã‘ã‚ˆã†",zh:"å»è¿½é€å¤¢æƒ³å§",note:"å‹µå¿—"},
{ja:"ä»Šæ—¥ã‚‚ã„ã„ä¸€æ—¥ã‚’",rd:"ãã‚‡ã†ã‚‚ã„ã„ã„ã¡ã«ã¡ã‚’",zh:"ä»Šå¤©ä¹Ÿè¦æœ‰ç¾å¥½çš„ä¸€å¤©",note:"ç¥ç¦"},
{ja:"ã‚ã‚Šã®ã¾ã¾ã§",rd:"ã‚ã‚Šã®ã¾ã¾ã§",zh:"åšä½ è‡ªå·±å°±å¥½",note:"é¼“å‹µ"}
];

const SCENARIOS=[
{id:"konbini",title:"ğŸª ä¾¿åˆ©å•†åº—",desc:"åœ¨ä¾¿åˆ©å•†åº—è²·æ±è¥¿",dialogues:[
  {npc:"ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›ï¼",npc_zh:"æ­¡è¿å…‰è‡¨ï¼"},
  {prompt:"ä½ æƒ³è²·é£¯ç³°ï¼Œè©²æ€éº¼èªªï¼Ÿ",choices:[
    {ja:"ãŠã«ãã‚Šã‚’ä¸€ã¤ãã ã•ã„ã€‚",zh:"è«‹çµ¦æˆ‘ä¸€å€‹é£¯ç³°ã€‚",correct:true},
    {ja:"ãŠã«ãã‚ŠãŒã‚ã‚Šã¾ã™ã€‚",zh:"æœ‰é£¯ç³°ã€‚",correct:false},
    {ja:"ãŠã«ãã‚Šã¯ä½•ã§ã™ã‹ã€‚",zh:"é£¯ç³°æ˜¯ä»€éº¼ï¼Ÿ",correct:false}
  ]},
  {npc:"ã¯ã„ã€ç™¾å††ã§ã™ã€‚",npc_zh:"å¥½çš„ï¼Œä¸€ç™¾åœ“ã€‚"},
  {prompt:"ä»˜å®ŒéŒ¢å¾Œï¼Œåº—å“¡èªªã€Œã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€ï¼Œä½ è¦æ€éº¼å›æ‡‰ï¼Ÿ",choices:[
    {ja:"ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚",zh:"è¬è¬ã€‚",correct:true},
    {ja:"ã™ã¿ã¾ã›ã‚“ã€‚",zh:"ä¸å¥½æ„æ€ã€‚",correct:false},
    {ja:"ã•ã‚ˆã†ãªã‚‰ã€‚",zh:"å†è¦‹ã€‚",correct:false}
  ]}
]},
{id:"eki",title:"ğŸš‰ å•è·¯",desc:"åœ¨è»Šç«™å•è·¯",dialogues:[
  {prompt:"ä½ æƒ³å•è»Šç«™åœ¨å“ªè£¡ï¼Œè©²æ€éº¼èªªï¼Ÿ",choices:[
    {ja:"ã™ã¿ã¾ã›ã‚“ã€é§…ã¯ã©ã“ã§ã™ã‹ã€‚",zh:"ä¸å¥½æ„æ€ï¼Œè»Šç«™åœ¨å“ªè£¡ï¼Ÿ",correct:true},
    {ja:"é§…ã«è¡Œãã¾ã™ã€‚",zh:"æˆ‘å»è»Šç«™ã€‚",correct:false},
    {ja:"é§…ãŒå¥½ãã§ã™ã€‚",zh:"æˆ‘å–œæ­¡è»Šç«™ã€‚",correct:false}
  ]},
  {npc:"ã¾ã£ã™ãè¡Œã£ã¦ã€å³ã«æ›²ãŒã£ã¦ãã ã•ã„ã€‚",npc_zh:"ç›´èµ°ç„¶å¾Œå³è½‰ã€‚"},
  {prompt:"ä½ æƒ³è¡¨é”æ„Ÿè¬ï¼Œè©²æ€éº¼èªªï¼Ÿ",choices:[
    {ja:"ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚",zh:"éå¸¸æ„Ÿè¬ã€‚",correct:true},
    {ja:"ãŠé¡˜ã„ã—ã¾ã™ã€‚",zh:"æ‹œè¨—äº†ã€‚",correct:false},
    {ja:"ã¯ã„ã€ã‚ã‹ã‚Šã¾ã—ãŸã€‚",zh:"æ˜¯çš„ï¼Œæˆ‘çŸ¥é“äº†ã€‚",correct:false}
  ]}
]},
{id:"restaurant",title:"ğŸœ é¤å»³",desc:"åœ¨é¤å»³é»é¤",dialogues:[
  {npc:"ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›ã€‚ä½•åæ§˜ã§ã™ã‹ã€‚",npc_zh:"æ­¡è¿å…‰è‡¨ã€‚è«‹å•å¹¾ä½ï¼Ÿ"},
  {prompt:"ä½ æ˜¯ä¸€å€‹äººä¾†ç”¨é¤ï¼Œè©²æ€éº¼èªªï¼Ÿ",choices:[
    {ja:"ä¸€äººã§ã™ã€‚",zh:"ä¸€å€‹äººã€‚",correct:true},
    {ja:"ä¸€ã¤ãã ã•ã„ã€‚",zh:"è«‹çµ¦æˆ‘ä¸€å€‹ã€‚",correct:false},
    {ja:"å‹é”ã§ã™ã€‚",zh:"æ˜¯æœ‹å‹ã€‚",correct:false}
  ]},
  {npc:"ã“ã¡ã‚‰ã¸ã©ã†ãã€‚ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã™ã€‚",npc_zh:"é€™é‚Šè«‹ã€‚é€™æ˜¯èœå–®ã€‚"},
  {prompt:"ä½ çœ‹å®Œèœå–®æƒ³é»æ‹‰éºµï¼Œè©²æ€éº¼èªªï¼Ÿ",choices:[
    {ja:"ãƒ©ãƒ¼ãƒ¡ãƒ³ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚",zh:"éº»ç…©çµ¦æˆ‘æ‹‰éºµã€‚",correct:true},
    {ja:"ãƒ©ãƒ¼ãƒ¡ãƒ³ãŒã‚ã‚Šã¾ã™ã€‚",zh:"æœ‰æ‹‰éºµã€‚",correct:false},
    {ja:"ãƒ©ãƒ¼ãƒ¡ãƒ³ã¯ç¾å‘³ã—ã„ã§ã™ã€‚",zh:"æ‹‰éºµå¾ˆå¥½åƒã€‚",correct:false}
  ]}
]},
{id:"jikoshoukai",title:"ğŸ™‹ è‡ªæˆ‘ä»‹ç´¹",desc:"ç¬¬ä¸€æ¬¡è¦‹é¢è‡ªæˆ‘ä»‹ç´¹",dialogues:[
  {npc:"ã¯ã˜ã‚ã¾ã—ã¦ã€‚ç”°ä¸­ã§ã™ã€‚",npc_zh:"åˆæ¬¡è¦‹é¢ã€‚æˆ‘æ˜¯ç”°ä¸­ã€‚"},
  {prompt:"ä½ æƒ³è‡ªæˆ‘ä»‹ç´¹ï¼Œè©²æ€éº¼èªªï¼Ÿ",choices:[
    {ja:"ã¯ã˜ã‚ã¾ã—ã¦ã€‚ç§ã¯â—‹â—‹ã§ã™ã€‚ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚",zh:"åˆæ¬¡è¦‹é¢ã€‚æˆ‘æ˜¯â—‹â—‹ã€‚è«‹å¤šå¤šæŒ‡æ•™ã€‚",correct:true},
    {ja:"ã“ã‚“ã«ã¡ã¯ã€‚å…ƒæ°—ã§ã™ã‹ã€‚",zh:"ä½ å¥½ã€‚ä½ å¥½å—ï¼Ÿ",correct:false},
    {ja:"ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚",zh:"éå¸¸æ„Ÿè¬ã€‚",correct:false}
  ]},
  {npc:"ã©ã¡ã‚‰ã‹ã‚‰æ¥ã¾ã—ãŸã‹ã€‚",npc_zh:"ä½ å¾å“ªè£¡ä¾†çš„ï¼Ÿ"},
  {prompt:"ä½ æƒ³èªªä½ ä¾†è‡ªå°ç£ï¼Œè©²æ€éº¼èªªï¼Ÿ",choices:[
    {ja:"å°æ¹¾ã‹ã‚‰æ¥ã¾ã—ãŸã€‚",zh:"æˆ‘å¾å°ç£ä¾†çš„ã€‚",correct:true},
    {ja:"å°æ¹¾ã«è¡Œãã¾ã™ã€‚",zh:"æˆ‘è¦å»å°ç£ã€‚",correct:false},
    {ja:"å°æ¹¾ãŒå¥½ãã§ã™ã€‚",zh:"æˆ‘å–œæ­¡å°ç£ã€‚",correct:false}
  ]}
]}
];

const ENCOURAGE={
correct:["ã™ã”ã„ï¼(å¥½å²å®³ï¼)","æ­£è§£ï¼ã‚ˆãã§ãã¾ã—ãŸï¼","å®Œç’§ï¼(å®Œç¾ï¼)","ãã®èª¿å­ï¼(å°±æ˜¯é€™æ¨£ï¼)","ç´ æ™´ã‚‰ã—ã„ï¼(å¤ªæ£’äº†ï¼)","å¤©æ‰ã ï¼(ä½ æ˜¯å¤©æ‰ï¼)","ã‚„ã£ãŸï¼(å¤ªå¥½äº†ï¼)","ã•ã™ãŒï¼(ä¸æ„§æ˜¯ä½ ï¼)"],
wrong:["å¤§ä¸ˆå¤«ï¼ã‚‚ã†ä¸€å›ï¼(æ²’é—œä¿‚ï¼)","æƒœã—ã„ï¼(å¥½å¯æƒœï¼)","é–“é•ã„ã¯å­¦ã³ã®å§‹ã¾ã‚Š(çŠ¯éŒ¯æ˜¯å­¸ç¿’çš„é–‹å§‹)","ãƒ‰ãƒ³ãƒã‚¤ï¼(Don't mind!)","æ¬¡ã¯çµ¶å¯¾ã§ãã‚‹ï¼(ä¸‹æ¬¡ä¸€å®šè¡Œï¼)","ç„¦ã‚‰ãªãã¦ã„ã„ã‚ˆ(ä¸ç”¨æ€¥å–”)","ä¸€æ­©ãšã¤è¡Œã“ã†(ä¸€æ­¥æ­¥ä¾†)"],
completion:["ä»Šæ—¥ã‚‚ãŠç–²ã‚Œæ§˜ï¼(ä»Šå¤©ä¹Ÿè¾›è‹¦äº†ï¼)","æ¯æ—¥ã®åŠªåŠ›ãŒå¤§åˆ‡ï¼(æ¯å¤©çš„åŠªåŠ›éƒ½å¾ˆé‡è¦ï¼)","ä¸€æ­©ä¸€æ­©ã€å‰é€²ã—ã‚ˆã†ï¼(ä¸€æ­¥ä¸€æ­¥å‘å‰ï¼)","ç¶™ç¶šã¯åŠ›ãªã‚Šï¼(æŒçºŒå°±æ˜¯åŠ›é‡ï¼)","ç´ æ•µãªä¸€æ—¥ã§ã—ãŸï¼(ç¾å¥½çš„ä¸€å¤©ï¼)"],
streak:{3:"3æ—¥é€£ç¶šï¼ã„ã„æ„Ÿã˜ï¼ğŸ”¥",7:"ä¸€é€±é–“é€£ç¶šï¼ã™ã”ã„ï¼â­",14:"äºŒé€±é–“ï¼æœ¬å½“ã«å‰ã„ï¼ğŸ’ª",30:"ä¸€ãƒ¶æœˆï¼ã‚ãªãŸã¯æœ¬ç‰©ã ï¼ğŸ‘‘",60:"äºŒãƒ¶æœˆï¼ä¼èª¬ã«ãªã‚Šã¤ã¤ã‚ã‚‹ï¼ğŸ†",100:"ç™¾æ—¥é€£ç¶šï¼ã¾ã•ã«é”äººï¼ğŸ‰"},
comeback:["ãŠã‹ãˆã‚Šï¼ã¾ãŸä¼šãˆã¦å¬‰ã—ã„ï¼ğŸ¦Š","ä¹…ã—ã¶ã‚Šï¼ä¸€ç·’ã«é ‘å¼µã‚ã†ï¼","æˆ»ã£ã¦ãã¦ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†ï¼ğŸ’›"]
};

const MASCOT_STATES={
default:"ğŸ¦Š",happy:"ğŸ˜¸",excited:"ğŸ‰",thinking:"ğŸ¤”",sleeping:"ğŸ˜´",cheering:"ğŸ’ª",studying:"ğŸ“–",celebrating:"ğŸ¥³",worried:"ğŸ˜Ÿ",proud:"ğŸŒŸ"
};

// ================================================================
// CORE: FSRS-4.5 Spaced Repetition Engine
// ================================================================
function today(){return new Date().toISOString().split("T")[0]}
function yesterday(){const d=new Date();d.setDate(d.getDate()-1);return d.toISOString().split("T")[0]}
function daysBetween(a,b){return Math.round((new Date(b)-new Date(a))/86400000)}
function shuffle(a){const b=[...a];for(let i=b.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[b[i],b[j]]=[b[j],b[i]]}return b}
function pick(a){return a[Math.floor(Math.random()*a.length)]}

const FSRS={
w:[0.40255,1.18385,3.173,15.69105,7.1949,0.5345,1.4604,0.0046,1.54575,0.1192,1.01925,1.9395,0.11,0.29605,2.2698,0.2315,2.9898,0.51655,0.6621],
DECAY:-0.5,
get FACTOR(){return Math.pow(0.9,1/this.DECAY)-1},
requestRetention:0.9,
maximumInterval:36500,
forgettingCurve(elapsed,s){return Math.pow(1+this.FACTOR*elapsed/s,this.DECAY)},
initStability(r){return Math.max(this.w[r-1],0.1)},
initDifficulty(r){return this.constrainD(this.w[4]-Math.exp(this.w[5]*(r-1))+1)},
constrainD(d){return Math.min(Math.max(d,1),10)},
nextDifficulty(d,r){
  const dd=-this.w[6]*(r-3);const ld=dd*(10-d)/9;const nd=d+ld;
  return this.constrainD(this.w[7]*this.initDifficulty(4)+(1-this.w[7])*nd)},
nextRecallStability(d,s,r,rating){
  const hp=rating===2?this.w[15]:1;const eb=rating===4?this.w[16]:1;
  return s*(1+Math.exp(this.w[8])*(11-d)*Math.pow(s,-this.w[9])*(Math.exp((1-r)*this.w[10])-1)*hp*eb)},
nextForgetStability(d,s,r){
  return Math.min(this.w[11]*Math.pow(d,-this.w[12])*(Math.pow(s+1,this.w[13])-1)*Math.exp((1-r)*this.w[14]),s/Math.exp(this.w[17]*this.w[18]))},
nextInterval(s){
  const iv=s/this.FACTOR*(Math.pow(this.requestRetention,1/this.DECAY)-1);
  return Math.min(Math.max(Math.round(iv),1),this.maximumInterval)},
newCard(){return{difficulty:0,stability:0,reps:0,nextReview:today(),lastReview:null,totalReviews:0,correctCount:0,wrongCount:0}},
review(card,rating){
  const now=today();const elapsed=card.lastReview?Math.max(0,daysBetween(card.lastReview,now)):0;
  let d,s;
  if(card.reps===0){d=this.initDifficulty(rating);s=this.initStability(rating)}
  else{d=this.nextDifficulty(card.difficulty,rating);
    const r=this.forgettingCurve(elapsed,card.stability);
    s=rating>=2?this.nextRecallStability(d,card.stability,r,rating):this.nextForgetStability(d,card.stability,r)}
  const iv=this.nextInterval(s);const nx=new Date();nx.setDate(nx.getDate()+iv);
  return{difficulty:Math.round(d*100)/100,stability:Math.round(s*100)/100,
    reps:rating>=2?card.reps+1:0,interval:iv,nextReview:nx.toISOString().split("T")[0],
    lastReview:now,totalReviews:(card.totalReviews||0)+1,
    correctCount:(card.correctCount||0)+(rating>=2?1:0),
    wrongCount:(card.wrongCount||0)+(rating<2?1:0)}},
getDue(maxReviews){const d=Store.load();const t=today();const due=[];
  for(const[id,p]of Object.entries(d.vocab)){if(p.nextReview<=t)due.push({id:+id,...p})}
  due.sort((a,b)=>a.nextReview.localeCompare(b.nextReview));
  // Smart review cap - prevent burnout (Anki's #1 problem)
  const cap=maxReviews||d.settings.reviewCap||50;
  return due.slice(0,cap)},
getNew(limit=5){const d=Store.load();const learned=new Set(Object.keys(d.vocab));
  return VOCAB.filter(v=>!learned.has(String(v.id))).slice(0,limit)}
};

// ================================================================
// CORE: Achievements (expanded)
// ================================================================
const Achievements={
list:[
  {id:'first_word',icon:'ğŸŒ±',name:'åˆå¿ƒè€…',desc:'å­¸æœƒç¬¬ä¸€å€‹å–®å­—',check:d=>Object.keys(d.vocab).length>=1},
  {id:'ten_words',icon:'ğŸ“š',name:'å°æ›¸èŸ²',desc:'å­¸æœƒ10å€‹å–®å­—',check:d=>Object.keys(d.vocab).length>=10},
  {id:'fifty_words',icon:'ğŸ“',name:'å‹¤å­¸è€…',desc:'å­¸æœƒ50å€‹å–®å­—',check:d=>Object.keys(d.vocab).length>=50},
  {id:'hundred_words',icon:'ğŸ“–',name:'ç™¾è©æ–¬',desc:'å­¸æœƒ100å€‹å–®å­—',check:d=>Object.keys(d.vocab).length>=100},
  {id:'all_words',icon:'ğŸ‘‘',name:'å–®å­—ç‹',desc:'å­¸æœƒå…¨éƒ¨å–®å­—',check:d=>Object.keys(d.vocab).length>=VOCAB.length},
  {id:'streak3',icon:'ğŸ”¥',name:'ä¸‰æ—¥åŠä¸»çªç ´',desc:'é€£çºŒå­¸ç¿’3å¤©',check:d=>d.streak.current>=3},
  {id:'streak7',icon:'â­',name:'ä¸€é€±é”äºº',desc:'é€£çºŒå­¸ç¿’7å¤©',check:d=>d.streak.current>=7},
  {id:'streak30',icon:'ğŸ’',name:'æœˆé–“å‹‡è€…',desc:'é€£çºŒå­¸ç¿’30å¤©',check:d=>d.streak.current>=30},
  {id:'streak100',icon:'ğŸ‰',name:'ç™¾æ—¥å‚³èªª',desc:'é€£çºŒå­¸ç¿’100å¤©',check:d=>d.streak.current>=100},
  {id:'perfect_quiz',icon:'ğŸ’¯',name:'å®Œç¾ç­”é¡Œ',desc:'æ¸¬é©—å¾—åˆ°100%',check:d=>d.quizHistory.some(q=>q.correctAnswers===q.totalQuestions&&q.totalQuestions>=5)},
  {id:'all_kana',icon:'ğŸ¯',name:'äº”åéŸ³é”äºº',desc:'æŒæ¡å…¨éƒ¨å‡å',check:d=>Object.values(d.gojuon).filter(g=>g.mastered).length>=ALL_KANA.length},
  {id:'night_owl',icon:'ğŸ¦‰',name:'å¤œè²“å­¸éœ¸',desc:'æ™šä¸Š11é»å¾Œå­¸ç¿’',check:()=>new Date().getHours()>=23},
  {id:'early_bird',icon:'ğŸ¦',name:'æ—©èµ·é³¥',desc:'æ—©ä¸Š6é»å‰å­¸ç¿’',check:()=>new Date().getHours()<6},
  {id:'quiz_master',icon:'ğŸ†',name:'æ¸¬é©—å¤§å¸«',desc:'å®Œæˆ20æ¬¡æ¸¬é©—',check:d=>d.quizHistory.length>=20},
  {id:'scenario_first',icon:'ğŸ—£ï¸',name:'å°è©±æ–°æ‰‹',desc:'å®Œæˆç¬¬ä¸€å€‹å ´æ™¯å°è©±',check:d=>(d.scenariosDone||[]).length>=1},
  {id:'scenario_all',icon:'ğŸŒ',name:'å¯¦æˆ°é”äºº',desc:'å®Œæˆæ‰€æœ‰å ´æ™¯å°è©±',check:d=>(d.scenariosDone||[]).length>=SCENARIOS.length},
],
check(d){
  if(!d.achievements)d.achievements=[];
  const newOnes=[];
  this.list.forEach(a=>{if(!d.achievements.includes(a.id)&&a.check(d)){d.achievements.push(a.id);newOnes.push(a)}});
  if(newOnes.length){Store.save();newOnes.forEach((a,i)=>setTimeout(()=>this.showToast(a),i*2500))}
  return newOnes},
showToast(a){
  const t=document.getElementById('ach-toast');
  t.querySelector('.toast-icon').textContent=a.icon;
  t.querySelector('.toast-text').textContent=`è§£é–æˆå°±ï¼š${a.name}ï¼`;
  t.classList.add('show');
  if(navigator.vibrate)navigator.vibrate([100,50,100]);
  setTimeout(()=>t.classList.remove('show'),2200)}
};

// ================================================================
// CORE: Confetti (session completion celebration)
// ================================================================
function showConfetti(){
  const box=document.getElementById('confetti-box');
  const colors=['#FF6B6B','#FFD93D','#6BCB77','#4D96FF','#FF6FB5','#C780FF'];
  let html='';
  for(let i=0;i<40;i++){
    const c=colors[i%colors.length];const l=Math.random()*100;const d=Math.random()*1+0.5;
    const sz=Math.random()*8+6;const rot=Math.random()*360;
    html+=`<div class="confetti-piece" style="left:${l}%;animation-delay:${d*0.3}s;animation-duration:${d+1}s;width:${sz}px;height:${sz}px;background:${c};transform:rotate(${rot}deg);border-radius:${Math.random()>0.5?'50%':'2px'}"></div>`;
  }
  box.innerHTML=html;setTimeout(()=>box.innerHTML='',3000);
}

// ================================================================
// CORE: StorageManager (with migration + streak freeze + onboarding)
// ================================================================
const Store={
KEY:"nihongo_app_v2",
OLD_KEY:"nihongo_app_v1",
_cache:null,_timer:null,
load(){
  if(this._cache)return this._cache;
  try{
    let r=localStorage.getItem(this.KEY);
    if(r){this._cache=JSON.parse(r);this._ensureFields();if(this._checkToday())this.save();return this._cache}
    r=localStorage.getItem(this.OLD_KEY);
    if(r){this._cache=this._migrate(JSON.parse(r));this.save();return this._cache}
  }catch(e){}
  this._cache=this._default();this.save();return this._cache},
save(d){if(d)this._cache=d;if(!this._cache)return;this._cache.lastActiveAt=new Date().toISOString();
  try{localStorage.setItem(this.KEY,JSON.stringify(this._cache))}catch(e){
    if(this._cache.quizHistory.length>30)this._cache.quizHistory=this._cache.quizHistory.slice(-30);
    localStorage.setItem(this.KEY,JSON.stringify(this._cache))}},
debounce(){clearTimeout(this._timer);this._timer=setTimeout(()=>this.save(),300)},
_ensureFields(){
  const d=this._cache;
  if(!d.streakFreezes)d.streakFreezes=2;
  if(!d.onboardingDone)d.onboardingDone=false;
  if(!d.scenariosDone)d.scenariosDone=[];
  if(!d.settings.reviewCap)d.settings.reviewCap=50;
  if(!d.errorBook)d.errorBook=[];
  if(!d.achievements)d.achievements=[];
},
_checkToday(){const d=this._cache;const t=today();if(d.todayStats.date!==t){d.todayStats={date:t,newWordsLearned:0,wordsReviewed:0,gojuonPracticed:0,quizzesTaken:0,correctRate:0,timeSpent:0};return true}return false},
_migrate(old){
  const d=this._default();
  d.gojuon=old.gojuon||{};
  d.quizHistory=old.quizHistory||[];
  d.streak=old.streak||d.streak;
  d.settings={...d.settings,...(old.settings||{})};
  d.achievements=old.achievements||[];
  d.onboardingDone=true; // skip onboarding for migrated users
  if(old.vocab){
    for(const[id,card]of Object.entries(old.vocab)){
      if(card.easeFactor!==undefined){
        d.vocab[id]={difficulty:Math.round((6-(card.easeFactor||2.5))*2*100)/100,
          stability:card.interval||1,reps:card.repetitions||0,
          nextReview:card.nextReview||today(),lastReview:card.lastReview||null,
          totalReviews:card.totalReviews||0,correctCount:card.correctCount||0,wrongCount:card.wrongCount||0};
      }else{d.vocab[id]=card}
    }
  }
  return d},
_default(){return{version:"3.0.0",createdAt:new Date().toISOString(),lastActiveAt:new Date().toISOString(),
  settings:{theme:"auto",gojuonMode:"hiragana",dailyGoal:15,soundEnabled:true,reviewCap:50},
  streak:{current:0,longest:0,lastStudyDate:null,history:[]},
  streakFreezes:2,onboardingDone:false,scenariosDone:[],
  gojuon:{},vocab:{},quizHistory:[],achievements:[],errorBook:[],
  todayStats:{date:today(),newWordsLearned:0,wordsReviewed:0,gojuonPracticed:0,quizzesTaken:0,correctRate:0,timeSpent:0}}},
updateStreak(){const d=this.load();const t=today();const y=yesterday();
  if(d.streak.lastStudyDate===t)return;
  if(d.streak.lastStudyDate===y){d.streak.current++}
  else if(d.streak.lastStudyDate!==t){
    // Check if we can use a streak freeze
    const missed=d.streak.lastStudyDate?daysBetween(d.streak.lastStudyDate,t):999;
    if(missed===2&&d.streakFreezes>0&&d.streak.current>0){
      d.streakFreezes--;d.streak.current++;
      // Show streak saved notification
      setTimeout(()=>{const t=document.getElementById('ach-toast');
        t.querySelector('.toast-icon').textContent='ğŸ§Š';
        t.querySelector('.toast-text').textContent=`å…æ­»é‡‘ç‰Œæ•‘å›äº†ä½ çš„é€£çºŒè¨˜éŒ„ï¼(å‰©${d.streakFreezes}å€‹)`;
        t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2500)},500);
    }else{d.streak.current=1}
  }
  d.streak.longest=Math.max(d.streak.longest,d.streak.current);d.streak.lastStudyDate=t;
  const h=d.streak.history;const last=h[h.length-1];if(last&&last.date===t){last.count++}else{h.push({date:t,count:1});if(h.length>60)h.shift()}
  this.save();Achievements.check(d)},
addError(vocabId,userAns,correctAns){
  const d=this.load();if(!d.errorBook)d.errorBook=[];
  const exist=d.errorBook.find(e=>e.vocabId===vocabId);
  if(exist){exist.count++;exist.lastWrong=today()}
  else{d.errorBook.push({vocabId,count:1,lastWrong:today(),userAns,correctAns})}
  if(d.errorBook.length>200)d.errorBook=d.errorBook.slice(-200);
  this.save()},
exportData(){const b=new Blob([JSON.stringify(this.load(),null,2)],{type:"application/json"});
  const a=document.createElement("a");a.href=URL.createObjectURL(b);a.download="nihongo_backup_"+today()+".json";a.click();URL.revokeObjectURL(a.href)},
importData(json){try{const d=JSON.parse(json);if(d.version){this._cache=d;this._ensureFields();this.save();return true}}catch(e){}return false},
reset(){this._cache=this._default();this.save()}
};

// ================================================================
// CORE: TTS Engine
// ================================================================
const TTS={
_audio:null,_unlocked:false,
get enabled(){return Store.load().settings.soundEnabled},
init(){
  this._audio=new Audio();this._audio.volume=1;
  const unlock=()=>{if(this._unlocked)return;
    this._audio.play().catch(()=>{});this._audio.pause();this._audio.currentTime=0;this._unlocked=true};
  document.addEventListener("touchstart",unlock,{passive:true});
  document.addEventListener("click",unlock)},
speak(text){
  if(!this.enabled||!text)return;
  try{if(this._audio){this._audio.pause();this._audio.currentTime=0}
    const url="https://translate.google.com/translate_tts?ie=UTF-8&client=tw-ob&tl=ja&q="+encodeURIComponent(text);
    this._audio.src=url;this._audio.play().catch(e=>{this._fallback(text)})
  }catch(e){this._fallback(text)}},
_fallback(text){if(!window.speechSynthesis)return;speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance(text);u.lang="ja-JP";u.rate=0.8;u.volume=1;speechSynthesis.speak(u)},
playBtn(text,el){if(!this.enabled)return;this.speak(text);
  if(el){el.classList.add("playing");setTimeout(()=>el.classList.remove("playing"),800)}},
speakerSVG:'<svg viewBox="0 0 24 24"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 010 7.07"/><path d="M19.07 4.93a10 10 0 010 14.14"/></svg>',
speakerSVGsm:'<svg viewBox="0 0 24 24"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 010 7.07"/></svg>',
btn(text,sm){return`<button class="sound-btn${sm?" sound-btn-sm":""}" onclick="event.stopPropagation();TTS.playBtn('${text.replace(/'/g,"\\'")}',this)">${sm?this.speakerSVGsm:this.speakerSVG}</button>`}
};

// ================================================================
// CORE: Theme & Router
// ================================================================
const Theme={
init(){const s=Store.load().settings.theme;
  if(s==="auto"){const m=window.matchMedia("(prefers-color-scheme:dark)");this.apply(m.matches?"dark":"light");
    m.addEventListener("change",e=>{if(Store.load().settings.theme==="auto")this.apply(e.matches?"dark":"light")})}
  else this.apply(s)},
apply(t){document.documentElement.setAttribute("data-theme",t);
  const m=document.querySelector('meta[name="theme-color"]');if(m)m.content=t==="dark"?"#000000":"#F7F6F3"},
set(t){const d=Store.load();d.settings.theme=t;Store.save();if(t==="auto"){const m=window.matchMedia("(prefers-color-scheme:dark)");this.apply(m.matches?"dark":"light")}else this.apply(t)}
};

const Router={
current:"home",
pages:["home","gojuon","vocab","quiz","settings"],
init(){document.getElementById("bottom-nav").addEventListener("click",e=>{
  const item=e.target.closest(".nav-item");if(!item)return;const p=item.dataset.page;if(p)this.go(p)})},
go(name){if(name===this.current||!this.pages.includes(name))return;
  const cur=document.getElementById("page-"+this.current);const tgt=document.getElementById("page-"+name);
  cur.classList.remove("active");setTimeout(()=>{tgt.classList.add("active");this.current=name;
    document.querySelectorAll(".nav-item").forEach(n=>n.classList.toggle("active",n.dataset.page===name));
    this._load(name)},50)},
_load(n){switch(n){case"home":Home.render();break;case"gojuon":Gojuon.render();break;
  case"vocab":VocabMod.init();break;case"quiz":Quiz.init();break;case"settings":Settings.render();break}}
};

const Swipe={
attach(el,opts){
  let sx,sy,dx,dy;
  el.addEventListener('touchstart',e=>{sx=e.touches[0].clientX;sy=e.touches[0].clientY;dx=0;dy=0},{passive:true});
  el.addEventListener('touchmove',e=>{dx=e.touches[0].clientX-sx;dy=e.touches[0].clientY-sy},{passive:true});
  el.addEventListener('touchend',()=>{
    const adx=Math.abs(dx),ady=Math.abs(dy);
    if(adx<40&&ady<40)return;
    if(adx>ady){if(dx>0&&opts.right)opts.right();else if(dx<0&&opts.left)opts.left()}
    else{if(dy<0&&opts.up)opts.up();else if(dy>0&&opts.down)opts.down()}
  },{passive:true})}
};

// ================================================================
// MODULE: Onboarding (First-time user experience)
// ================================================================
const Onboarding={
steps:[
  {mascot:"ğŸ¦Š",title:"ã‚ˆã†ã“ãï¼æ­¡è¿ï¼",desc:"æˆ‘æ˜¯å°ç‹ï¼Œä½ çš„æ—¥èªå­¸ç¿’å¤¥ä¼´ã€‚æˆ‘æœƒé™ªä½ ä¸€èµ·å­¸ç¿’ï¼Œä¸ç”¨æ“”å¿ƒï¼Œæˆ‘å€‘æ…¢æ…¢ä¾†ï¼",btn:"èªè­˜ä½ å¾ˆé«˜èˆˆï¼"},
  {mascot:"ğŸ“š",title:"æ¯å¤© 5 åˆ†é˜å°±å¥½",desc:"ä¸ç”¨ä¸€æ¬¡å­¸å¾ˆå¤šã€‚æ¯å¤©èŠ± 5 åˆ†é˜ï¼Œç”¨ç§‘å­¸çš„é–“éš”é‡è¤‡æ³•ï¼Œæ¯”è‹¦è®€ 1 å°æ™‚æ›´æœ‰æ•ˆï¼",btn:"è½èµ·ä¾†ä¸éŒ¯"},
  {mascot:"ğŸ¯",title:"æº–å‚™å¥½äº†å—ï¼Ÿ",desc:"å¾äº”åéŸ³é–‹å§‹ï¼Œåˆ° 120 å€‹ N5 å–®å­—ï¼Œå†åˆ°çœŸå¯¦å ´æ™¯å°è©±ã€‚ä½ çš„æ—¥èªå†’éšªï¼Œç¾åœ¨é–‹å§‹ï¼",btn:"é–‹å§‹å­¸ç¿’ï¼ğŸš€"}
],
step:0,
show(){
  const d=Store.load();
  if(d.onboardingDone)return;
  this.step=0;
  const el=document.getElementById('onboarding');
  el.style.display='flex';
  this.render()},
render(){
  const s=this.steps[this.step];
  document.getElementById('onboard-mascot').textContent=s.mascot;
  document.getElementById('onboard-title').textContent=s.title;
  document.getElementById('onboard-desc').textContent=s.desc;
  document.getElementById('onboard-btn').textContent=s.btn;
  const dots=document.getElementById('onboard-dots');
  dots.innerHTML=this.steps.map((_,i)=>`<div class="onboard-dot${i===this.step?' active':''}"></div>`).join('');
},
next(){
  this.step++;
  if(this.step>=this.steps.length){
    const d=Store.load();d.onboardingDone=true;Store.save();
    const el=document.getElementById('onboarding');
    el.classList.add('hiding');
    setTimeout(()=>{el.style.display='none';el.classList.remove('hiding')},500);
    return;
  }
  this.render();
}
};

// ================================================================
// MODULE: Session Ritual (Headspace-inspired)
// ================================================================
const SessionRitual={
show(type,callback){
  const el=document.getElementById('session-start');
  const msg=document.getElementById('session-msg');
  const sub=document.getElementById('session-sub');
  const h=new Date().getHours();
  const d=Store.load();
  const due=FSRS.getDue().length;
  const greet=h<6?"å¤œæ·±äº†ï¼Œè¾›è‹¦ä½ äº† ğŸŒ™":h<12?"ãŠã¯ã‚ˆã†ï¼æ–°çš„ä¸€å¤© â˜€ï¸":h<18?"åˆå¾Œã®å­¦ç¿’ã‚¿ã‚¤ãƒ  ğŸµ":"æ™šä¸Šå¥½ï¼Œæ”¾é¬†å­¸ç¿’ ğŸŒ‡";
  msg.textContent=greet;
  if(type==='vocab'){
    sub.textContent=due>0?`ä»Šå¤©æœ‰ ${due} å€‹å–®å­—ç­‰ä½ è¤‡ç¿’`:'æº–å‚™å­¸ç¿’æ–°å–®å­—';
  }else if(type==='quiz'){
    sub.textContent='æ·±å‘¼å¸...é›†ä¸­æ³¨æ„åŠ›';
  }else{
    sub.textContent='è®“æˆ‘å€‘é–‹å§‹å§';
  }
  el.classList.add('show');
  setTimeout(()=>{el.classList.remove('show');if(callback)callback()},1800);
}
};

// ================================================================
// MODULE: Home Dashboard (with Daily Sentence, Memory Map, Mascot)
// ================================================================
const Home={
render(){
  const d=Store.load();const h=new Date().getHours();
  const gr=h<6?"å¤œæ›´ã‹ã—ã•ã‚“ï¼ğŸŒ™":h<12?"ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ â˜€ï¸":h<18?"ã“ã‚“ã«ã¡ã¯ ğŸŒ¸":"ã“ã‚“ã°ã‚“ã¯ ğŸŒ™";
  const due=FSRS.getDue().length;const nw=FSRS.getNew(d.settings.dailyGoal).length;
  const learned=Object.keys(d.vocab).length;const total=VOCAB.length;
  const mastered=Object.values(d.vocab).filter(v=>v.reps>=3&&v.difficulty<5).length;
  const rate=learned>0?Math.round(mastered/learned*100):0;
  const ts=d.todayStats;const prog=ts.wordsReviewed+ts.newWordsLearned;
  const goal=d.settings.dailyGoal;const pct=Math.min(100,Math.round(prog/goal*100));
  const hist=d.streak.history.slice(-7);while(hist.length<7)hist.unshift({date:"",count:0});
  const maxC=Math.max(...hist.map(h=>h.count),1);
  const days=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"];
  let streakMsg="";
  for(const[k,v]of Object.entries(ENCOURAGE.streak).reverse()){if(d.streak.current>=+k){streakMsg=v;break}}
  // Mascot state based on user status
  const mascotState=pct>=100?MASCOT_STATES.celebrating:d.streak.current>=7?MASCOT_STATES.proud:
    prog>0?MASCOT_STATES.happy:h>=23?MASCOT_STATES.sleeping:MASCOT_STATES.default;
  // Daily sentence
  const dayOfYear=Math.floor((Date.now()-new Date(new Date().getFullYear(),0,0))/86400000);
  const ds=DAILY_SENTENCES[dayOfYear%DAILY_SENTENCES.length];
  // Error book count
  const errCount=(d.errorBook||[]).length;
  // Comeback message
  let comebackMsg='';
  if(d.streak.lastStudyDate&&d.streak.lastStudyDate!==today()){
    const missed=daysBetween(d.streak.lastStudyDate,today());
    if(missed>=3)comebackMsg=pick(ENCOURAGE.comeback);
  }
  // Streak freeze info
  const freezeInfo=d.streakFreezes>0?`<span class="streak-freeze-badge">ğŸ§Š å…æ­»é‡‘ç‰Œ Ã—${d.streakFreezes}</span>`:'';

  document.getElementById("home-content").innerHTML=`
    <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:4px">
      <div>
        <div class="greeting">${gr}</div>
        <div class="greeting-sub">${d.streak.current>0?`é€£çºŒå­¸ç¿’ç¬¬ ${d.streak.current} å¤© ğŸ”¥ ${freezeInfo}`:"é–‹å§‹ä½ çš„æ—¥èªå­¸ç¿’ä¹‹æ—…å§ï¼"}</div>
      </div>
      <div class="mascot mascot-md anim-float">${mascotState}</div>
    </div>
    ${comebackMsg?`<div class="card" style="margin-bottom:12px;text-align:center;padding:16px">
      <div style="font-size:24px;margin-bottom:8px">ğŸ¦Š</div>
      <div style="font-size:15px;font-weight:600">${comebackMsg}</div>
    </div>`:''}
    ${streakMsg?`<div style="background:var(--accent-warning);color:#fff;padding:8px 12px;border-radius:var(--radius-sm);font-size:13px;margin-bottom:12px;text-align:center">${streakMsg}</div>`:""}
    <div class="daily-sentence" onclick="TTS.speak('${ds.ja.replace(/'/g,"\\'")}')">
      <div class="ds-label">ğŸ“ ä»Šæ—¥ä¸€å¥ Â· ${ds.note}</div>
      <div class="ds-ja">${ds.ja}</div>
      <div class="ds-rd">${ds.rd}</div>
      <div class="ds-zh">${ds.zh}</div>
    </div>
    <div class="card" style="margin-bottom:12px">
      <div style="display:flex;justify-content:space-between;margin-bottom:8px">
        <span style="font-size:14px;font-weight:600">ä»Šæ—¥é€²åº¦</span>
        <span style="font-size:14px;color:var(--text-secondary)">${prog} / ${goal}</span>
      </div>
      <div class="progress-bar"><div class="fill" style="width:${pct}%;background:${pct>=100?"var(--accent-success)":"var(--accent-primary)"}"></div></div>
      ${pct>=100?'<div style="text-align:center;font-size:13px;color:var(--accent-success);margin-top:8px;font-weight:600">ğŸ‰ ä»Šæ—¥ç›®æ¨™å·²é”æˆï¼</div>':''}
    </div>
    <div class="stats-row">
      <div class="stat-card"><div class="stat-value">${learned}</div><div class="stat-label">å·²å­¸å–®å­—</div></div>
      <div class="stat-card"><div class="stat-value">${rate}%</div><div class="stat-label">æŒæ¡ç‡</div></div>
      <div class="stat-card"><div class="stat-value">${d.streak.current}ğŸ”¥</div><div class="stat-label">é€£çºŒå¤©æ•¸</div></div>
    </div>
    <div class="today-info">
      <div class="today-chip"><strong>${due}</strong>å¾…è¤‡ç¿’</div>
      <div class="today-chip"><strong>${nw}</strong>æ–°å–®å­—</div>
    </div>
    <button class="btn btn-primary btn-block" style="margin:16px 0" onclick="Home.startStudy()">
      ${pct>=100?'ç¹¼çºŒè¤‡ç¿’':'é–‹å§‹ä»Šæ—¥å­¸ç¿’'} <span class="mascot mascot-sm" style="margin-left:4px">${MASCOT_STATES.studying}</span>
    </button>
    <div style="display:flex;gap:8px;margin-bottom:16px">
      <button class="btn btn-secondary" style="flex:1" onclick="ScenarioMode.show()">ğŸ—£ï¸ å ´æ™¯å°è©±</button>
      ${errCount?`<button class="btn btn-secondary" style="flex:1" onclick="ErrorBook.show()">ğŸ“• éŒ¯é¡Œæœ¬ (${errCount})</button>`:''}
    </div>
    ${learned>0?`<div class="card" style="margin-bottom:12px">
      <div style="font-size:13px;font-weight:600;margin-bottom:8px">ğŸ“Š è¨˜æ†¶å¼·åº¦åœ°åœ–</div>
      <div style="font-size:11px;color:var(--text-hint);margin-bottom:8px">æ¯æ ¼ä»£è¡¨ä¸€å€‹å–®å­— Â· é¡è‰²è¶Šæ·±è¨˜æ†¶è¶Šå¼·</div>
      ${this.renderMemoryMap(d)}
    </div>`:''}
    <div class="card">
      <div style="font-size:13px;font-weight:600;margin-bottom:8px">æœ€è¿‘ 7 å¤©</div>
      <div class="mini-chart">${hist.map((h,i)=>`<div class="bar${i===hist.length-1?" today":""}" style="height:${Math.max(8,h.count/maxC*100)}%"></div>`).join("")}</div>
      <div class="chart-labels">${hist.map(h=>{if(!h.date)return"<span>-</span>";const dd=new Date(h.date);return`<span>${days[dd.getDay()]}</span>`}).join("")}</div>
    </div>
    <div style="font-size:12px;color:var(--text-hint);text-align:center;margin-top:12px">FSRS-4.5 æ™ºæ…§é–“éš”é‡è¤‡ Â· ${total} å€‹ N5 å–®å­— Â· v3.0.0</div>`;
},
startStudy(){
  SessionRitual.show('vocab',()=>Router.go('vocab'));
},
renderMemoryMap(d){
  let html='<div class="memory-map">';
  VOCAB.forEach(v=>{
    const card=d.vocab[String(v.id)];
    let color,strength='æœªå­¸ç¿’';
    if(!card){color='var(--bg-secondary)'}
    else{
      const s=card.stability||0;const diff=card.difficulty||5;
      if(s>=30){color='rgba(52,199,89,0.9)';strength='å¼·'}
      else if(s>=10){color='rgba(52,199,89,0.6)';strength='ä¸­ä¸Š'}
      else if(s>=3){color='rgba(255,159,10,0.6)';strength='ä¸­'}
      else if(s>=1){color='rgba(255,159,10,0.35)';strength='å¼±'}
      else{color='rgba(255,59,48,0.4)';strength='å¾ˆå¼±'}
    }
    html+=`<div class="memory-cell" style="background:${color}" title="${v.w} ${v.m} - ${strength}"></div>`;
  });
  html+='</div>';
  html+='<div style="display:flex;justify-content:center;gap:12px;font-size:10px;color:var(--text-hint);margin-top:4px">';
  html+='<span>â¬œ æœªå­¸</span><span style="color:rgba(255,59,48,0.7)">ğŸŸ¥ å¼±</span><span style="color:rgba(255,159,10,0.8)">ğŸŸ§ ä¸­</span><span style="color:rgba(52,199,89,0.8)">ğŸŸ© å¼·</span>';
  html+='</div>';
  return html;
}
};

// ================================================================
// MODULE: Error Book (éŒ¯é¡Œæœ¬)
// ================================================================
const ErrorBook={
show(){
  const el=document.getElementById("home-content");
  const d=Store.load();const errors=(d.errorBook||[]).sort((a,b)=>b.count-a.count);
  if(!errors.length){el.innerHTML=`<div class="vocab-empty"><div class="emoji">âœ…</div><h3>æ²’æœ‰éŒ¯é¡Œï¼</h3><p style="margin-top:8px">å¤ªå²å®³äº†ï¼Œç¹¼çºŒä¿æŒï¼</p><button class="btn btn-secondary" style="margin-top:16px" onclick="Home.render()">â† è¿”å›</button></div>`;return}
  let html=`<div style="margin-bottom:12px;display:flex;justify-content:space-between;align-items:center">
    <button class="btn btn-secondary" onclick="Home.render()">â† è¿”å›</button>
    <button class="btn btn-primary" onclick="ErrorBook.review()">è¤‡ç¿’éŒ¯é¡Œ</button>
  </div><div class="section-title">ğŸ“• éŒ¯é¡Œæœ¬</div>`;
  errors.forEach(e=>{
    const v=VOCAB.find(x=>x.id===e.vocabId);if(!v)return;
    html+=`<div class="error-card">
      <div style="flex:1"><div class="error-word">${v.w} <span style="font-size:14px;color:var(--text-secondary)">${v.rd}</span></div>
      <div class="error-info">${v.m} Â· ${v.pos}</div></div>
      <div class="error-count">éŒ¯${e.count}æ¬¡</div>
      ${TTS.btn(v.rd,true)}
    </div>`});
  el.innerHTML=html},
review(){
  const d=Store.load();const errors=(d.errorBook||[]).slice(0,10);
  if(!errors.length)return;
  VocabMod.deck=errors.map(e=>{const v=VOCAB.find(x=>x.id===e.vocabId);
    return v?{vocab:v,card:d.vocab[String(v.id)]||FSRS.newCard()}:null}).filter(Boolean);
  VocabMod.idx=0;VocabMod.flipped=false;VocabMod.session={correct:0,wrong:0,total:VocabMod.deck.length};
  Router.go('vocab');VocabMod.render()}
};

// ================================================================
// MODULE: Scenario Dialogue (Real-world practice)
// ================================================================
const ScenarioMode={
current:null,dialogueIdx:0,score:0,total:0,
show(){
  const el=document.getElementById("home-content");
  const d=Store.load();
  const done=d.scenariosDone||[];
  let html=`<div style="margin-bottom:12px"><button class="btn btn-secondary" onclick="Home.render()">â† è¿”å›</button></div>
    <div class="section-title">ğŸ—£ï¸ å ´æ™¯å°è©±</div>
    <div style="font-size:14px;color:var(--text-secondary);margin-bottom:16px">åœ¨çœŸå¯¦å ´æ™¯ä¸­ç·´ç¿’æ—¥èªï¼æ¯å€‹å ´æ™¯æ¨¡æ“¬ä¸€æ®µå°è©±ã€‚</div>`;
  SCENARIOS.forEach(s=>{
    const isDone=done.includes(s.id);
    html+=`<div class="card" style="margin-bottom:10px;cursor:pointer${isDone?';border-color:var(--accent-success)':''}" onclick="ScenarioMode.start('${s.id}')">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="font-size:18px;font-weight:600;margin-bottom:4px">${s.title}</div>
          <div style="font-size:13px;color:var(--text-secondary)">${s.desc}</div>
        </div>
        <div style="font-size:24px">${isDone?'âœ…':'â†’'}</div>
      </div>
    </div>`;
  });
  el.innerHTML=html;
},
start(id){
  this.current=SCENARIOS.find(s=>s.id===id);
  if(!this.current)return;
  this.dialogueIdx=0;this.score=0;this.total=0;
  this.renderDialogue();
},
renderDialogue(){
  const el=document.getElementById("home-content");
  const s=this.current;const dlg=s.dialogues;
  let html=`<div style="margin-bottom:12px"><button class="btn btn-secondary" onclick="ScenarioMode.show()">â† è¿”å›</button></div>
    <div style="text-align:center;margin-bottom:16px">
      <div style="font-size:20px;font-weight:700">${s.title}</div>
      <div style="font-size:13px;color:var(--text-secondary)">${s.desc}</div>
    </div>
    <div class="dialogue-container">`;
  // Show all dialogues up to current index
  for(let i=0;i<=Math.min(this.dialogueIdx,dlg.length-1);i++){
    const d=dlg[i];
    if(d.npc){
      html+=`<div class="dialogue-bubble dialogue-npc">
        <div style="font-weight:600">${d.npc}</div>
        <div style="font-size:12px;color:var(--text-secondary);margin-top:4px">${d.npc_zh}</div>
      </div>`;
    }
    if(d.prompt&&i===this.dialogueIdx){
      html+=`<div style="font-size:14px;color:var(--accent-secondary);margin:12px 0 8px;font-weight:600">${d.prompt}</div>`;
      html+=`<div class="dialogue-choices">`;
      d.choices.forEach((c,ci)=>{
        html+=`<button class="dialogue-choice" id="dc-${ci}" onclick="ScenarioMode.choose(${ci})">
          <div class="dc-ja">${c.ja}</div>
          <div class="dc-zh">${c.zh}</div>
        </button>`;
      });
      html+=`</div>`;
    }else if(d.prompt&&i<this.dialogueIdx){
      // Show the user's previous answer
      const correct=d.choices.find(c=>c.correct);
      html+=`<div class="dialogue-bubble dialogue-user">${correct.ja}</div>`;
    }
  }
  html+=`</div>`;
  // Show completion
  if(this.dialogueIdx>=dlg.length){
    const pct=this.total>0?Math.round(this.score/this.total*100):100;
    html+=`<div style="text-align:center;margin-top:24px" class="anim-fade-in">
      <div style="font-size:48px;margin-bottom:8px">${pct>=80?'ğŸ‰':'ğŸ¤”'}</div>
      <div style="font-size:20px;font-weight:700;margin-bottom:8px">å°è©±å®Œæˆï¼</div>
      <div style="color:var(--text-secondary);margin-bottom:16px">æ­£ç¢ºç‡ï¼š${pct}% (${this.score}/${this.total})</div>
      <button class="btn btn-primary" onclick="ScenarioMode.show()">è¿”å›å ´æ™¯åˆ—è¡¨</button>
    </div>`;
    showConfetti();
  }
  el.innerHTML=html;
},
choose(ci){
  const d=this.current.dialogues[this.dialogueIdx];
  if(!d||!d.choices)return;
  const choice=d.choices[ci];
  this.total++;
  const btn=document.getElementById('dc-'+ci);
  if(choice.correct){
    this.score++;btn.classList.add('correct');
    TTS.speak(choice.ja);
    if(navigator.vibrate)navigator.vibrate([30]);
  }else{
    btn.classList.add('wrong');
    const correctIdx=d.choices.findIndex(c=>c.correct);
    document.getElementById('dc-'+correctIdx).classList.add('correct');
    TTS.speak(d.choices[correctIdx].ja);
    if(navigator.vibrate)navigator.vibrate([50,30,50]);
  }
  document.querySelectorAll('.dialogue-choice').forEach(b=>b.style.pointerEvents='none');
  setTimeout(()=>{
    this.dialogueIdx++;
    if(this.dialogueIdx>=this.current.dialogues.length){
      // Mark scenario as done
      const data=Store.load();
      if(!data.scenariosDone)data.scenariosDone=[];
      if(!data.scenariosDone.includes(this.current.id))data.scenariosDone.push(this.current.id);
      Store.save();Store.updateStreak();Achievements.check(data);
    }
    this.renderDialogue();
  },1200);
}
};

// ================================================================
// MODULE: Gojuon (with writing mode)
// ================================================================
const Gojuon={
script:"hiragana",mode:"chart",deck:[],idx:0,flipped:false,quizItem:null,quizOpts:[],answered:false,
writingPhase:"show",writingTimer:null,
render(){
  const el=document.getElementById("gojuon-content");
  if(this.mode==="chart")this.renderChart(el);
  else if(this.mode==="flashcard")this.renderFlashcard(el);
  else if(this.mode==="writing")this.renderWriting(el);
  else this.renderQuiz(el)},
renderChart(el){
  const d=Store.load();const sc=this.script;
  const rows=[{label:"æ¸…éŸ³ (åŸºæœ¬)",data:GOJUON.seion},{label:"æ¿éŸ³",data:GOJUON.dakuon},{label:"åŠæ¿éŸ³",data:GOJUON.handakuon}];
  let html="";
  rows.forEach(section=>{
    html+=`<div class="gojuon-row-label">${section.label}</div>`;
    const byRow={};section.data.forEach(k=>{if(!byRow[k.row])byRow[k.row]=[];byRow[k.row].push(k)});
    for(const[rn,items]of Object.entries(byRow)){
      const cols=["a","i","u","e","o"];
      cols.forEach(c=>{
        const k=items.find(i=>{
          if(rn==="y")return(c==="a"&&i.r==="ya")||(c==="u"&&i.r==="yu")||(c==="o"&&i.r==="yo");
          if(rn==="w")return(c==="a"&&i.r==="wa")||(c==="o"&&i.r==="wo");
          if(rn==="nn")return c==="a"&&i.r==="n";
          return i.r.endsWith(c)||(i.r===c)});
        if(!k){html+=`<div class="gojuon-cell empty"></div>`;return}
        const mastered=d.gojuon[k.r]&&d.gojuon[k.r].mastered;
        const display=sc==="hiragana"?k.h:sc==="katakana"?k.k:`${k.h}<span style="font-size:14px;color:var(--text-secondary)"> ${k.k}</span>`;
        html+=`<div class="gojuon-cell${mastered?" mastered":""}" onclick="Gojuon.showDetail('${k.r}')">${display}<span class="romaji">${k.r}</span></div>`})}});
  el.innerHTML=`<div class="gojuon-grid">${html}</div>`},
showDetail(r){
  const k=ALL_KANA.find(x=>x.r===r);if(!k)return;TTS.speak(k.h);
  showModal(k.h+" / "+k.k,`ç¾…é¦¬æ‹¼éŸ³ï¼š${k.r}`,[{text:"ğŸ”Š å†è½",cls:"btn-primary",action:()=>TTS.speak(k.h)},{text:"é—œé–‰",cls:"btn-secondary",action:hideModal}])},
renderFlashcard(el){
  if(!this.deck.length){this.deck=shuffle(ALL_KANA);this.idx=0;this.flipped=false}
  const k=this.deck[this.idx];const sc=this.script;const front=sc==="katakana"?k.k:k.h;
  el.innerHTML=`
    <div style="text-align:center;margin-bottom:8px;color:var(--text-secondary);font-size:14px">${this.idx+1} / ${this.deck.length}</div>
    <div class="flashcard-container" id="fc-container">
      <div class="flashcard${this.flipped?" flipped":""}" onclick="Gojuon.flip()">
        <div class="flashcard-face"><div class="char">${front}</div><div class="label">é»æ“Šç¿»è½‰ Â· å·¦å³æ»‘å‹•åˆ‡æ›</div></div>
        <div class="flashcard-face flashcard-back">
          <div class="romaji-big">${k.r}</div>
          <div style="margin-top:8px;font-size:18px;color:var(--text-secondary)">${k.h} / ${k.k}</div>
          <div style="margin-top:12px">${TTS.btn(k.h)}</div>
        </div>
      </div>
    </div>
    ${this.flipped?`<div class="flashcard-nav">
      <button class="btn btn-error" onclick="Gojuon.rate(false)">ä¸èªè­˜</button>
      <button class="btn btn-success" onclick="Gojuon.rate(true)">èªè­˜</button>
    </div>`:''}
    <div class="swipe-hint">â† ä¸èªè­˜ Â· èªè­˜ â†’</div>`;
  TTS.speak(k.h);
  setTimeout(()=>{const c=document.getElementById('fc-container');
    if(c)Swipe.attach(c,{left:()=>Gojuon.rate(false),right:()=>Gojuon.rate(true),up:()=>Gojuon.flip()})},100)},
flip(){this.flipped=!this.flipped;this.renderFlashcard(document.getElementById("gojuon-content"))},
rate(ok){
  const k=this.deck[this.idx];const d=Store.load();
  if(!d.gojuon[k.r])d.gojuon[k.r]={mastered:false,correctCount:0,wrongCount:0,lastPracticed:today()};
  if(ok){d.gojuon[k.r].correctCount++;if(d.gojuon[k.r].correctCount>=3)d.gojuon[k.r].mastered=true}
  else{d.gojuon[k.r].wrongCount++;d.gojuon[k.r].mastered=false}
  d.gojuon[k.r].lastPracticed=today();d.todayStats.gojuonPracticed++;
  Store.save();Store.updateStreak();
  if(navigator.vibrate)navigator.vibrate(ok?[30]:[50,30,50]);
  this.idx++;this.flipped=false;
  if(this.idx>=this.deck.length){this.deck=[];this.idx=0;showConfetti();
    showModal("å®Œæˆï¼ ğŸ‰",pick(ENCOURAGE.completion),[{text:"å†ä¾†ä¸€æ¬¡",cls:"btn-primary",action:()=>{hideModal();Gojuon.render()}},{text:"é—œé–‰",cls:"btn-secondary",action:hideModal}]);return}
  this.renderFlashcard(document.getElementById("gojuon-content"))},
renderWriting(el){
  if(!this.deck.length){this.deck=shuffle(ALL_KANA);this.idx=0}
  const k=this.deck[this.idx];const sc=this.script;const ch=sc==="katakana"?k.k:k.h;
  if(this.writingPhase==="show"){
    el.innerHTML=`<div style="text-align:center;color:var(--text-secondary);font-size:14px;margin-bottom:8px">${this.idx+1} / ${this.deck.length}</div>
      <div style="text-align:center;font-size:14px;color:var(--accent-primary);margin-bottom:8px">è¨˜ä½é€™å€‹å­—ï¼</div>
      <div class="writing-grid"><div class="writing-char">${ch}</div></div>
      <div style="text-align:center;margin-top:8px;font-size:13px;color:var(--text-hint)">${k.r}</div>`;
    TTS.speak(k.h);
    clearTimeout(this.writingTimer);
    this.writingTimer=setTimeout(()=>{this.writingPhase="practice";this.renderWriting(el)},2500);
  }else if(this.writingPhase==="practice"){
    el.innerHTML=`<div style="text-align:center;color:var(--text-secondary);font-size:14px;margin-bottom:8px">${this.idx+1} / ${this.deck.length}</div>
      <div style="text-align:center;font-size:14px;color:var(--accent-warning);margin-bottom:8px">åœ¨è…¦ä¸­å›æƒ³é€™å€‹å­—...</div>
      <div class="writing-grid"><div class="writing-char dim">${ch}</div></div>
      <div style="text-align:center;margin-top:8px;font-size:16px;font-weight:600">${k.r}</div>
      <div style="text-align:center;margin-top:16px">
        <button class="btn btn-secondary" onclick="Gojuon.writingReveal()">é¡¯ç¤ºç­”æ¡ˆ</button>
      </div>`;
  }else{
    el.innerHTML=`<div style="text-align:center;color:var(--text-secondary);font-size:14px;margin-bottom:8px">${this.idx+1} / ${this.deck.length}</div>
      <div style="text-align:center;font-size:14px;color:var(--accent-success);margin-bottom:8px">ç­”æ¡ˆæ­æ›‰</div>
      <div class="writing-grid"><div class="writing-char">${ch}</div></div>
      <div style="text-align:center;margin-top:8px;font-size:16px">${k.r} Â· ${k.h} / ${k.k}</div>
      <div style="display:flex;gap:12px;justify-content:center;margin-top:16px">
        <button class="btn btn-error" onclick="Gojuon.writingRate(false)">ä¸è¨˜å¾—</button>
        <button class="btn btn-success" onclick="Gojuon.writingRate(true)">è¨˜å¾—</button>
      </div>`;
    TTS.speak(k.h)}},
writingReveal(){this.writingPhase="reveal";this.renderWriting(document.getElementById("gojuon-content"))},
writingRate(ok){
  const k=this.deck[this.idx];const d=Store.load();
  if(!d.gojuon[k.r])d.gojuon[k.r]={mastered:false,correctCount:0,wrongCount:0,lastPracticed:today()};
  if(ok){d.gojuon[k.r].correctCount++;if(d.gojuon[k.r].correctCount>=3)d.gojuon[k.r].mastered=true}
  else{d.gojuon[k.r].wrongCount++}
  d.gojuon[k.r].lastPracticed=today();d.todayStats.gojuonPracticed++;Store.save();Store.updateStreak();
  this.idx++;this.writingPhase="show";
  if(this.idx>=this.deck.length){this.deck=[];this.idx=0;showConfetti();
    showModal("æ›¸å¯«ç·´ç¿’å®Œæˆï¼ ğŸ‰",pick(ENCOURAGE.completion),[{text:"å†ä¾†",cls:"btn-primary",action:()=>{hideModal();Gojuon.render()}},{text:"é—œé–‰",cls:"btn-secondary",action:hideModal}]);return}
  this.renderWriting(document.getElementById("gojuon-content"))},
renderQuiz(el){
  if(!this.quizItem||this.answered){
    this.answered=false;const pool=shuffle(ALL_KANA);this.quizItem=pool[0];
    const wrongs=pool.slice(1,4);this.quizOpts=shuffle([this.quizItem,...wrongs])}
  const k=this.quizItem;const sc=this.script;const qChar=sc==="katakana"?k.k:k.h;
  el.innerHTML=`
    <div class="quiz-header"><div style="font-size:14px;color:var(--text-secondary)">é€™å€‹å‡åçš„ç¾…é¦¬æ‹¼éŸ³æ˜¯ï¼Ÿ</div></div>
    <div class="quiz-question">${qChar}</div>
    <div class="quiz-options">${this.quizOpts.map((o,i)=>`<button class="quiz-option" id="gq${i}" onclick="Gojuon.answer(${i})">${o.r}</button>`).join("")}</div>
    <div class="quiz-feedback" id="gojuon-feedback"></div>`;
  TTS.speak(k.h)},
answer(i){
  if(this.answered)return;this.answered=true;
  const chosen=this.quizOpts[i];const correct=chosen.r===this.quizItem.r;
  const d=Store.load();const k=this.quizItem;
  if(!d.gojuon[k.r])d.gojuon[k.r]={mastered:false,correctCount:0,wrongCount:0,lastPracticed:today()};
  if(correct){d.gojuon[k.r].correctCount++;if(d.gojuon[k.r].correctCount>=3)d.gojuon[k.r].mastered=true}
  else{d.gojuon[k.r].wrongCount++}
  d.gojuon[k.r].lastPracticed=today();d.todayStats.gojuonPracticed++;Store.save();Store.updateStreak();
  if(navigator.vibrate)navigator.vibrate(correct?[30]:[50,30,50]);
  document.getElementById("gq"+i).classList.add(correct?"correct":"wrong");
  if(!correct){const ci=this.quizOpts.findIndex(o=>o.r===this.quizItem.r);document.getElementById("gq"+ci).classList.add("correct")}
  document.getElementById("gojuon-feedback").textContent=correct?pick(ENCOURAGE.correct):pick(ENCOURAGE.wrong);
  document.getElementById("gojuon-feedback").style.color=correct?"var(--accent-success)":"var(--accent-error)";
  TTS.speak(this.quizItem.h);
  setTimeout(()=>{this.quizItem=null;this.renderQuiz(document.getElementById("gojuon-content"))},1200)}
};
document.getElementById("gojuon-script-pills").addEventListener("click",e=>{
  const p=e.target.closest(".pill");if(!p)return;
  document.querySelectorAll("#gojuon-script-pills .pill").forEach(x=>x.classList.remove("active"));
  p.classList.add("active");Gojuon.script=p.dataset.script;Gojuon.render()});
document.getElementById("gojuon-mode-pills").addEventListener("click",e=>{
  const p=e.target.closest(".pill");if(!p)return;
  document.querySelectorAll("#gojuon-mode-pills .pill").forEach(x=>x.classList.remove("active"));
  p.classList.add("active");Gojuon.mode=p.dataset.mode;Gojuon.deck=[];Gojuon.quizItem=null;Gojuon.writingPhase="show";Gojuon.render()});

// ================================================================
// MODULE: Vocab
// ================================================================
const VocabMod={
deck:[],idx:0,flipped:false,session:{correct:0,wrong:0,total:0},
init(){
  const d=Store.load();const due=FSRS.getDue();
  const newCards=FSRS.getNew(Math.max(1,d.settings.dailyGoal-due.length));
  this.deck=[...due.map(c=>{const v=VOCAB.find(x=>x.id===+c.id);return v?{vocab:v,card:c}:null}).filter(Boolean),
    ...newCards.map(v=>({vocab:v,card:FSRS.newCard()}))];
  this.idx=0;this.flipped=false;this.session={correct:0,wrong:0,total:this.deck.length};
  this.render()},
render(){
  const el=document.getElementById("vocab-content");
  if(!this.deck.length){el.innerHTML=`<div class="vocab-empty"><div class="emoji">ğŸŒ</div><h3>ä»Šæ—¥å­¸ç¿’å®Œæˆï¼</h3>
    <div class="mascot mascot-lg anim-float" style="margin:16px 0">${MASCOT_STATES.celebrating}</div>
    <p style="margin-top:8px;color:var(--text-secondary)">æ˜å¤©å†ä¾†è¤‡ç¿’å§</p><button class="btn btn-secondary" style="margin-top:16px" onclick="VocabMod.browseAll()">ç€è¦½æ‰€æœ‰å–®å­—</button></div>`;return}
  if(this.idx>=this.deck.length){this.renderComplete(el);return}
  const item=this.deck[this.idx];const v=item.vocab;
  const pct=Math.round(this.idx/this.deck.length*100);
  el.innerHTML=`
    <div class="vocab-progress">
      <div class="count">${this.idx+1} / ${this.deck.length}</div>
      <div class="progress-bar" style="flex:1"><div class="fill" style="width:${pct}%"></div></div>
    </div>
    <div class="vocab-card-container" id="vc-container">
      <div class="vocab-card${this.flipped?" flipped":""}" onclick="VocabMod.flip()">
        <div class="vocab-face"><div class="word">${v.w}</div><div class="hint">é»æ“Šç¿»è½‰ Â· å·¦å³æ»‘å‹•è©•åˆ†</div></div>
        <div class="vocab-face vocab-back">
          <div style="display:flex;align-items:center;justify-content:center;gap:8px">
            <div class="reading">${v.rd}</div>${TTS.btn(v.rd,true)}
          </div>
          <div class="romaji-sm">${v.ro}</div>
          <div class="meaning">${v.m}</div>
          <div class="pos">${v.pos}</div>
          <div class="example"><div class="ja">${v.ex.ja}</div><div class="zh">${v.ex.zh}</div></div>
        </div>
      </div>
    </div>
    ${this.flipped?`<div class="vocab-rating">
      <button class="rate-btn r1" onclick="VocabMod.rate(1)">ğŸ˜µ å¿˜è¨˜</button>
      <button class="rate-btn r2" onclick="VocabMod.rate(2)">ğŸ˜ å›°é›£</button>
      <button class="rate-btn r3" onclick="VocabMod.rate(3)">ğŸ™‚ æƒ³ä¸€ä¸‹</button>
      <button class="rate-btn r4" onclick="VocabMod.rate(4)">ğŸ˜ ç§’ç­”</button>
    </div>`:""}
    <div class="swipe-hint">â† å¿˜è¨˜ Â· ç§’ç­” â†’</div>`;
  TTS.speak(v.rd);
  setTimeout(()=>{const c=document.getElementById('vc-container');
    if(c)Swipe.attach(c,{left:()=>{if(this.flipped)this.rate(1);else this.flip()},
      right:()=>{if(this.flipped)this.rate(4);else this.flip()},up:()=>this.flip()})},100)},
flip(){if(!this.flipped){this.flipped=true;this.render()}},
rate(q){
  const item=this.deck[this.idx];const d=Store.load();const id=String(item.vocab.id);
  if(!d.vocab[id])d.vocab[id]=FSRS.newCard();
  const result=FSRS.review(d.vocab[id],q);
  d.vocab[id]={...d.vocab[id],...result};
  if(q>=2){this.session.correct++;
    if(item.card.reps===0)d.todayStats.newWordsLearned++;else d.todayStats.wordsReviewed++}
  else{this.session.wrong++;d.todayStats.wordsReviewed++;Store.addError(item.vocab.id)}
  Store.save();Store.updateStreak();
  if(navigator.vibrate)navigator.vibrate(q>=3?[30]:[50,30,50]);
  this.idx++;this.flipped=false;this.render()},
renderComplete(el){
  const total=this.session.correct+this.session.wrong;
  const pct=total>0?Math.round(this.session.correct/total*100):0;
  const d=Store.load();Achievements.check(d);
  showConfetti();
  el.innerHTML=`<div class="vocab-complete anim-fade-in">
    <div class="mascot mascot-lg mascot-happy">${pct>=80?MASCOT_STATES.celebrating:MASCOT_STATES.cheering}</div>
    <h2 style="margin-top:12px">ä»Šæ—¥å­¸ç¿’å®Œæˆï¼</h2>
    <div class="result-circle" style="background:conic-gradient(var(--accent-success) ${pct*3.6}deg,var(--bg-secondary) 0)">
      <div style="width:110px;height:110px;border-radius:50%;background:var(--bg-primary);display:flex;flex-direction:column;align-items:center;justify-content:center">
        <div class="pct">${pct}%</div><div class="pct-label">æ­£ç¢ºç‡</div>
      </div>
    </div>
    <div class="stats" style="color:var(--text-secondary);line-height:2">æ­£ç¢ºï¼š${this.session.correct} å€‹<br>éœ€åŠ å¼·ï¼š${this.session.wrong} å€‹<br>ç¸½è¨ˆï¼š${total} å€‹</div>
    <div style="font-size:16px;font-weight:600;margin-bottom:16px;color:var(--accent-primary)">${pick(ENCOURAGE.completion)}</div>
    <button class="btn btn-primary" onclick="Router.go('home')">å›åˆ°é¦–é </button>
  </div>`},
browseAll(){
  const el=document.getElementById("vocab-content");
  const cats={verb:"å‹•è©",noun:"åè©",adj:"å½¢å®¹è©",place:"å ´æ‰€",people:"äººç‰©",time:"æ™‚é–“",greet:"æ‹›å‘¼",num:"æ•¸é‡",food:"é£Ÿã¹ç‰©",color:"è‰²",nature:"è‡ªç„¶",body:"ä½“",verb2:"å‹•è©2",adverb:"å‰¯è©"};
  let html='<div style="margin-bottom:12px"><button class="btn btn-secondary" onclick="VocabMod.init()">â† è¿”å›</button></div>';
  Object.entries(cats).forEach(([cat,label])=>{
    const words=VOCAB.filter(v=>v.cat===cat);if(!words.length)return;
    html+=`<div style="font-size:14px;font-weight:600;margin:12px 0 8px;color:var(--accent-secondary)">${label} (${words.length})</div>`;
    words.forEach(v=>{
      html+=`<div class="card" style="margin-bottom:8px;padding:12px">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
          <div style="flex:1"><span style="font-size:18px;font-weight:700">${v.w}</span> <span style="color:var(--text-secondary);font-size:14px">${v.rd}</span></div>
          ${TTS.btn(v.rd,true)}<div style="font-size:15px">${v.m}</div>
        </div>
        <div style="font-size:12px;color:var(--text-hint);margin-top:4px">${v.pos} | ${v.ex.ja} â†’ ${v.ex.zh}</div>
      </div>`})});
  el.innerHTML=html}
};

// ================================================================
// MODULE: Quiz (with scenario quiz type)
// ================================================================
const Quiz={
state:"setup",type:"vocab_choice",count:10,questions:[],qIdx:0,answers:[],startTime:0,
init(){this.state="setup";this.renderSetup()},
renderSetup(){
  const el=document.getElementById("quiz-content");
  const types=[
    {id:"vocab_choice",name:"å–®å­—é¸æ“‡é¡Œ (æ—¥â†’ä¸­)",desc:"çœ‹æ—¥æ–‡é¸ä¸­æ–‡æ„æ€",icon:"ğŸ‡¯ğŸ‡µ"},
    {id:"vocab_reverse",name:"åå‘é¸æ“‡é¡Œ (ä¸­â†’æ—¥)",desc:"çœ‹ä¸­æ–‡é¸æ—¥æ–‡",icon:"ğŸ”„"},
    {id:"vocab_typing",name:"æ‰“å­—å¡«ç©º",desc:"çœ‹ä¸­æ–‡æ‰“å‡ºå‡åè®€éŸ³",icon:"âŒ¨ï¸"},
    {id:"gojuon_quiz",name:"äº”åéŸ³æ¸¬é©—",desc:"çœ‹å‡åé¸ç¾…é¦¬æ‹¼éŸ³",icon:"ã‚"}
  ];
  el.innerHTML=`<div class="quiz-setup">
    <h2 style="text-align:center;margin-bottom:16px">é¸æ“‡æ¸¬é©—é¡å‹</h2>
    <div class="quiz-type-list">${types.map(t=>`<div class="quiz-type-item${this.type===t.id?" selected":""}" onclick="Quiz.setType('${t.id}')"><h4>${t.icon} ${t.name}</h4><p>${t.desc}</p></div>`).join("")}</div>
    <div style="text-align:center;font-size:14px;color:var(--text-secondary);margin-bottom:4px">é¡Œæ•¸</div>
    <div class="quiz-count">
      <button onclick="Quiz.adjCount(-5)">-</button><div class="num">${this.count}</div><button onclick="Quiz.adjCount(5)">+</button>
    </div>
    <button class="btn btn-primary btn-block" style="margin-top:16px" onclick="Quiz.startWithRitual()">é–‹å§‹æ¸¬é©—</button>
  </div>`},
setType(t){this.type=t;this.renderSetup()},
adjCount(n){this.count=Math.max(5,Math.min(30,this.count+n));this.renderSetup()},
startWithRitual(){SessionRitual.show('quiz',()=>this.start())},
start(){
  this.questions=[];this.answers=[];this.qIdx=0;this.startTime=Date.now();
  if(this.type==="gojuon_quiz"){
    const pool=shuffle(ALL_KANA).slice(0,this.count);
    pool.forEach(k=>{const opts=shuffle([k,...shuffle(ALL_KANA.filter(x=>x.r!==k.r)).slice(0,3)]);
      this.questions.push({type:"gojuon",question:k.h,answer:k.r,options:opts.map(o=>o.r)})});
  }else{
    const pool=shuffle(VOCAB).slice(0,this.count);
    pool.forEach(v=>{
      const sameC=VOCAB.filter(x=>x.cat===v.cat&&x.id!==v.id);
      const otherC=VOCAB.filter(x=>x.cat!==v.cat);
      let wrongs=[...shuffle(sameC).slice(0,2),...shuffle(otherC).slice(0,2)].slice(0,3);
      if(wrongs.length<3)wrongs=[...wrongs,...shuffle(VOCAB.filter(x=>x.id!==v.id)).slice(0,3-wrongs.length)];
      if(this.type==="vocab_choice")this.questions.push({type:"choice",question:v.w,answer:v.m,answerFull:v,options:shuffle([v,...wrongs]).map(o=>o.m)});
      else if(this.type==="vocab_reverse")this.questions.push({type:"reverse",question:v.m,answer:v.w,answerFull:v,options:shuffle([v,...wrongs]).map(o=>o.w)});
      else this.questions.push({type:"typing",question:v.m+"ï¼ˆ"+v.pos+"ï¼‰",answer:v.rd,answerRo:v.ro,answerFull:v})});
  }
  this.state="playing";this.renderQuestion()},
renderQuestion(){
  const el=document.getElementById("quiz-content");
  if(this.qIdx>=this.questions.length){this.renderResult(el);return}
  const q=this.questions[this.qIdx];
  let html=`<div style="text-align:center;color:var(--text-secondary);font-size:14px;margin-bottom:8px">${this.qIdx+1} / ${this.questions.length}</div>
    <div class="progress-bar" style="margin-bottom:16px"><div class="fill" style="width:${Math.round(this.qIdx/this.questions.length*100)}%"></div></div>`;
  if(q.type==="typing"){
    html+=`<div style="text-align:center;font-size:14px;color:var(--text-secondary);margin-bottom:8px">è«‹è¼¸å…¥å‡åè®€éŸ³</div>
      <div class="quiz-question" style="font-size:28px">${q.question}</div>
      <input class="typing-input" id="typing-ans" placeholder="è¼¸å…¥è®€éŸ³..." onkeydown="if(event.key==='Enter')Quiz.submitTyping()">
      <div class="typing-feedback" id="typing-fb"></div>
      <button class="btn btn-primary btn-block" style="margin-top:12px;max-width:300px;margin-left:auto;margin-right:auto" onclick="Quiz.submitTyping()">ç¢ºèª</button>`;
  }else{
    html+=`<div style="text-align:center;font-size:14px;color:var(--text-secondary)">${q.type==="gojuon"?"é€™å€‹å‡åçš„ç¾…é¦¬æ‹¼éŸ³æ˜¯ï¼Ÿ":"é¸å‡ºæ­£ç¢ºç­”æ¡ˆ"}</div>
      <div class="quiz-question">${q.question}</div>
      <div class="quiz-options">${q.options.map((o,i)=>`<button class="quiz-option" id="qo${i}" onclick="Quiz.pick(${i})">${o}</button>`).join("")}</div>
      <div class="quiz-feedback" id="quiz-fb"></div>`}
  el.innerHTML=html;
  if(q.type==="typing")setTimeout(()=>{const inp=document.getElementById("typing-ans");if(inp)inp.focus()},100);
  if(q.type==="choice"&&q.answerFull)TTS.speak(q.answerFull.rd);
  else if(q.type==="gojuon"){const k=ALL_KANA.find(x=>x.h===q.question);if(k)TTS.speak(k.h)}},
pick(i){
  const q=this.questions[this.qIdx];const chosen=q.options[i];const correct=chosen===q.answer;
  this.answers.push({q:q.question,chosen,correct:q.answer,isCorrect:correct});
  document.getElementById("qo"+i).classList.add(correct?"correct":"wrong");
  if(!correct){const ci=q.options.indexOf(q.answer);if(ci>=0)document.getElementById("qo"+ci).classList.add("correct");
    if(q.answerFull)Store.addError(q.answerFull.id,chosen,q.answer)}
  const fb=document.getElementById("quiz-fb");fb.textContent=correct?pick(ENCOURAGE.correct):pick(ENCOURAGE.wrong);
  fb.style.color=correct?"var(--accent-success)":"var(--accent-error)";
  document.querySelectorAll(".quiz-option").forEach(b=>b.style.pointerEvents="none");
  if(navigator.vibrate)navigator.vibrate(correct?[30]:[50,30,50]);
  if(q.answerFull)TTS.speak(q.answerFull.rd);
  else if(q.type==="gojuon"){const k=ALL_KANA.find(x=>x.r===q.answer);if(k)TTS.speak(k.h)}
  setTimeout(()=>{this.qIdx++;this.renderQuestion()},1000)},
submitTyping(){
  const inp=document.getElementById("typing-ans");if(!inp)return;
  const val=inp.value.trim();if(!val)return;
  const q=this.questions[this.qIdx];const correct=this.checkTyping(val,q.answer,q.answerRo);
  this.answers.push({q:q.question,chosen:val,correct:q.answer,isCorrect:correct});
  if(!correct&&q.answerFull)Store.addError(q.answerFull.id,val,q.answer);
  const fb=document.getElementById("typing-fb");
  fb.innerHTML=correct?`<span style="color:var(--accent-success)">${pick(ENCOURAGE.correct)}</span>`
    :`<span style="color:var(--accent-error)">${pick(ENCOURAGE.wrong)}<br>æ­£ç¢ºç­”æ¡ˆï¼š${q.answer}</span>`;
  inp.disabled=true;TTS.speak(q.answer);
  setTimeout(()=>{this.qIdx++;this.renderQuestion()},1200)},
checkTyping(input,answer,romaji){
  const n=input.toLowerCase().trim();const a=answer.toLowerCase();
  if(n===a||n===romaji)return true;
  const vars={si:"shi",ti:"chi",tu:"tsu",hu:"fu",zi:"ji"};
  let mod=n;for(const[k,v]of Object.entries(vars)){mod=mod.replace(k,v)}
  if(mod===romaji)return true;
  mod=n;for(const[k,v]of Object.entries(vars)){mod=mod.replace(v,k)}
  if(mod===romaji)return true;return false},
renderResult(el){
  const d=Store.load();const correct=this.answers.filter(a=>a.isCorrect).length;
  const total=this.answers.length;const pct=Math.round(correct/total*100);
  const duration=Math.round((Date.now()-this.startTime)/1000);
  const wrongs=this.answers.filter(a=>!a.isCorrect);
  d.quizHistory.push({id:"q_"+Date.now(),type:this.type,date:new Date().toISOString(),
    totalQuestions:total,correctAnswers:correct,wrongAnswers:wrongs.map(w=>({q:w.q,user:w.chosen,correct:w.correct})),duration});
  if(d.quizHistory.length>50)d.quizHistory=d.quizHistory.slice(-50);
  d.todayStats.quizzesTaken++;d.todayStats.correctRate=pct;
  Store.save();Store.updateStreak();Achievements.check(d);
  this.state="result";showConfetti();
  el.innerHTML=`<div class="quiz-result anim-fade-in">
    <div class="mascot mascot-lg mascot-happy">${pct>=80?MASCOT_STATES.celebrating:pct>=50?MASCOT_STATES.cheering:MASCOT_STATES.worried}</div>
    <h2 style="margin-top:8px">æ¸¬é©—çµæœ</h2>
    <div class="result-circle" style="background:conic-gradient(${pct>=80?"var(--accent-success)":pct>=50?"var(--accent-warning)":"var(--accent-error)"} ${pct*3.6}deg,var(--bg-secondary) 0);margin:20px auto">
      <div style="width:110px;height:110px;border-radius:50%;background:var(--bg-primary);display:flex;flex-direction:column;align-items:center;justify-content:center">
        <div class="pct">${pct}%</div><div class="pct-label">æ­£ç¢ºç‡</div>
      </div>
    </div>
    <div style="color:var(--text-secondary);margin-bottom:16px">ç­”å° ${correct} / ${total} é¡Œ Â· è€—æ™‚ ${duration} ç§’</div>
    <div style="font-size:16px;font-weight:600;color:var(--accent-primary);margin-bottom:16px">${pick(pct>=80?ENCOURAGE.correct:ENCOURAGE.wrong)}</div>
    ${wrongs.length?`<div class="wrong-list"><div style="font-weight:600;margin-bottom:8px">éŒ¯é¡Œå›é¡§ï¼š</div>${wrongs.map(w=>`<div class="wrong-item"><div class="q">${w.q}</div><div class="a">ä½ çš„ç­”æ¡ˆï¼š${w.chosen}</div><div class="c">æ­£ç¢ºç­”æ¡ˆï¼š${w.correct}</div></div>`).join("")}</div>`:""}
    <div style="display:flex;gap:8px;margin-top:16px">
      ${wrongs.length?`<button class="btn btn-secondary" style="flex:1" onclick="Quiz.retryWrong()">é‡æ¸¬éŒ¯é¡Œ</button>`:""}
      <button class="btn btn-primary" style="flex:1" onclick="Quiz.init()">å†æ¸¬ä¸€æ¬¡</button>
    </div>
  </div>`},
retryWrong(){
  const wrongs=this.answers.filter(a=>!a.isCorrect);
  this.questions=[];this.answers=[];this.qIdx=0;this.startTime=Date.now();
  wrongs.forEach(w=>{
    if(this.type==="gojuon_quiz"){
      const k=ALL_KANA.find(x=>x.h===w.q);if(!k)return;
      const opts=shuffle([k,...shuffle(ALL_KANA.filter(x=>x.r!==k.r)).slice(0,3)]);
      this.questions.push({type:"gojuon",question:k.h,answer:k.r,options:opts.map(o=>o.r)});
    }else{
      const v=VOCAB.find(x=>x.w===w.q||x.m===w.q||x.m+"ï¼ˆ"+x.pos+"ï¼‰"===w.q);if(!v)return;
      const wr=shuffle(VOCAB.filter(x=>x.id!==v.id)).slice(0,3);
      if(this.type==="vocab_choice")this.questions.push({type:"choice",question:v.w,answer:v.m,answerFull:v,options:shuffle([v,...wr]).map(o=>o.m)});
      else if(this.type==="vocab_reverse")this.questions.push({type:"reverse",question:v.m,answer:v.w,answerFull:v,options:shuffle([v,...wr]).map(o=>o.w)});
      else this.questions.push({type:"typing",question:v.m+"ï¼ˆ"+v.pos+"ï¼‰",answer:v.rd,answerRo:v.ro,answerFull:v})}
  });
  if(!this.questions.length){this.init();return}
  this.state="playing";this.renderQuestion()}
};

// ================================================================
// MODULE: Settings (with streak freeze, review cap, achievements)
// ================================================================
let deferredInstallPrompt=null;
const Settings={
render(){
  const d=Store.load();const el=document.getElementById("settings-content");
  const achHtml=Achievements.list.map(a=>{
    const unlocked=d.achievements&&d.achievements.includes(a.id);
    return`<div class="achievement-item ${unlocked?'unlocked':'locked'}">
      <div class="ach-icon">${a.icon}</div><div class="ach-name">${a.name}</div><div class="ach-desc">${a.desc}</div></div>`}).join('');
  el.innerHTML=`
    <div class="settings-group">
      <div class="settings-group-title">å¤–è§€</div>
      <div class="settings-item">
        <span class="label">ä¸»é¡Œæ¨¡å¼</span>
        <div class="theme-btns">
          <button class="theme-btn${d.settings.theme==="light"?" active":""}" onclick="Settings.setTheme('light')">æ·ºè‰²</button>
          <button class="theme-btn${d.settings.theme==="dark"?" active":""}" onclick="Settings.setTheme('dark')">æ·±è‰²</button>
          <button class="theme-btn${d.settings.theme==="auto"?" active":""}" onclick="Settings.setTheme('auto')">è‡ªå‹•</button>
        </div>
      </div>
    </div>
    <div class="settings-group">
      <div class="settings-group-title">å­¸ç¿’è¨­å®š</div>
      <div class="settings-item">
        <span class="label">æ¯æ—¥æ–°å–®å­—</span>
        <div class="daily-adj">
          <button onclick="Settings.adjGoal(-1)">-</button>
          <span class="num">${d.settings.dailyGoal}</span>
          <button onclick="Settings.adjGoal(1)">+</button>
        </div>
      </div>
      <div class="settings-item">
        <span class="label">è¤‡ç¿’ä¸Šé™</span>
        <div class="daily-adj">
          <button onclick="Settings.adjCap(-10)">-</button>
          <span class="num">${d.settings.reviewCap}</span>
          <button onclick="Settings.adjCap(10)">+</button>
        </div>
      </div>
      <div class="settings-item">
        <span class="label">ğŸ”Š ç™¼éŸ³åŠŸèƒ½</span>
        <div class="theme-btns">
          <button class="theme-btn${d.settings.soundEnabled?" active":""}" onclick="Settings.setSound(true)">é–‹å•Ÿ</button>
          <button class="theme-btn${!d.settings.soundEnabled?" active":""}" onclick="Settings.setSound(false)">é—œé–‰</button>
        </div>
      </div>
    </div>
    <div class="settings-group">
      <div class="settings-group-title">ğŸ§Š å…æ­»é‡‘ç‰Œ (Streak Freeze)</div>
      <div class="settings-item">
        <div>
          <span class="label">å‰©é¤˜æ•¸é‡</span>
          <div style="font-size:12px;color:var(--text-hint);margin-top:2px">ç¼ºå¸­ä¸€å¤©æ™‚è‡ªå‹•ä½¿ç”¨ï¼Œä¿è­·é€£çºŒè¨˜éŒ„</div>
        </div>
        <div class="streak-freeze-badge">ğŸ§Š Ã—${d.streakFreezes}</div>
      </div>
      <div class="settings-item" style="cursor:pointer" onclick="Settings.buyFreeze()">
        <span class="label">ç²å¾—å…æ­»é‡‘ç‰Œ</span>
        <span class="value" style="color:var(--accent-secondary)">é€£çºŒ7å¤©è‡ªå‹•ç²å¾— â†’</span>
      </div>
    </div>
    <div class="settings-group">
      <div class="settings-group-title">æˆå°± (${(d.achievements||[]).length}/${Achievements.list.length})</div>
      <div class="achievement-grid">${achHtml}</div>
    </div>
    <div class="settings-group">
      <div class="settings-group-title">æ‡‰ç”¨ç¨‹å¼</div>
      <button class="install-btn" id="install-btn" onclick="Settings.installApp()">ğŸ“² å®‰è£åˆ°ä¸»è¢å¹•</button>
    </div>
    <div class="settings-group">
      <div class="settings-group-title">è³‡æ–™ç®¡ç†</div>
      <div class="settings-item" style="cursor:pointer" onclick="Store.exportData()">
        <span class="label">åŒ¯å‡ºå­¸ç¿’è¨˜éŒ„</span><span class="value">ä¸‹è¼‰ JSON â†’</span>
      </div>
      <div class="settings-item" style="cursor:pointer" onclick="document.getElementById('import-file').click()">
        <span class="label">åŒ¯å…¥å­¸ç¿’è¨˜éŒ„</span><span class="value">ä¸Šå‚³ JSON â†’</span>
      </div>
      <input type="file" id="import-file" class="file-input" accept=".json" onchange="Settings.importFile(event)">
    </div>
    <div class="settings-group">
      <div class="settings-group-title">å­¸ç¿’çµ±è¨ˆ</div>
      <div class="settings-item"><span class="label">ç¸½å­¸ç¿’å–®å­—</span><span class="value">${Object.keys(d.vocab).length} / ${VOCAB.length}</span></div>
      <div class="settings-item"><span class="label">æœ€é•·é€£çºŒå¤©æ•¸</span><span class="value">${d.streak.longest} å¤©</span></div>
      <div class="settings-item"><span class="label">æ¸¬é©—æ¬¡æ•¸</span><span class="value">${d.quizHistory.length} æ¬¡</span></div>
      <div class="settings-item"><span class="label">å ´æ™¯å®Œæˆ</span><span class="value">${(d.scenariosDone||[]).length} / ${SCENARIOS.length}</span></div>
      <div class="settings-item"><span class="label">éŒ¯é¡Œæ•¸</span><span class="value">${(d.errorBook||[]).length}</span></div>
      <div class="settings-item"><span class="label">æ¼”ç®—æ³•</span><span class="value">FSRS-4.5</span></div>
    </div>
    <div class="settings-group">
      <div class="settings-group-title">å±éšªå€åŸŸ</div>
      <button class="danger-btn" onclick="Settings.confirmReset()">é‡ç½®æ‰€æœ‰é€²åº¦</button>
    </div>
    <div class="version-info">æ—¥æœ¬èªãƒã‚¹ã‚¿ãƒ¼ v3.0.0<br>FSRS-4.5 Â· User Care Edition<br>ğŸ¦Š ä½ çš„æ—¥èªå­¸ç¿’å¤¥ä¼´<br>è³‡æ–™å„²å­˜æ–¼ç€è¦½å™¨æœ¬æ©Ÿ</div>`;
  if(deferredInstallPrompt){document.getElementById('install-btn').style.display='block'}},
setTheme(t){Theme.set(t);this.render()},
setSound(v){const d=Store.load();d.settings.soundEnabled=v;Store.save();this.render();if(v)TTS.speak("ã“ã‚“ã«ã¡ã¯")},
adjGoal(n){const d=Store.load();d.settings.dailyGoal=Math.max(1,Math.min(30,d.settings.dailyGoal+n));Store.save();this.render()},
adjCap(n){const d=Store.load();d.settings.reviewCap=Math.max(10,Math.min(100,d.settings.reviewCap+n));Store.save();this.render()},
buyFreeze(){
  const d=Store.load();
  if(d.streak.current>=7&&d.streakFreezes<5){
    d.streakFreezes++;Store.save();this.render();
    showModal("ç²å¾—å…æ­»é‡‘ç‰Œï¼ğŸ§Š",`é€£çºŒå­¸ç¿’7å¤©çå‹µï¼ä½ ç¾åœ¨æœ‰ ${d.streakFreezes} å€‹å…æ­»é‡‘ç‰Œã€‚`,[{text:"å¤ªæ£’äº†ï¼",cls:"btn-primary",action:hideModal}]);
  }else if(d.streakFreezes>=5){
    showModal("å·²é”ä¸Šé™","ä½ æœ€å¤šå¯ä»¥æŒæœ‰ 5 å€‹å…æ­»é‡‘ç‰Œ",[{text:"çŸ¥é“äº†",cls:"btn-secondary",action:hideModal}]);
  }else{
    showModal("ç¹¼çºŒåŠªåŠ›ï¼","é€£çºŒå­¸ç¿’ 7 å¤©å°±èƒ½ç²å¾—å…æ­»é‡‘ç‰Œï¼\nç›®å‰é€£çºŒï¼š"+d.streak.current+" å¤©",[{text:"åŠ æ²¹ï¼",cls:"btn-primary",action:hideModal}]);
  }
},
importFile(e){const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=ev=>{
  if(Store.importData(ev.target.result)){showModal("åŒ¯å…¥æˆåŠŸ","å­¸ç¿’è¨˜éŒ„å·²æˆåŠŸé‚„åŸï¼",[{text:"ç¢ºå®š",cls:"btn-primary",action:()=>{hideModal();Settings.render()}}])}
  else{showModal("åŒ¯å…¥å¤±æ•—","æª”æ¡ˆæ ¼å¼ä¸æ­£ç¢º",[{text:"é—œé–‰",cls:"btn-secondary",action:hideModal}])}};r.readAsText(f)},
confirmReset(){showModal("ç¢ºèªé‡ç½®","é€™å°‡æ¸…é™¤æ‰€æœ‰å­¸ç¿’é€²åº¦å’Œè¨­å®šï¼Œæ­¤æ“ä½œç„¡æ³•æ¢å¾©ï¼",[
  {text:"å–æ¶ˆ",cls:"btn-secondary",action:hideModal},
  {text:"ç¢ºèªé‡ç½®",cls:"btn-error",action:()=>{Store.reset();hideModal();Settings.render();
    showModal("å·²é‡ç½®","æ‰€æœ‰é€²åº¦å·²æ¸…é™¤",[{text:"ç¢ºå®š",cls:"btn-primary",action:hideModal}])}}])},
installApp(){if(deferredInstallPrompt){deferredInstallPrompt.prompt();
  deferredInstallPrompt.userChoice.then(r=>{deferredInstallPrompt=null;
    document.getElementById('install-btn').style.display='none'})}}
};

// ================================================================
// MODAL helpers
// ================================================================
function showModal(title,msg,actions){
  document.getElementById("modal-title").textContent=title;
  document.getElementById("modal-msg").textContent=msg;
  const ac=document.getElementById("modal-actions");
  ac.innerHTML=actions.map((a,i)=>`<button class="btn ${a.cls}" id="modal-btn-${i}">${a.text}</button>`).join("");
  actions.forEach((a,i)=>document.getElementById("modal-btn-"+i).addEventListener("click",a.action));
  document.getElementById("modal-overlay").classList.add("show");
}
function hideModal(){document.getElementById("modal-overlay").classList.remove("show")}

// ================================================================
// PWA
// ================================================================
(function initPWA(){
  const manifest={
    name:"æ—¥æœ¬èªãƒã‚¹ã‚¿ãƒ¼",short_name:"æ—¥èªå­¸ç¿’",
    start_url:".",display:"standalone",
    background_color:"#F7F6F3",theme_color:"#D4513D",
    icons:[{src:"data:image/svg+xml,"+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" rx="20" fill="#D4513D"/><text x="50" y="38" font-size="28" text-anchor="middle" fill="white">ğŸ¦Š</text><text x="50" y="72" font-size="28" text-anchor="middle" fill="white" font-family="serif">èª</text></svg>'),sizes:"512x512",type:"image/svg+xml"}]
  };
  const mBlob=new Blob([JSON.stringify(manifest)],{type:'application/json'});
  const mURL=URL.createObjectURL(mBlob);
  const link=document.createElement('link');link.rel='manifest';link.href=mURL;
  document.head.appendChild(link);
  // Unregister any broken service workers from previous versions
  if('serviceWorker' in navigator){
    navigator.serviceWorker.getRegistrations().then(regs=>{
      regs.forEach(r=>r.unregister());
    }).catch(()=>{});
    // Clear old caches
    if(window.caches){caches.keys().then(ks=>ks.forEach(k=>caches.delete(k))).catch(()=>{});}
  }
  window.addEventListener('beforeinstallprompt',e=>{e.preventDefault();deferredInstallPrompt=e;
    const btn=document.getElementById('install-btn');if(btn)btn.style.display='block'});
})();

// ================================================================
// APP INIT
// ================================================================
(function(){
  Store.load();Theme.init();TTS.init();Router.init();
  // Show onboarding for first-time users
  Onboarding.show();
  document.getElementById('onboard-btn').addEventListener('click',()=>Onboarding.next());
  Home.render();
  const d=Store.load();
  if(d.todayStats.date!==today()){
    d.todayStats={date:today(),newWordsLearned:0,wordsReviewed:0,gojuonPracticed:0,quizzesTaken:0,correctRate:0,timeSpent:0};
    Store.save()}
  // Auto-grant streak freeze every 7 days
  if(d.streak.current>0&&d.streak.current%7===0&&d.streakFreezes<5){
    d.streakFreezes++;Store.save();
    setTimeout(()=>{const t=document.getElementById('ach-toast');
      t.querySelector('.toast-icon').textContent='ğŸ§Š';
      t.querySelector('.toast-text').textContent=`é€£çºŒ7å¤©çå‹µï¼šç²å¾—å…æ­»é‡‘ç‰Œï¼(å…±${d.streakFreezes}å€‹)`;
      t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2500)},1000);
  }
  Achievements.check(d);
  // WebView detection
  const ua=navigator.userAgent||"";
  const knownWebView=/Telegram|TelegramBot|Instagram|FBAN|FBAV|Line\/|Twitter|Snapchat/i.test(ua);
  function showBanner(){
    const b=document.getElementById("webview-banner");
    if(b&&b.style.display!=="flex"){b.style.display="flex";
      document.querySelectorAll(".page").forEach(p=>p.style.paddingTop="56px")}}
  if(knownWebView){showBanner()}
  else{const testAudio=()=>{const a=new Audio();
    a.src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=";
    const p=a.play();if(p&&p.catch)p.catch(()=>showBanner());
    document.removeEventListener("click",testAudio);document.removeEventListener("touchstart",testAudio)};
    setTimeout(()=>{document.addEventListener("click",testAudio,{once:true});
      document.addEventListener("touchstart",testAudio,{once:true,passive:true})},1000)}
})();
</script>
</body>
</html>
